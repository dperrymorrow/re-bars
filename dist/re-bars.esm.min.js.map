{"version":3,"file":"re-bars.esm.min.js","sources":["../src/msg.js","../src/utils/index.js","../src/utils/dom.js","../src/proxy-trap.js","../src/helpers.js","../src/utils/patch.js","../src/re-render.js","../src/app.js"],"sourcesContent":["const styles = {\n  warn: \"background: #484915; color: #ffffbe; padding: .1em; font-weight: normal;\",\n  log: \"background: #324645; color:#c9faff; padding: .1em; font-weight: normal;\",\n};\n\nconst _showTpl = ({ template, loc }) => {\n  const lines = template.split(\"\\n\").slice(loc.start.line - 1, loc.end.line);\n  const leadingSpaces = Array(lines[0].length - lines[0].trim().length).join(\" \");\n  const trimmed = lines.map(line => line.replace(leadingSpaces, \"      \"));\n  trimmed[0] = `>>>> ${trimmed[0].trim()}`;\n\n  return `\n  template line: ${loc.start.line}\n  ============================================\n  ${trimmed.join(\"\\n\")}\n  `;\n};\n\nconst _msg = (type, msg, ...payloads) => {\n  let str = msg;\n  if (typeof payloads[0] === \"object\" && \"template\" in payloads[0] && \"loc\" in payloads[0]) {\n    str += _showTpl(payloads[0]);\n    payloads.splice(0, 1);\n  }\n\n  if ([\"warn\", \"log\"].includes(type)) {\n    str = \"%c \" + str + \" \";\n    if (!window.ReBars || !window.ReBars.trace) return;\n    if (payloads) {\n      console.groupCollapsed(str, styles[type]);\n      payloads.forEach(console.log);\n      console.groupEnd();\n    } else {\n      console.log(str, styles[type]);\n    }\n  } else {\n    payloads.forEach(console.error);\n    throw new Error(str);\n  }\n};\n\nexport default {\n  warn: _msg.bind(null, \"warn\"),\n  fail: _msg.bind(null, \"throw\"),\n  log: _msg.bind(null, \"log\"),\n};\n","let counter = 1;\n\nimport Dom from \"./dom.js\";\nimport Msg from \"../msg.js\";\n\nexport default {\n  dom: Dom,\n\n  stringify(obj, indent = 2) {\n    const parser = (key, val) => (typeof val === \"function\" ? val + \"\" : val);\n    return JSON.stringify(obj, parser, indent);\n  },\n\n  debounce(callback, wait = 0, immediate = false) {\n    let timeout = null;\n\n    return function() {\n      const callNow = immediate && !timeout;\n      const next = () => callback.apply(this, arguments);\n\n      clearTimeout(timeout);\n      timeout = setTimeout(next, wait);\n\n      if (callNow) {\n        next();\n      }\n    };\n  },\n\n  bind(obj, scope) {\n    return Object.keys(obj).reduce(\n      (bound, key) => {\n        bound[key] = bound[key].bind(scope);\n        return bound;\n      },\n      { ...obj }\n    );\n  },\n\n  // isProp(target) {\n  //   if (typeof target === \"string\" && target.startsWith(\"$props\")) return true;\n  //   else if (typeof target === \"object\" && target.ReBarsPath && target.ReBarsPath.startsWith(\"$props\")) return true;\n  //   return false;\n  // },\n\n  shouldRender(path, watch) {\n    const watchPaths = Array.isArray(watch) ? watch : [watch];\n    return watchPaths.some(watchPath => {\n      if (path === watchPath || watchPath === \".*\") return true;\n\n      const pathSegs = path.split(\".\");\n      const watchSegs = watchPath.split(\".\");\n\n      return watchSegs.every((seg, index) => {\n        if (seg === pathSegs[index] || seg === \"*\") return true;\n        return false;\n      });\n    });\n  },\n\n  randomId: () => `rbs${counter++}`,\n\n  getKey(obj, path) {\n    return path.split(\".\").reduce((pointer, key) => {\n      if (!(key in pointer)) Msg.fail(`${path} was not found in object`, obj);\n      return pointer[key];\n    }, obj);\n  },\n\n  hasKey(obj, path) {\n    // cannot traverse it if wildcards are used\n    if (path.includes(\"*\")) return true;\n    try {\n      this.getKey(obj, path);\n      return true;\n    } catch (err) {\n      return false;\n    }\n  },\n  //\n  // setKey(obj, path, val) {\n  //   const arr = path.split(\".\");\n  //   arr.reduce((pointer, key, index) => {\n  //     if (!(key in pointer)) Msg.fail(`${path} was not found in object!`, obj);\n  //     if (index + 1 === arr.length) pointer[key] = val;\n  //     return pointer[key];\n  //   }, obj);\n  // },\n};\n","import Msg from \"../msg.js\";\n\nexport default {\n  // tagComponent(id, html, name) {\n  //   const $tmp = this.getShadow(html);\n  //   const $root = $tmp.firstElementChild;\n  //\n  //   if (!$root) throw new Error(\"there was no root node. Components need a root element.\");\n  //   if ([\"P\"].includes($root.nodeName))\n  //     Msg.fail(`${name}: <${$root.nodeName.toLowerCase()}> cannot be a root element of for a component, try a <div>`);\n  //   if ($tmp.children.length > 1) Msg.fail(`${name}: multiple root nodes are not allowed for a component.`);\n  //   if ($root.dataset.rbsWatch) Msg.fail(`${name}: cannot have a watch as the root node of a component`);\n  //\n  //   $root.dataset.rbsComp = id;\n  //   const content = $tmp.innerHTML;\n  //   return content;\n  // },\n\n  recordState($target) {\n    const $active = document.activeElement;\n    const ref = $active.getAttribute(\"ref\");\n\n    if (!$target.contains($active) || !ref) return null;\n    return {\n      ref,\n      scrollTop: $active.scrollTop,\n      scrollLeft: $active.scrollLeft,\n      selectionStart: $active.selectionStart,\n    };\n  },\n\n  restoreState($target, activeRef) {\n    if (!activeRef) return;\n\n    const $input = this.findRef($target, activeRef.ref);\n    if (!$input) return;\n\n    if (Array.isArray($input)) {\n      Msg.warn(\n        `ref=\"${activeRef.ref}\" is used more than once. Focus cannot be restored. If using bind, add a ref=\"uniqeName\" to each usage`,\n        $input\n      );\n    } else {\n      $input.focus();\n      if (activeRef.selectionStart) {\n        const pos = $input.tagName === \"TEXTAREA\" ? activeRef.selectionStart : activeRef.selectionStart + 1;\n        $input.setSelectionRange(pos, pos);\n      }\n\n      $input.scrollTop = activeRef.scrollTop;\n      $input.scrollLeft = activeRef.scrollLeft;\n    }\n  },\n\n  // findComponent: id => document.querySelector(`[data-rbs-comp=\"${id}\"]`),\n\n  // findRef: ($target, ref) => {\n  //   if ($target.getAttribute(\"ref\") === ref) return $target;\n  //   return $target.querySelector(`[ref=\"${ref}\"]`);\n  // },\n  //\n  findRefs($root) {\n    const $refs = Array.from($root.querySelectorAll(\"[ref]\"));\n\n    return $refs.reduce((obj, $el) => {\n      const key = $el.getAttribute(\"ref\");\n      const target = obj[key];\n      obj[key] = target ? [target].concat($el) : $el;\n      return obj;\n    }, {});\n  },\n\n  findWatcher: id => document.querySelector(`[data-rbs-watch=\"${id}\"]`),\n\n  propStr: props =>\n    Object.entries(props)\n      .map(([key, val]) => {\n        if (typeof val === \"number\") return `${key}=${val}`;\n        else return `${key}=\"${val}\"`;\n      })\n      .join(\" \"),\n\n  wrapWatcher(id, html, hash) {\n    const { tag, ...props } = { ...{ tag: \"span\" }, ...hash };\n    const propStr = this.propStr(props);\n    const style = !html.length ? \"style='display:none;'\" : \"\";\n    return `<${tag} ${propStr} ${style} data-rbs-watch=\"${id}\">${html}</${tag}>`;\n  },\n\n  getShadow(html) {\n    const $tmp = document.createElement(\"div\");\n    $tmp.innerHTML = html;\n    return $tmp;\n  },\n};\n","import Utils from \"./utils/index.js\";\n\nexport default {\n  create(data, callback, trackGet = false) {\n    let que = [];\n\n    const _debounced = Utils.debounce(() => {\n      callback(que);\n      que = [];\n    });\n\n    const _addToQue = path => {\n      que.push(path);\n      _debounced(que);\n    };\n\n    function _buildProxy(raw, tree = []) {\n      return new Proxy(raw, {\n        get: function(target, prop) {\n          if (prop === \"ReBarsPath\") return tree.join(\".\");\n          const value = Reflect.get(...arguments);\n          if (typeof value === \"function\" && target.hasOwnProperty(prop)) return value.bind(proxyData);\n\n          if (trackGet) _addToQue(tree.concat(prop).join(\".\"));\n          if (value !== null && typeof value === \"object\" && prop !== \"methods\" && value.constructor.name === \"object\")\n            return _buildProxy(value, tree.concat(prop));\n          else return value;\n        },\n\n        set: function(target, prop) {\n          const ret = Reflect.set(...arguments);\n          const path = tree.concat(prop).join(\".\");\n          _addToQue(path);\n          return ret;\n        },\n\n        deleteProperty: function(target, prop) {\n          const ret = Reflect.deleteProperty(...arguments);\n          const path = tree.concat(prop).join(\".\");\n          _addToQue(path);\n          return ret;\n        },\n      });\n    }\n\n    const proxyData = _buildProxy(data);\n    return proxyData;\n  },\n};\n","import Msg from \"./msg.js\";\nimport Utils from \"./utils/index.js\";\nimport ProxyTrap from \"./proxy-trap.js\";\n\nexport default {\n  register({ instance, helpers, template, store }) {\n    Object.entries(helpers).forEach(([name, fn]) => instance.registerHelper(name, fn));\n\n    instance.registerHelper(\"debug\", (obj, { hash, data, loc }) => {\n      if (obj === undefined) Msg.fail(`${name}: undefined passed to debug`, { template, loc });\n      const props = { class: \"debug\", ...hash };\n      return new instance.SafeString(`<pre ${Utils.dom.propStr(props)}>${Utils.stringify(obj)}</pre>`);\n    });\n\n    instance.registerHelper(\"watch\", function(...args) {\n      const { fn, hash, data, loc } = args.pop();\n\n      const eId = Utils.randomId();\n\n      const _getPath = target => {\n        if (target === undefined) Msg.fail(`${name}: undefined cannot be watched`, { template, loc });\n        return typeof target === \"object\" ? `${target.ReBarsPath}.*` : target;\n      };\n\n      const path = args.map(_getPath);\n\n      if (!path.length) {\n        const trap = ProxyTrap.create(\n          data.root,\n          paths => {\n            store.renders[eId].path = paths;\n          },\n          true\n        );\n\n        fn(trap);\n      }\n\n      path.forEach(item => {\n        if (!Utils.hasKey(data.root, item)) Msg.fail(`${name}: cannot find path \"${item}\" to watch`, { template, loc });\n      });\n\n      store.renders[eId] = {\n        path,\n        render: () => fn(this),\n      };\n\n      return Utils.dom.wrapWatcher(eId, fn(this), hash);\n    });\n  },\n};\n","import Utils from \"./index.js\";\n\nfunction _isEqHtml(html1, html2) {\n  const reg = new RegExp(/data-rbs(.*?)=\"(.*?)\"/g);\n  return html1.replace(reg, \"\") === html2.replace(reg, \"\");\n}\n\nfunction _insertAt($target, $child, index = 0) {\n  if (index >= $target.children.length) $target.appendChild($child);\n  else $target.insertBefore($child, $target.children[index]);\n}\n\nexport default {\n  canPatch: $target =>\n    $target.children.length &&\n    $target.children.length > 1 &&\n    Array.from($target.children).every($el => $el.getAttribute(\"ref\")),\n  hasChanged: ($target, html) => !_isEqHtml($target.innerHTML, html),\n\n  compare({ app, $target, html }) {\n    const $shadow = Utils.dom.getShadow(html);\n    const $vChilds = Array.from($shadow.children);\n\n    // deletes and updates\n    Array.from($target.children).forEach($r => {\n      const $v = Utils.dom.findRef($shadow, $r.getAttribute(\"ref\"));\n      if (!$v) $r.remove();\n      else if (!_isEqHtml($v.innerHTML, $r.innerHTML)) $r.replaceWith($v.cloneNode(true));\n    });\n\n    // additions\n    $vChilds.forEach(($v, index) => {\n      const $r = Utils.dom.findRef($target, $v.getAttribute(\"ref\"));\n      if (!$r) _insertAt($target, $v.cloneNode(true), index);\n    });\n\n    // sorting\n    $vChilds.forEach(($v, index) => {\n      const $r = $target.children[index];\n      if ($r.getAttribute(\"ref\") !== $v.getAttribute(\"ref\")) $r.replaceWith($v.cloneNode(true));\n    });\n  },\n};\n","import Utils from \"./utils/index.js\";\nimport Msg from \"./msg.js\";\nimport Patch from \"./utils/patch.js\";\n\nexport default {\n  paths({ paths, renders }) {\n    Object.entries(renders)\n      .filter(([renderId, handler]) => {\n        const matches = paths.some(path => Utils.shouldRender(path, handler.path));\n        return matches && Utils.dom.findWatcher(renderId);\n      })\n      .forEach(([renderId, handler]) => {\n        const $target = Utils.dom.findWatcher(renderId);\n        const html = handler.render();\n        const stash = Utils.dom.recordState($target);\n\n        if (!Patch.hasChanged($target, html)) return;\n\n        // if (Patch.canPatch($target)) {\n        //   Patch.compare({ app, $target, html });\n        //   Msg.log(`${name}: patching ${handler.path}`, $target);\n        //   Utils.dom.restoreState($target, stash);\n        //   return;\n        // }\n\n        // warn for not having a ref on array update\n        const lenPath = handler.path.find(path => path.endsWith(\".length\"));\n        if (lenPath)\n          Msg.warn(\n            `${name}: patching \"${handler.path}\" add a ref=\"someUniqueKey\" to each to avoid re-rendering the entire Array of elements`,\n            $target\n          );\n\n        $target.style.display = html === \"\" ? \"none\" : \"\";\n        $target.innerHTML = html;\n\n        Utils.dom.restoreState($target, stash);\n        Msg.log(`${name}: re-rendering watch block for ${handler.path}`, $target);\n      });\n  },\n};\n","import Msg from \"./msg.js\";\nimport Helpers from \"./helpers.js\";\nimport ReRender from \"./re-render.js\";\nimport ProxyTrap from \"./proxy-trap.js\";\nimport Utils from \"./utils/index.js\";\n\nexport default {\n  app({ helpers = {}, template, data = {}, refs = {}, methods = {}, Handlebars = window.Handlebars }) {\n    const instance = Handlebars.create();\n    const templateFn = instance.compile(template);\n    const store = { renders: {} };\n\n    const proxy = ProxyTrap.create(data, paths => {\n      Msg.log(`${name}: data changed \"${paths}\"`, store.renders);\n      ReRender.paths({ paths, renders: store.renders });\n    });\n\n    Helpers.register({ instance, template, helpers, store });\n\n    return {\n      instance,\n      render($app) {\n        const scope = {\n          data: proxy,\n          methods,\n          refs,\n          $refs: () => Utils.dom.findRefs($app),\n          $app,\n        };\n\n        scope.methods = Utils.bind(scope.methods, scope);\n        scope.refs = Utils.bind(scope.refs, scope);\n\n        function _checkForMethod($el, status) {\n          const method = $el.getAttribute(\"method\");\n          if (method) {\n            const [eventType, methodName] = method.includes(\":\") ? method.split(\":\") : `click:${method}`.split(\":\");\n            if (status === \"attached\") $el.addEventListener(eventType, scope.methods[methodName]);\n            else $el.removeEventListener(eventType, scope.methods[methodName]);\n          }\n        }\n\n        const observer = new MutationObserver(mutationList => {\n          mutationList.forEach(({ addedNodes, removedNodes }) => {\n            addedNodes.forEach($node => {\n              if ($node.nodeType === Node.TEXT_NODE) return;\n              _checkForMethod($node, \"attached\");\n              $node.querySelectorAll(\"[method]\").forEach($node => _checkForMethod($node, \"attached\"));\n            });\n\n            removedNodes.forEach($node => {\n              if ($node.nodeType === Node.TEXT_NODE) return;\n              _checkForMethod($node, \"detached\");\n              $node.querySelectorAll(\"[method]\").forEach($node => _checkForMethod($node, \"detached\"));\n            });\n          });\n        });\n\n        observer.observe($app, {\n          childList: true,\n          attributes: true,\n          subtree: true,\n        });\n\n        $app.innerHTML = templateFn(proxy);\n      },\n    };\n  },\n};\n"],"names":["styles","warn","log","_msg","type","msg","payloads","str","template","loc","lines","split","slice","start","line","end","leadingSpaces","Array","length","trim","join","trimmed","map","replace","_showTpl","splice","includes","forEach","console","error","Error","window","ReBars","trace","groupCollapsed","groupEnd","bind","fail","counter","dom","[object Object]","$target","$active","document","activeElement","ref","getAttribute","contains","scrollTop","scrollLeft","selectionStart","activeRef","$input","this","findRef","isArray","Msg","focus","pos","tagName","setSelectionRange","findRefs","$root","from","querySelectorAll","reduce","obj","$el","key","target","concat","findWatcher","id","querySelector","propStr","props","Object","entries","val","html","hash","tag","$tmp","createElement","innerHTML","stringify","indent","JSON","callback","wait","immediate","timeout","callNow","next","apply","arguments","clearTimeout","setTimeout","scope","keys","bound","shouldRender","path","watch","some","watchPath","pathSegs","every","seg","index","randomId","getKey","pointer","err","data","trackGet","que","_debounced","Utils","debounce","_addToQue","push","proxyData","_buildProxy","raw","tree","Proxy","get","prop","value","Reflect","hasOwnProperty","constructor","name","set","ret","deleteProperty","instance","helpers","store","fn","registerHelper","undefined","class","SafeString","args","pop","eId","ReBarsPath","trap","ProxyTrap","create","root","paths","renders","item","hasKey","render","wrapWatcher","_isEqHtml","html1","html2","reg","RegExp","canPatch","children","hasChanged","app","$shadow","getShadow","$vChilds","$r","$v","replaceWith","cloneNode","remove","$child","appendChild","insertBefore","_insertAt","filter","renderId","handler","stash","recordState","Patch","find","endsWith","style","display","restoreState","refs","methods","Handlebars","templateFn","compile","proxy","ReRender","Helpers","register","$app","$refs","_checkForMethod","status","method","eventType","methodName","addEventListener","removeEventListener","MutationObserver","mutationList","addedNodes","removedNodes","$node","nodeType","Node","TEXT_NODE","observe","childList","attributes","subtree"],"mappings":"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"}