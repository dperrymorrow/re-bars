{"version":3,"file":"re-bars.esm.min.js","sources":["../src/msg.js","../src/utils/index.js","../src/utils/dom.js","../src/constants.js","../src/proxy-trap.js","../src/helpers.js","../src/utils/patch.js","../src/re-render.js","../src/component.js","../src/index.js"],"sourcesContent":["const styles = {\n  warn: \"background: #484915; color: #ffffbe; padding: .1em; font-weight: normal;\",\n  log: \"background: #324645; color:#c9faff; padding: .1em; font-weight: normal;\",\n};\n\nconst _showTpl = ({ template, loc }) => {\n  const lines = template.split(\"\\n\").slice(loc.start.line - 1, loc.end.line);\n  const leadingSpaces = Array(lines[0].length - lines[0].trim().length).join(\" \");\n  const trimmed = lines.map(line => line.replace(leadingSpaces, \"      \"));\n  trimmed[0] = `>>>> ${trimmed[0].trim()}`;\n\n  return `\n  template line: ${loc.start.line}\n  ============================================\n  ${trimmed.join(\"\\n\")}\n  `;\n};\n\nconst _msg = (type, msg, ...payloads) => {\n  let str = msg;\n  if (typeof payloads[0] === \"object\" && \"template\" in payloads[0] && \"loc\" in payloads[0]) {\n    str += _showTpl(payloads[0]);\n    payloads.splice(0, 1);\n  }\n\n  if ([\"warn\", \"log\"].includes(type)) {\n    str = \"%c \" + str + \" \";\n    if (!window.ReBars || !window.ReBars.trace) return;\n    if (payloads) {\n      console.groupCollapsed(str, styles[type]);\n      payloads.forEach(console.log);\n      console.groupEnd();\n    } else {\n      console.log(str, styles[type]);\n    }\n  } else {\n    payloads.forEach(console.error);\n    throw new Error(str);\n  }\n};\n\nexport default {\n  warn: _msg.bind(null, \"warn\"),\n  fail: _msg.bind(null, \"throw\"),\n  log: _msg.bind(null, \"log\"),\n};\n","let counter = 1;\n\nimport Dom from \"./dom.js\";\nimport Msg from \"../msg.js\";\n\nexport default {\n  dom: Dom,\n\n  stringify(obj, indent = 2) {\n    const parser = (key, val) => (typeof val === \"function\" ? val + \"\" : val);\n    return JSON.stringify(obj, parser, indent);\n  },\n\n  debounce(callback, wait = 0, immediate = false) {\n    let timeout = null;\n\n    return function() {\n      const callNow = immediate && !timeout;\n      const next = () => callback.apply(this, arguments);\n\n      clearTimeout(timeout);\n      timeout = setTimeout(next, wait);\n\n      if (callNow) {\n        next();\n      }\n    };\n  },\n\n  isProp(target) {\n    if (typeof target === \"string\" && target.startsWith(\"$props\")) return true;\n    else if (typeof target === \"object\" && target.ReBarsPath.startsWith(\"$props\")) return true;\n    return false;\n  },\n\n  shouldRender(path, watch) {\n    const watchPaths = Array.isArray(watch) ? watch : [watch];\n    return watchPaths.some(watchPath => {\n      if (path === watchPath || watchPath === \".*\") return true;\n\n      const pathSegs = path.split(\".\");\n      const watchSegs = watchPath.split(\".\");\n\n      return watchSegs.every((seg, index) => {\n        if (seg === pathSegs[index] || seg === \"*\") return true;\n        return false;\n      });\n    });\n  },\n\n  randomId: () => `rbs${counter++}`,\n\n  getKey(obj, path) {\n    return path.split(\".\").reduce((pointer, key) => {\n      if (!(key in pointer)) Msg.fail(`${path} was not found in object`, obj);\n      return pointer[key];\n    }, obj);\n  },\n\n  hasKey(obj, path) {\n    // cannot traverse it if wildcards are used\n    if (path.includes(\"*\")) return true;\n    try {\n      this.getKey(obj, path);\n      return true;\n    } catch (err) {\n      return false;\n    }\n  },\n\n  setKey(obj, path, val) {\n    const arr = path.split(\".\");\n    arr.reduce((pointer, key, index) => {\n      if (!(key in pointer)) Msg.fail(`${path} was not found in object!`, obj);\n      if (index + 1 === arr.length) pointer[key] = val;\n      return pointer[key];\n    }, obj);\n  },\n};\n","import Msg from \"../msg.js\";\n\nexport default {\n  tagComponent(id, html, name) {\n    const $tmp = this.getShadow(html);\n    const $root = $tmp.firstElementChild;\n\n    if (!$root) throw new Error(\"there was no root node. Components need a root element.\");\n    if ([\"P\"].includes($root.nodeName))\n      Msg.fail(`${name}: <${$root.nodeName.toLowerCase()}> cannot be a root element of for a component, try a <div>`);\n    if ($tmp.children.length > 1) Msg.fail(`${name}: multiple root nodes are not allowed for a component.`);\n    if ($root.dataset.rbsWatch) Msg.fail(`${name}: cannot have a watch as the root node of a component`);\n\n    $root.dataset.rbsComp = id;\n    const content = $tmp.innerHTML;\n    return content;\n  },\n\n  recordState($target) {\n    const $active = document.activeElement;\n    const ref = $active.getAttribute(\"ref\");\n\n    if (!$target.contains($active) || !ref) return null;\n    return {\n      ref,\n      scrollTop: $active.scrollTop,\n      scrollLeft: $active.scrollLeft,\n      selectionStart: $active.selectionStart,\n    };\n  },\n\n  restoreState($target, activeRef) {\n    if (!activeRef) return;\n\n    const $input = this.findRef($target, activeRef.ref);\n    if (!$input) return;\n\n    if (Array.isArray($input)) {\n      Msg.warn(\n        `ref=\"${activeRef.ref}\" is used more than once. Focus cannot be restored. If using bind, add a ref=\"uniqeName\" to each usage`,\n        $input\n      );\n    } else {\n      $input.focus();\n      if (activeRef.selectionStart) {\n        const pos = $input.tagName === \"TEXTAREA\" ? activeRef.selectionStart : activeRef.selectionStart + 1;\n        $input.setSelectionRange(pos, pos);\n      }\n\n      $input.scrollTop = activeRef.scrollTop;\n      $input.scrollLeft = activeRef.scrollLeft;\n    }\n  },\n\n  findComponent: id => document.querySelector(`[data-rbs-comp=\"${id}\"]`),\n\n  findRef: ($target, ref) => {\n    if ($target.getAttribute(\"ref\") === ref) return $target;\n    return $target.querySelector(`[ref=\"${ref}\"]`);\n  },\n\n  findRefs(cId) {\n    const $root = this.findComponent(cId);\n    const $refs = Array.from($root.querySelectorAll(\"[ref]\"));\n    if ($root.getAttribute(\"ref\")) $refs.push($root);\n\n    return $refs.reduce((obj, $el) => {\n      const key = $el.getAttribute(\"ref\");\n      const target = obj[key];\n      obj[key] = target ? [target].concat($el) : $el;\n      return obj;\n    }, {});\n  },\n\n  findWatcher: id => document.querySelector(`[data-rbs-watch=\"${id}\"]`),\n\n  propStr: props =>\n    Object.entries(props)\n      .map(([key, val]) => {\n        if (typeof val === \"number\") return `${key}=${val}`;\n        else return `${key}=\"${val}\"`;\n      })\n      .join(\" \"),\n\n  wrapWatcher(id, html, hash) {\n    const { tag, ...props } = { ...{ tag: \"span\" }, ...hash };\n    const propStr = this.propStr(props);\n    const style = !html.length ? \"style='display:none;'\" : \"\";\n    return `<${tag} ${propStr} ${style} data-rbs-watch=\"${id}\">${html}</${tag}>`;\n  },\n\n  getShadow(html) {\n    const $tmp = document.createElement(\"div\");\n    $tmp.innerHTML = html;\n    return $tmp;\n  },\n};\n","export default {\n  protectedKeys: [\"$_componentId\", \"$props\", \"$methods\", \"$name\", \"$parent\", \"$listeners\"],\n  listenerPrefix: \"listen:\",\n};\n","import Utils from \"./utils/index.js\";\nimport Constants from \"./constants.js\";\nimport Msg from \"./msg.js\";\n\nexport default {\n  create(data, callback, trackGet = false) {\n    let que = [];\n\n    const _debounced = Utils.debounce(() => {\n      callback(que);\n      que = [];\n    });\n\n    const _addToQue = path => {\n      que.push(path);\n      _debounced(que);\n    };\n\n    function _buildProxy(raw, tree = []) {\n      return new Proxy(raw, {\n        get: function(target, prop) {\n          if (prop === \"ReBarsPath\") return tree.join(\".\");\n          const value = Reflect.get(...arguments);\n          if (typeof value === \"function\" && target.hasOwnProperty(prop)) return value.bind(proxyData);\n          // we dont watch any of the protected items\n          if (Constants.protectedKeys.includes(tree[0])) return value;\n          else if (trackGet) _addToQue(tree.concat(prop).join(\".\"));\n          if (value !== null && typeof value === \"object\" && prop !== \"methods\")\n            return _buildProxy(value, tree.concat(prop));\n          else return value;\n        },\n\n        set: function(target, prop) {\n          const ret = Reflect.set(...arguments);\n          const path = tree.concat(prop).join(\".\");\n          // we dont trigger on protected keys\n          if (Constants.protectedKeys.includes(tree[0]))\n            Msg.warn(`attempted to set a protected key \"${path}\". readOnly properties are ${Constants.protectedKeys}`);\n          else _addToQue(path);\n          return ret;\n        },\n\n        deleteProperty: function(target, prop) {\n          const ret = Reflect.deleteProperty(...arguments);\n          const path = tree.concat(prop).join(\".\");\n          if (Constants.protectedKeys.includes(tree[0]))\n            Msg.fail(`cannot delete protected key ${path}. readOnly properties are ${Constants.protectedKeys}`);\n          else _addToQue(path);\n          return ret;\n        },\n      });\n    }\n\n    const proxyData = _buildProxy(data);\n    return proxyData;\n  },\n};\n","import Msg from \"./msg.js\";\nimport Utils from \"./utils/index.js\";\nimport ProxyTrap from \"./proxy-trap.js\";\nimport Constants from \"./constants.js\";\n\nexport default {\n  register({ app, instance, components, helpers, template, methods, name }) {\n    Object.entries(helpers).forEach(([name, fn]) => instance.registerHelper(name, fn));\n    instance.registerHelper(\"isComponent\", cName => Object.keys(components).includes(cName));\n\n    instance.registerHelper(\"component\", function(...args) {\n      const { hash, loc, data } = args.pop();\n\n      const cName = args[0];\n      if (!components[cName]) Msg.fail(`${name}: child component \"${cName}\" is not registered`, { template, loc });\n\n      // validate the props, add the passed methods after you bind them or you will loose scope\n      Object.entries(hash).forEach(([key, value]) => {\n        if (value === undefined) {\n          Msg.fail(\n            `${name}: passed \"${key}\" as undefined. If you really meant to, pass null instead.`,\n            {\n              template,\n              loc,\n            },\n            hash\n          );\n        }\n      });\n      // make sure all the listeners are good\n      Object.keys(hash)\n        .filter(key => key.startsWith(Constants.listenerPrefix))\n        .forEach(key => {\n          const methodName = hash[key];\n          if (!(methodName in data.root.$methods))\n            Msg.fail(\n              `${name}: listener \"${methodName}\" was not found in the ${name}'s methods.`,\n              { template, loc },\n              hash\n            );\n          else hash[key] = data.root.$methods[methodName];\n        });\n\n      return new instance.SafeString(components[cName].instance(hash).render());\n    });\n\n    instance.registerHelper(\"debug\", (obj, { hash, data, loc }) => {\n      if (obj === undefined) Msg.fail(`${name}: undefined passed to debug`, { template, loc });\n      const props = { class: \"debug\", ...hash };\n      return new instance.SafeString(`<pre ${Utils.dom.propStr(props)}>${Utils.stringify(obj)}</pre>`);\n    });\n\n    instance.registerHelper(\"watch\", function(...args) {\n      const { fn, hash, data, loc } = args.pop();\n      const instId = data.root.$_componentId;\n      const eId = Utils.randomId();\n\n      const _getPath = target => {\n        if (target === undefined) Msg.fail(`${name}: undefined cannot be watched`, { template, loc });\n\n        if (Utils.isProp(target))\n          Msg.fail(\n            `${name}: Do not watch $props. Each component has its own Proxy so the child will not get the update. Instead watch the item in the parent, and re-render the child component`,\n            { template, loc }\n          );\n\n        return typeof target === \"object\" ? `${target.ReBarsPath}.*` : target;\n      };\n\n      const path = args.map(_getPath);\n      const renders = app.components.instances[instId].renders;\n\n      if (!path.length) {\n        const trap = ProxyTrap.create(\n          data.root,\n          paths => {\n            renders[eId].path = paths;\n          },\n          true\n        );\n\n        fn(trap);\n      }\n\n      path.forEach(item => {\n        if (!Utils.hasKey(data.root, item)) Msg.fail(`${name}: cannot find path \"${item}\" to watch`, { template, loc });\n      });\n\n      renders[eId] = {\n        path,\n        render: () => fn(this),\n      };\n\n      return Utils.dom.wrapWatcher(eId, fn(this), hash);\n    });\n\n    instance.registerHelper(\"method\", function() {\n      const [str, ...args] = arguments;\n      const [methodName, type = \"click\"] = str.split(\":\");\n      const { data, loc } = args.pop();\n\n      if (!(methodName in methods) && methodName !== \"$emit\")\n        Msg.fail(`${name}: \"${methodName}\" is not a method`, { template, loc });\n\n      const props = { \"data-rbs-method\": [data.root.$_componentId, type, methodName] };\n      if (args && args.length) props[\"data-rbs-method\"] = props[\"data-rbs-method\"].concat(args);\n      return new instance.SafeString(Utils.dom.propStr(props));\n    });\n\n    instance.registerHelper(\"bound\", (path, { hash = {}, data, loc }) => {\n      const params = [data.root.$_componentId, path];\n      if (!Utils.hasKey(data.root, path)) Msg.fail(`${name}: does not have path \"${path}\"`, { template, loc });\n\n      const props = {\n        value: Utils.getKey(data.root, path),\n        ref: hash.ref || path,\n        \"data-rbs-bound\": params,\n      };\n\n      return new instance.SafeString(Utils.dom.propStr(props));\n    });\n  },\n};\n","import Utils from \"./index.js\";\n\nfunction _isEqHtml(html1, html2) {\n  const reg = new RegExp(/data-rbs(.*?)=\"(.*?)\"/g);\n  return html1.replace(reg, \"\") === html2.replace(reg, \"\");\n}\n\nfunction _insertAt($target, $child, index = 0) {\n  if (index >= $target.children.length) $target.appendChild($child);\n  else $target.insertBefore($child, $target.children[index]);\n}\n\nexport default {\n  canPatch: $target =>\n    $target.children.length &&\n    $target.children.length > 1 &&\n    Array.from($target.children).every($el => $el.getAttribute(\"ref\")),\n  hasChanged: ($target, html) => !_isEqHtml($target.innerHTML, html),\n\n  compare({ app, $target, html }) {\n    const $shadow = Utils.dom.getShadow(html);\n    const $vChilds = Array.from($shadow.children);\n\n    // deletes and updates\n    Array.from($target.children).forEach($r => {\n      const $v = Utils.dom.findRef($shadow, $r.getAttribute(\"ref\"));\n      if (!$v) $r.remove();\n      else if (!_isEqHtml($v.innerHTML, $r.innerHTML)) $r.replaceWith($v.cloneNode(true));\n    });\n\n    // additions\n    $vChilds.forEach(($v, index) => {\n      const $r = Utils.dom.findRef($target, $v.getAttribute(\"ref\"));\n      if (!$r) _insertAt($target, $v.cloneNode(true), index);\n    });\n\n    // sorting\n    $vChilds.forEach(($v, index) => {\n      const $r = $target.children[index];\n      if ($r.getAttribute(\"ref\") !== $v.getAttribute(\"ref\")) $r.replaceWith($v.cloneNode(true));\n    });\n  },\n};\n","import Utils from \"./utils/index.js\";\nimport Msg from \"./msg.js\";\nimport Patch from \"./utils/patch.js\";\n\nexport default {\n  paths({ app, paths, renders, name }) {\n    Object.entries(renders)\n      .filter(([renderId, handler]) => {\n        const matches = paths.some(path => Utils.shouldRender(path, handler.path));\n        return matches && Utils.dom.findWatcher(renderId);\n      })\n      .forEach(([renderId, handler]) => {\n        const $target = Utils.dom.findWatcher(renderId);\n        const html = handler.render();\n        const stash = Utils.dom.recordState($target);\n\n        if (!Patch.hasChanged($target, html)) return;\n\n        if (Patch.canPatch($target)) {\n          Patch.compare({ app, $target, html });\n          Msg.log(`${name}: patching ${handler.path}`, $target);\n          Utils.dom.restoreState($target, stash);\n          return;\n        }\n\n        // warn for not having a ref on array update\n        const lenPath = handler.path.find(path => path.endsWith(\".length\"));\n        if (lenPath)\n          Msg.warn(\n            `${name}: patching \"${handler.path}\" add a ref=\"someUniqueKey\" to each to avoid re-rendering the entire Array of elements`,\n            $target\n          );\n\n        $target.style.display = html === \"\" ? \"none\" : \"\";\n        $target.innerHTML = html;\n\n        Utils.dom.restoreState($target, stash);\n        Msg.log(`${name}: re-rendering watch block for ${handler.path}`, $target);\n      });\n\n    app.deleteOrphans();\n  },\n};\n","import Utils from \"./utils/index.js\";\nimport ProxyTrap from \"./proxy-trap.js\";\nimport Helpers from \"./helpers.js\";\nimport ReRender from \"./re-render.js\";\nimport Constants from \"./constants.js\";\nimport Msg from \"./msg.js\";\n\nconst restricted = [\"component\", \"ref\", \"debug\", \"isComponent\", \"method\", \"bound\", \"watch\", \"isComponent\"];\n\n// too much destructuring making it confusting with colliding names\nfunction register(\n  { id: appId, Handlebars, trace, helpers: globalHelpers, components: globalComponents },\n  { name, template, data = () => ({}), helpers = {}, hooks = {}, methods = {}, watchers = {}, components = [] }\n) {\n  const compDef = arguments[0];\n\n  if (!name) Msg.fail(\"Every ReBars component should have a name!\", compDef);\n  if (typeof data !== \"function\") Msg.fail(`${name}: component data must be a function`, compDef);\n  if (typeof template !== \"string\") Msg.fail(\"`${name}: needs a template string`\", compDef);\n\n  const app = arguments[0];\n  const instance = Handlebars.create();\n  const templateFn = instance.compile(template);\n\n  const regComps = components.reduce(\n    (regs, def) => {\n      const reg = register(app, def);\n      regs[def.name] = reg;\n      return regs;\n    },\n    { ...globalComponents.registered }\n  );\n\n  Object.keys(data()).forEach(key => {\n    if (restricted.concat(Object.keys(helpers)).includes(key))\n      Msg.fail(`${name}: cannot use \"${key}\" in your data as it's defined as a helper`, compDef);\n  });\n\n  Helpers.register({\n    app,\n    methods,\n    instance,\n    name,\n    helpers: { ...helpers, ...globalHelpers },\n    components: regComps,\n    template,\n  });\n\n  return {\n    instance($props = {}) {\n      const id = Utils.randomId();\n      const instData = data();\n      const renders = {};\n\n      const $listeners = Object.entries($props).reduce((listeners, [key, handler]) => {\n        if (key.startsWith(Constants.listenerPrefix)) {\n          listeners[key.replace(Constants.listenerPrefix, \"\")] = handler;\n          $props[key].delete;\n        }\n        return listeners;\n      }, {});\n\n      let hasCreated = false;\n\n      const scope = ProxyTrap.create(\n        {\n          ...instData,\n          ...{\n            $props,\n            $methods: methods,\n            $listeners,\n            $emit: (key, data = {}) => {\n              if ($listeners[key]) $listeners[key](data);\n            },\n            $name: name,\n            $_componentId: id,\n            $el: () => Utils.dom.findComponent(id),\n            $refs: () => Utils.dom.findRefs(id),\n          },\n        },\n        paths => {\n          if (!hasCreated) return;\n          Msg.log(`${name}: data changed \"${paths}\"`, renders);\n          // watchers...\n          Object.entries(watchers)\n            .reduce((capture, [key, handler]) => {\n              if (paths.some(path => Utils.shouldRender(path, key.split(\",\")))) capture.push(handler);\n              return capture;\n            }, [])\n            .forEach(handler => handler.call(scope));\n\n          ReRender.paths({ app, paths, renders, name });\n        }\n      );\n\n      if (hooks.created) hooks.created.call(scope);\n\n      // gotta delay this or it will fire immediately, before the que triggers\n      Utils.debounce(() => {\n        hasCreated = true;\n      })();\n\n      const compInst = {\n        id,\n        scope,\n        hooks,\n        renders,\n        handlers: {\n          bound(event) {\n            const [id, path] = event.currentTarget.dataset.rbsBound.split(\",\");\n            Utils.setKey(scope, path, event.target.value);\n          },\n          method(event) {\n            const [id, type, method, ...args] = event.currentTarget.dataset.rbsMethod.split(\",\");\n            if (method === \"$emit\") scope.$emit(args[0], scope[args[0]]);\n            else scope.$methods[method](event, ...args);\n          },\n        },\n        detached() {\n          if (hooks.detached) hooks.detached.call(scope);\n        },\n        attached() {\n          if (hooks.attached) hooks.attached.call(scope);\n        },\n        render() {\n          return Utils.dom.tagComponent(id, templateFn(scope), name);\n        },\n      };\n\n      app.components.instances[id] = compInst;\n      return compInst;\n    },\n  };\n}\n\nexport default {\n  register,\n};\n","import Utils from \"./utils/index.js\";\nimport Component from \"./component.js\";\nimport Msg from \"./msg.js\";\n\nexport default {\n  app({ $el, root, Handlebars = window.Handlebars, helpers = {}, components = [], trace = false }) {\n    if (!Handlebars) Msg.fail(\"noHbs\");\n    if (!document.body.contains($el))\n      Msg.fail(\"$el passed to ReBars app is either undefined or not present in the document.\");\n\n    window.ReBars = window.ReBars || {};\n    window.ReBars.trace = trace;\n\n    const app = {\n      id: Utils.randomId(),\n      Handlebars,\n      trace,\n      helpers,\n      $el,\n      // needs debounced to make sure we are all done\n      deleteOrphans: Utils.debounce(() => {\n        Object.keys(app.components.instances).forEach(id => {\n          if (!Utils.dom.findComponent(id)) delete app.components.instances[id];\n        });\n      }),\n\n      components: {\n        registered: {},\n        instances: {},\n      },\n    };\n\n    app.components.registered = components.reduce((regs, def) => {\n      regs[def.name] = Component.register(app, def);\n      return regs;\n    }, {});\n\n    function _comp(action, $el) {\n      const method = action === \"add\" ? \"attached\" : \"detached\";\n      const cId = $el.dataset.rbsComp;\n      app.components.instances[cId][method]();\n    }\n    function _method(action, $method) {\n      const method = action === \"add\" ? \"addEventListener\" : \"removeEventListener\";\n      const [cId, type] = $method.dataset.rbsMethod.split(\",\");\n      $method[method](type, app.components.instances[cId].handlers.method);\n    }\n    function _bound(action, $bound) {\n      const method = action === \"add\" ? \"addEventListener\" : \"removeEventListener\";\n      const [cId, path] = $bound.dataset.rbsBound.split(\",\");\n      $bound[method](\"input\", app.components.instances[cId].handlers.bound);\n    }\n\n    const observer = new MutationObserver(mutationList => {\n      mutationList.forEach(({ addedNodes, removedNodes }) => {\n        addedNodes.forEach($node => {\n          if ($node.nodeType === Node.TEXT_NODE) return;\n\n          if ($node.dataset.rbsComp) _comp(\"add\", $node);\n          if ($node.dataset.rbsMethod) _method(\"add\", $node);\n          if ($node.dataset.rbsBound) _bound(\"add\", $node);\n\n          $node.querySelectorAll(\"[data-rbs-comp]\").forEach(_comp.bind(null, \"add\"));\n          $node.querySelectorAll(\"[data-rbs-method]\").forEach(_method.bind(null, \"add\"));\n          $node.querySelectorAll(\"[data-rbs-bound]\").forEach(_bound.bind(null, \"add\"));\n        });\n\n        removedNodes.forEach($node => {\n          if ($node.nodeType === Node.TEXT_NODE) return;\n\n          if ($node.dataset.rbsMethod) _method(\"remove\", $node);\n          if ($node.dataset.rbsBound) _bound(\"remove\", $node);\n          if ($node.dataset.rbsComp) _comp(\"remove\", $node);\n\n          $node.querySelectorAll(\"[data-rbs-method]\").forEach(_method.bind(null, \"remove\"));\n          $node.querySelectorAll(\"[data-rbs-bound]\").forEach(_bound.bind(null, \"remove\"));\n          $node.querySelectorAll(\"[data-rbs-comp]\").forEach(_comp.bind(null, \"remove\"));\n        });\n      });\n    });\n\n    observer.observe($el, {\n      childList: true,\n      attributes: true,\n      subtree: true,\n    });\n\n    $el.innerHTML = Component.register(app, root)\n      .instance()\n      .render();\n    return app;\n  },\n};\n"],"names":["styles","warn","log","_msg","type","msg","payloads","str","template","loc","lines","split","slice","start","line","end","leadingSpaces","Array","length","trim","join","trimmed","map","replace","_showTpl","splice","includes","forEach","console","error","Error","window","ReBars","trace","groupCollapsed","groupEnd","bind","fail","counter","dom","[object Object]","id","html","name","$tmp","this","getShadow","$root","firstElementChild","nodeName","Msg","toLowerCase","children","dataset","rbsWatch","rbsComp","innerHTML","$target","$active","document","activeElement","ref","getAttribute","contains","scrollTop","scrollLeft","selectionStart","activeRef","$input","findRef","isArray","focus","pos","tagName","setSelectionRange","findComponent","querySelector","cId","$refs","from","querySelectorAll","push","reduce","obj","$el","key","target","concat","findWatcher","propStr","props","Object","entries","val","hash","tag","createElement","stringify","indent","JSON","callback","wait","immediate","timeout","callNow","next","apply","arguments","clearTimeout","setTimeout","isProp","startsWith","ReBarsPath","shouldRender","path","watch","some","watchPath","pathSegs","every","seg","index","randomId","getKey","pointer","err","arr","protectedKeys","listenerPrefix","data","trackGet","que","_debounced","Utils","debounce","_addToQue","proxyData","_buildProxy","raw","tree","Proxy","get","prop","value","Reflect","hasOwnProperty","Constants","set","ret","deleteProperty","app","instance","components","helpers","methods","fn","registerHelper","cName","keys","args","pop","undefined","filter","methodName","root","$methods","SafeString","render","class","instId","$_componentId","eId","renders","instances","trap","ProxyTrap","create","paths","item","hasKey","wrapWatcher","data-rbs-method","params","data-rbs-bound","_isEqHtml","html1","html2","reg","RegExp","canPatch","hasChanged","$shadow","$vChilds","$r","$v","replaceWith","cloneNode","remove","$child","appendChild","insertBefore","_insertAt","renderId","handler","stash","recordState","Patch","compare","restoreState","find","endsWith","style","display","deleteOrphans","restricted","register","appId","Handlebars","globalHelpers","globalComponents","hooks","watchers","compDef","templateFn","compile","regComps","regs","def","registered","Helpers","$props","instData","$listeners","listeners","delete","hasCreated","scope","$emit","$name","findRefs","capture","call","ReRender","created","compInst","handlers","event","currentTarget","rbsBound","setKey","method","rbsMethod","detached","attached","tagComponent","body","_comp","action","_method","$method","_bound","$bound","bound","Component","MutationObserver","mutationList","addedNodes","removedNodes","$node","nodeType","Node","TEXT_NODE","observe","childList","attributes","subtree"],"mappings":"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"}