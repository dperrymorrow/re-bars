{"version":3,"file":"re-bars.esm.min.js","sources":["../src/config.js","../src/utils/dom.js","../src/utils/index.js","../src/proxy-trap.js","../src/helpers.js","../src/utils/patch.js","../src/re-render.js","../src/app.js"],"sourcesContent":["let isTracing = false;\n\nexport default {\n  logLevel: () => (isTracing ? 1 : 0),\n  setTrace: val => (isTracing = val),\n\n  attrs: {\n    watch: \"rbs-watch\",\n    method: \"rbs-method\",\n    ref: \"rbs-ref\",\n  },\n};\n","import Config from \"../config.js\";\nconst { attrs } = Config;\n\nexport default {\n  recordState($target) {\n    const $active = document.activeElement;\n    const ref = $active.getAttribute(attrs.ref);\n\n    if (!$target.contains($active) || !ref) return null;\n    return {\n      ref,\n      scrollTop: $active.scrollTop,\n      scrollLeft: $active.scrollLeft,\n      selectionStart: $active.selectionStart,\n    };\n  },\n\n  // getMethodArr($el) {\n  //   const attr = $el.getAttribute(attrs.method);\n  //   return attr ? JSON.parse(attr) : null;\n  // },\n\n  restoreState($target, activeRef) {\n    if (!activeRef) return;\n\n    const $input = this.findRef($target, activeRef.ref);\n    if (!$input) return;\n\n    $input.focus();\n    if (activeRef.selectionStart) {\n      const pos = $input.tagName === \"TEXTAREA\" ? activeRef.selectionStart : activeRef.selectionStart + 1;\n      $input.setSelectionRange(pos, pos);\n    }\n\n    $input.scrollTop = activeRef.scrollTop;\n    $input.scrollLeft = activeRef.scrollLeft;\n  },\n\n  findRef: ($target, ref) => {\n    if ($target.getAttribute(attrs.ref) === ref) return $target;\n    return $target.querySelector(`[${attrs.ref}=\"${ref}\"]`);\n  },\n\n  findRefs($root) {\n    const { ref } = attrs;\n    const $refs = Array.from($root.querySelectorAll(`[${ref}]`));\n\n    return $refs.reduce((obj, $el) => {\n      const key = $el.getAttribute(ref);\n      const target = obj[key];\n      obj[key] = target ? [target].concat($el) : $el;\n      return obj;\n    }, {});\n  },\n\n  findMethod: id => document.querySelector(`[${attrs.method}=\"${id}\"]`),\n  findWatcher: id => document.querySelector(`[${attrs.watch}=\"${id}\"]`),\n\n  propStr: props =>\n    Object.entries(props)\n      .map(([key, val]) => {\n        if (typeof val === \"number\") return `${key}=${val}`;\n        else return `${key}=\"${val}\"`;\n      })\n      .join(\" \"),\n\n  wrapWatcher(id, html, hash) {\n    const { tag, ...props } = { ...{ tag: \"span\" }, ...hash };\n    const propStr = this.propStr(props);\n    const style = !html.length ? \"style='display:none;'\" : \"\";\n    return `<${tag} ${propStr} ${style} ${attrs.watch}=\"${id}\">${html}</${tag}>`;\n  },\n\n  getShadow(html) {\n    const $tmp = document.createElement(\"div\");\n    $tmp.innerHTML = html;\n    return $tmp;\n  },\n};\n","let counter = 1;\n\nimport Dom from \"./dom.js\";\n// import Msg from \"../msg.js\";\n\nexport default {\n  dom: Dom,\n\n  // stringify(obj, indent = 2) {\n  //   const parser = (key, val) => (typeof val === \"function\" ? val + \"\" : val);\n  //   return JSON.stringify(obj, parser, indent);\n  // },\n\n  debounce(callback, wait = 0, immediate = false) {\n    let timeout = null;\n\n    return function() {\n      const callNow = immediate && !timeout;\n      const next = () => callback.apply(this, arguments);\n\n      clearTimeout(timeout);\n      timeout = setTimeout(next, wait);\n\n      if (callNow) {\n        next();\n      }\n    };\n  },\n\n  intersects: (obj1, obj2) => Object.keys(obj2).filter(key => key in obj1),\n\n  registerHelpers(instance, helpers) {\n    Object.entries(helpers).forEach(([name, fn]) => instance.registerHelper(name, fn));\n  },\n\n  registerPartials(instance, scope, partials) {\n    Object.entries(partials).forEach(([name, partial]) => {\n      instance.registerPartial(name, partial.template);\n\n      [\"methods\", \"partials\", \"data\"].forEach(key => {\n        if (!(key in partial)) return;\n        const collide = this.intersects(scope[key], partial[key]);\n        if (collide.length) instance.log(2, `ReBars: partial ${name} has conflicting ${key} keys`, collide);\n      });\n\n      if (partial.data) Object.assign(partial.data, scope.data);\n      if (partial.methods) Object.assign(scope.methods, partial.methods);\n      if (partial.helpers) this.registerHelpers(instance, partial.helpers);\n    });\n  },\n\n  bind(obj, scope, ...args) {\n    return Object.keys(obj).reduce(\n      (bound, key) => {\n        bound[key] = bound[key].bind(scope, ...args);\n        return bound;\n      },\n      { ...obj }\n    );\n  },\n\n  shouldRender(path, watch) {\n    const watchPaths = Array.isArray(watch) ? watch : [watch];\n    return watchPaths.some(watchPath => {\n      if (path === watchPath || watchPath === \".*\") return true;\n\n      const pathSegs = path.split(\".\");\n      const watchSegs = watchPath.split(\".\");\n\n      return watchSegs.every((seg, index) => {\n        if (seg === pathSegs[index] || seg === \"*\") return true;\n        return false;\n      });\n    });\n  },\n\n  randomId: () => `rbs${counter++}`,\n\n  // getKey(obj, path) {\n  //   return path.split(\".\").reduce((pointer, key) => {\n  //     if (!(key in pointer)) Msg.fail(`${path} was not found in object`, obj);\n  //     return pointer[key];\n  //   }, obj);\n  // },\n  //\n  // hasKey(obj, path) {\n  //   // cannot traverse it if wildcards are used\n  //   if (path.includes(\"*\")) return true;\n  //   try {\n  //     this.getKey(obj, path);\n  //     return true;\n  //   } catch (err) {\n  //     return false;\n  //   }\n  // },\n  //\n  // setKey(obj, path, val) {\n  //   const arr = path.split(\".\");\n  //   arr.reduce((pointer, key, index) => {\n  //     if (!(key in pointer)) Msg.fail(`${path} was not found in object!`, obj);\n  //     if (index + 1 === arr.length) pointer[key] = val;\n  //     return pointer[key];\n  //   }, obj);\n  // },\n};\n","import Utils from \"./utils/index.js\";\n\nexport default {\n  create(data, callback, trackGet = false) {\n    let que = [];\n\n    const _debounced = Utils.debounce(() => {\n      callback(que);\n      que = [];\n    });\n\n    const _addToQue = path => {\n      if (!que.includes(path)) que.push(path);\n      _debounced(que);\n    };\n\n    function _buildProxy(raw, tree = []) {\n      return new Proxy(raw, {\n        get: function(target, prop) {\n          if (prop === \"ReBarsPath\") return tree.join(\".\");\n          const value = Reflect.get(...arguments);\n\n          if (value && typeof value === \"object\" && [\"Array\", \"Object\"].includes(value.constructor.name)) {\n            return _buildProxy(value, tree.concat(prop));\n          } else {\n            if (trackGet) _addToQue(tree.concat(prop).join(\".\"));\n            return value;\n          }\n        },\n\n        set: function(target, prop) {\n          const ret = Reflect.set(...arguments);\n          const path = tree.concat(prop).join(\".\");\n          _addToQue(path);\n          return ret;\n        },\n\n        deleteProperty: function(target, prop) {\n          const ret = Reflect.deleteProperty(...arguments);\n          const path = tree.concat(prop).join(\".\");\n          _addToQue(path);\n          return ret;\n        },\n      });\n    }\n\n    const proxyData = _buildProxy(data);\n    return proxyData;\n  },\n};\n","// import Msg from \"./msg.js\";\nimport Utils from \"./utils/index.js\";\nimport ProxyTrap from \"./proxy-trap.js\";\nimport Config from \"./config.js\";\n\nconst { attrs } = Config;\n\nexport default {\n  register({ instance, template, store, scope }) {\n    instance.registerHelper(\"ref\", name => new instance.SafeString(`${attrs.ref}=\"${name}\"`));\n    instance.registerHelper(\"buildPath\", function(...args) {\n      args.pop();\n      return Array.from(args).join(\".\");\n    });\n\n    instance.registerHelper(\"on\", function(...args) {\n      const { loc } = args.pop();\n      const id = Utils.randomId();\n      const [eventType, methodName, ...rest] = args;\n      const tplScope = this;\n      // check for method existance\n      if (!(args[1] in scope.methods)) instance.log(3, `ReBars: \"${args[1]}\" is not a method. line: ${loc.start.line}`);\n\n      Utils.debounce(() => {\n        const $el = Utils.dom.findMethod(id);\n        if (!$el) return;\n\n        $el.addEventListener(eventType, event => {\n          const context = {\n            event,\n            $app: scope.$app,\n            $refs: Utils.dom.findRefs.bind(null, scope.$app),\n            rootData: scope.data,\n          };\n\n          context.methods = Utils.bind(scope.methods, tplScope, context);\n          context.methods[methodName](...rest);\n        });\n      })();\n\n      return new instance.SafeString(`${attrs.method}=\"${id}\"`);\n    });\n\n    instance.registerHelper(\"watch\", function(...args) {\n      const last = args.pop();\n      const { fn, hash, data, loc } = last;\n\n      const eId = Utils.randomId();\n\n      const _getPath = target => {\n        if (target === undefined) instance.log(3, \"undefined cannot be watched\", { template, loc });\n        return typeof target === \"object\" ? `${target.ReBarsPath}.*` : target;\n      };\n\n      const path = args.map(_getPath);\n\n      if (!path.length) {\n        const trap = ProxyTrap.create(\n          data.root,\n          paths => {\n            store.renders[eId].path = paths;\n          },\n          true\n        );\n\n        fn(trap);\n      }\n\n      // path.forEach(item => {\n      //   if (!Utils.hasKey(data.root, item)) {\n      //     debugger;\n      //     Msg.fail(`cannot find path \"${item}\" to watch`, { template, loc });\n      //   }\n      // });\n\n      store.renders[eId] = {\n        path,\n        render: () => fn(this),\n      };\n\n      return Utils.dom.wrapWatcher(eId, fn(this), hash);\n    });\n  },\n};\n","import Utils from \"./index.js\";\nimport Config from \"../config.js\";\n\nconst refAttr = Config.attrs.ref;\n\nfunction _isEqHtml(html1, html2) {\n  const reg = new RegExp(/rbs-(.*?)=\"(.*?)\"/g);\n  return html1.replace(reg, \"\") === html2.replace(reg, \"\");\n}\n\nfunction _insertAt($target, $child, index = 0) {\n  if (index >= $target.children.length) $target.appendChild($child);\n  else $target.insertBefore($child, $target.children[index]);\n}\n\nexport default {\n  canPatch: $target =>\n    $target.children.length &&\n    $target.children.length > 1 &&\n    Array.from($target.children).every($el => $el.getAttribute(refAttr)),\n  hasChanged: ($target, html) => !_isEqHtml($target.innerHTML, html),\n\n  compare({ app, $target, html }) {\n    const $shadow = Utils.dom.getShadow(html);\n    const $vChilds = Array.from($shadow.children);\n\n    // deletes and updates\n    Array.from($target.children).forEach($r => {\n      const $v = Utils.dom.findRef($shadow, $r.getAttribute(refAttr));\n      if (!$v) $r.remove();\n      else if (!_isEqHtml($v.innerHTML, $r.innerHTML)) $r.replaceWith($v.cloneNode(true));\n    });\n\n    // additions\n    $vChilds.forEach(($v, index) => {\n      const $r = Utils.dom.findRef($target, $v.getAttribute(refAttr));\n      if (!$r) _insertAt($target, $v.cloneNode(true), index);\n    });\n\n    // sorting\n    $vChilds.forEach(($v, index) => {\n      const $r = $target.children[index];\n      if ($r.getAttribute(\"ref\") !== $v.getAttribute(refAttr)) $r.replaceWith($v.cloneNode(true));\n    });\n  },\n};\n","import Utils from \"./utils/index.js\";\nimport Patch from \"./utils/patch.js\";\nimport Config from \"./config.js\";\n\nexport default {\n  paths({ paths, renders, instance }) {\n    Object.entries(renders)\n      .filter(([renderId, handler]) => {\n        const matches = paths.some(path => Utils.shouldRender(path, handler.path));\n        return matches && Utils.dom.findWatcher(renderId);\n      })\n      .forEach(([renderId, handler]) => {\n        const $target = Utils.dom.findWatcher(renderId);\n        // if we cant find the target, we should not attempt to re-renders\n        // this can probally be cleaned up with clearing orphans on the app\n\n        if (!$target) return;\n\n        const html = handler.render();\n        const stash = Utils.dom.recordState($target);\n\n        if (!Patch.hasChanged($target, html)) return;\n\n        // if (Patch.canPatch($target)) {\n        //   Patch.compare({ app, $target, html });\n        //   Msg.log(`${name}: patching ${handler.path}`, $target);\n        //   Utils.dom.restoreState($target, stash);\n        //   return;\n        // }\n\n        // warn for not having a ref on array update\n        const lenPath = handler.path.find(path => path.endsWith(\".length\"));\n        if (lenPath)\n          instance.log(\n            2,\n            `patching \"${handler.path}\" add a ref=\"someUniqueKey\" to each to avoid re-rendering the entire Array of elements`,\n            $target\n          );\n\n        $target.style.display = html === \"\" ? \"none\" : \"\";\n        $target.innerHTML = html;\n\n        Utils.dom.restoreState($target, stash);\n        instance.log(Config.logLevel(), \"ReBars: render\", handler.path, $target);\n      });\n  },\n};\n","// import Msg from \"./msg.js\";\nimport Helpers from \"./helpers.js\";\nimport ReRender from \"./re-render.js\";\nimport ProxyTrap from \"./proxy-trap.js\";\nimport Utils from \"./utils/index.js\";\nimport Config from \"./config.js\";\n\nexport default {\n  app({\n    helpers = {},\n    template,\n    data = {},\n    refs = {},\n    methods = {},\n    partials = {},\n    Handlebars = window.Handlebars,\n    trace = false,\n  }) {\n    const instance = Handlebars.create();\n    const templateFn = instance.compile(template);\n    const store = { renders: {} };\n\n    Config.setTrace(trace);\n    Utils.registerHelpers(instance, helpers);\n\n    return {\n      store,\n      instance,\n      render($app) {\n        const scope = {\n          $app,\n          methods,\n          data,\n        };\n\n        // TODO: should be able to await nextRender()\n\n        Helpers.register({ instance, template, store, scope });\n        Utils.registerPartials(instance, scope, partials);\n\n        // for the methods\n        scope.data = Object.entries(scope.data).reduce((scoped, [key, value]) => {\n          if (typeof value === \"function\" && scoped.hasOwnProperty(key)) scoped[key] = value.bind(scope);\n          return scoped;\n        }, data);\n\n        scope.data = ProxyTrap.create(data, paths => {\n          instance.log(Config.logLevel(), \"ReBars: change\", paths);\n          ReRender.paths({ paths, renders: store.renders, instance });\n        });\n\n        const observer = new MutationObserver(mutationList => {\n          mutationList.forEach(({ addedNodes, removedNodes }) => {\n            removedNodes.forEach($el => {\n              if ($el.nodeType === Node.TEXT_NODE) return;\n              const watch = $el.getAttribute(Config.attrs.watch);\n              if (watch) delete store.renders[watch];\n            });\n          });\n        });\n\n        observer.observe($app, {\n          childList: true,\n          attributes: true,\n          subtree: true,\n        });\n\n        $app.innerHTML = templateFn(scope.data);\n      },\n    };\n  },\n};\n"],"names":["isTracing","logLevel","setTrace","val","attrs","watch","method","ref","Config","counter","dom","[object Object]","$target","$active","document","activeElement","getAttribute","contains","scrollTop","scrollLeft","selectionStart","activeRef","$input","this","findRef","focus","pos","tagName","setSelectionRange","querySelector","$root","Array","from","querySelectorAll","reduce","obj","$el","key","target","concat","findMethod","id","findWatcher","propStr","props","Object","entries","map","join","html","hash","tag","length","$tmp","createElement","innerHTML","callback","wait","immediate","timeout","callNow","next","apply","arguments","clearTimeout","setTimeout","intersects","obj1","obj2","keys","filter","instance","helpers","forEach","name","fn","registerHelper","scope","partials","partial","registerPartial","template","collide","log","data","assign","methods","registerHelpers","bind","args","bound","shouldRender","path","isArray","some","watchPath","pathSegs","split","every","seg","index","randomId","trackGet","que","_debounced","Utils","debounce","_addToQue","includes","push","_buildProxy","raw","tree","Proxy","get","prop","value","Reflect","constructor","set","ret","deleteProperty","store","SafeString","pop","loc","eventType","methodName","rest","tplScope","start","line","addEventListener","event","context","$app","$refs","findRefs","rootData","last","eId","undefined","ReBarsPath","trap","ProxyTrap","create","root","paths","renders","render","wrapWatcher","refAttr","_isEqHtml","html1","html2","reg","RegExp","replace","canPatch","children","hasChanged","app","$shadow","getShadow","$vChilds","$r","$v","replaceWith","cloneNode","remove","$child","appendChild","insertBefore","_insertAt","renderId","handler","stash","recordState","Patch","find","endsWith","style","display","restoreState","refs","Handlebars","window","trace","templateFn","compile","Helpers","register","registerPartials","scoped","hasOwnProperty","ReRender","MutationObserver","mutationList","addedNodes","removedNodes","nodeType","Node","TEXT_NODE","observe","childList","attributes","subtree"],"mappings":"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"}