{"version":3,"file":"index.min.js","sources":["../src/utils.js","../src/helpers.js","../src/index.js","../src/watcher.js"],"sourcesContent":["export default {\n  findComponent: id => document.getElementById(id),\n\n  findRefs(id) {\n    return Array.from(this.findComponent(id).querySelectorAll(\"[data-vbars-ref]\")).reduce(\n      (obj, $el) => {\n        obj[$el.dataset.vbarsRef] = $el;\n        return obj;\n      },\n      {}\n    );\n  },\n\n  getWildCard(path) {\n    const segs = path.split(\".\").slice(0, -1);\n    segs.push(\"*\");\n    return segs.join(\".\");\n  },\n\n  randomId: () =>\n    \"_\" +\n    Math.random()\n      .toString(36)\n      .substr(2, 9),\n\n  setKey(obj, path, value) {\n    const arr = path.split(\".\");\n    arr.reduce((pointer, key, index) => {\n      if (!(key in pointer)) throw new Error(`${path} was not found in object`, obj);\n      if (index + 1 === arr.length) pointer[key] = value;\n      return pointer[key];\n    }, obj);\n  },\n};\n","import Utils from \"./utils.js\";\nimport Vbars from \"./index.js\";\n\nexport default {\n  register({ id, instance, methods, components, proxyData, parentData, props }) {\n    window.vbars = window.vbars || { handlers: {} };\n    window.vbars.handlers[id] = {\n      bind: (event, path) => Utils.setKey(proxyData, path, event.currentTarget.value),\n    };\n    // we can garbage collect here...\n\n    function _handler() {\n      const [eventType, ...args] = arguments;\n      const opts = args.splice(-1, 1);\n\n      if (args.some(arg => arg !== null && typeof arg === \"object\"))\n        throw new Error(\n          `must only pass primitives as argument to a handler. ${JSON.stringify(args, null, 2)}`\n        );\n\n      const handler = { methodName: opts[0].name, eventType, args };\n      return new instance.SafeString(\n        `on${eventType}=\"vbars.handlers.${id}.${handler.methodName}(${args.join(\",\")})\"`\n      );\n    }\n\n    const _addData = pairs => {\n      return new instance.SafeString(\n        Object.keys(pairs)\n          .map(key => `data-vbars-${key}='${pairs[key]}'`)\n          .join(\" \")\n      );\n    };\n\n    instance.registerHelper(\"debug\", obj => {\n      return new instance.SafeString(`<pre class=\"debug\">${JSON.stringify(obj, null, 2)}</pre>`);\n    });\n\n    instance.registerHelper(\"watch\", function(path, { fn }) {\n      const id = Utils.randomId();\n      setTimeout(() => {\n        document.getElementById(id).vBarsRender = fn;\n      }, 0);\n      return `<span id=\"${id}\" ${_addData({ watch: path })}>${fn(proxyData)}</span>`;\n    });\n\n    Object.keys(components).forEach(name => {\n      instance.registerHelper(name, function(options) {\n        return new instance.SafeString(\n          Vbars.component({\n            ...components[name],\n            ...{ parentData: proxyData, props: options.hash },\n          })\n        );\n      });\n    });\n\n    instance.registerHelper(\"isChecked\", val => (val ? \"checked\" : \"\"));\n    instance.registerHelper(\"ref\", key => _addData({ ref: key }));\n    instance.registerHelper(\n      \"bind\",\n      path => new instance.SafeString(`oninput=\"vbars.handlers.${id}.bind(event, '${path}')\"`)\n    );\n\n    // should throw an error if there is collision of method and comoponent name\n    Object.keys(methods).forEach(key => {\n      window.vbars.handlers[id][key] = function() {\n        return methods[key].call(\n          methods,\n          { data: proxyData, parentData, props, $refs: Utils.findRefs(id), event },\n          ...arguments\n        );\n      };\n      instance.registerHelper(key, _handler);\n    });\n  },\n};\n","import Watcher from \"./watcher.js\";\nimport Helpers from \"./helpers.js\";\nimport Utils from \"./utils.js\";\n\nexport default {\n  component({\n    template,\n    data = {},\n    components = {},\n    methods = {},\n    parentData = {},\n    props = {},\n    hooks = {},\n    Handlebars = window.Handlebars,\n  }) {\n    if (!Handlebars) throw new Error(\"Vbars need Handlebars in order to run!\");\n\n    const id = Utils.randomId();\n    const instance = Handlebars.create();\n\n    // need to call created before building the proxy\n    if (hooks.created) hooks.created(...arguments);\n\n    const proxyData = Watcher(id, data, ({ path }) => {\n      Array.from(Utils.findComponent(id).querySelectorAll(\"[data-vbars-watch]\"))\n        .filter($el => {\n          const key = $el.dataset.vbarsWatch;\n          if (path === key) return true;\n          return Utils.getWildCard(path) === key;\n        })\n        .forEach($el => {\n          $el.innerHTML = $el.vBarsRender(proxyData);\n        });\n    });\n\n    const templateFn = instance.compile(template);\n\n    Helpers.register({ id, instance, methods, components, proxyData, parentData, props });\n\n    if (\"attached\" in hooks) {\n      const int = setInterval(() => {\n        if (Utils.findComponent(id)) {\n          clearInterval(int);\n          hooks.attached({\n            ...{ methods, data: proxyData, parentData, props },\n            ...{ $refs: Utils.findRefs(id) },\n          });\n        }\n      }, 100);\n    }\n\n    return `<span id=\"${id}\">${templateFn(data)}</span>`;\n  },\n};\n","function buildProxy(id, raw, callback, tree = []) {\n  return new Proxy(raw, {\n    get: function(target, prop) {\n      const value = Reflect.get(...arguments);\n      if (value !== null && typeof value === \"object\" && prop !== \"methods\")\n        return buildProxy(id, value, callback, tree.concat(prop));\n      else return value;\n    },\n\n    set: function(target, prop) {\n      const ret = Reflect.set(...arguments);\n      callback({ path: tree.concat(prop).join(\".\") });\n      return ret;\n    },\n\n    deleteProperty: function(target, prop) {\n      const ret = Reflect.deleteProperty(...arguments);\n      callback({ path: tree.concat(prop).join(\".\") });\n      return ret;\n    },\n  });\n}\n\nexport default buildProxy;\n"],"names":["findComponent","id","document","getElementById","[object Object]","Array","from","this","querySelectorAll","reduce","obj","$el","dataset","vbarsRef","path","segs","split","slice","push","join","randomId","Math","random","toString","substr","value","arr","pointer","key","index","Error","length","instance","methods","components","proxyData","parentData","props","_handler","eventType","args","arguments","opts","splice","some","arg","JSON","stringify","handler","methodName","name","SafeString","window","vbars","handlers","bind","event","Utils","setKey","currentTarget","_addData","pairs","Object","keys","map","registerHelper","fn","setTimeout","vBarsRender","watch","forEach","options","Vbars","component","hash","val","ref","call","data","$refs","findRefs","template","hooks","Handlebars","create","created","buildProxy","raw","callback","tree","Proxy","get","target","prop","Reflect","concat","set","ret","deleteProperty","Watcher","filter","vbarsWatch","getWildCard","innerHTML","templateFn","compile","Helpers","register","int","setInterval","clearInterval","attached"],"mappings":"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"}