{"version":3,"file":"index.min.js","sources":["../src/utils.js","../src/event-handlers.js","../src/vbars-helpers.js","../src/index.js","../src/watcher.js","../src/v-dom.js"],"sourcesContent":["export default {\n  isKeyedNode($node) {\n    if ($node.children.length)\n      return Array.from($node.children).every($child => $child.dataset.key);\n    return false;\n  },\n\n  keyedChildren($node) {\n    return Array.from($node.children).filter($e => $e.dataset.key);\n  },\n\n  swapNodes($source, $target) {\n    const $clone = $source.cloneNode(true);\n    $target.parentNode.replaceChild($clone, $target);\n    return $clone;\n  },\n\n  addChild($container, $child) {\n    const $clone = $child.cloneNode(true);\n    $container.appendChild($clone);\n    return $clone;\n  },\n\n  setKey(obj, path, value) {\n    const arr = path.split(\".\");\n    arr.reduce((pointer, key, index) => {\n      if (!(key in pointer)) throw new Error(`${path} was not found in object`, obj);\n      if (index + 1 === arr.length) pointer[key] = value;\n      return pointer[key];\n    }, obj);\n  },\n};\n","import Utils from \"./utils.js\";\n\nexport default function({ $root, methods, proxyData }) {\n  return {\n    add($container) {\n      $container.querySelectorAll(\"[data-vbars-handler]\").forEach($el => {\n        const [eventStr, ...rest] = JSON.parse($el.dataset.vbarsHandler);\n        const [eventType, methodName] = eventStr.split(\":\");\n        let [listener, ...augs] = eventType.split(\".\");\n\n        if (!(methodName in methods))\n          throw new Error(\n            `\"${methodName}\" not in Vbars component's methods. Availible methods: ${Object.keys(\n              methods\n            ).join(\", \")}`\n          );\n\n        // gonna have to store this to remove them when patching\n        $el.addEventListener(listener, event => {\n          if (augs.includes(\"prevent\")) {\n            event.stopPropagation();\n            event.preventDefault();\n          }\n          methods[methodName]({ event, data: proxyData, $root, $container }, ...rest);\n        });\n        delete $el.dataset.vbarsHandler;\n      });\n\n      $container.querySelectorAll(\"[data-vbars-bind]\").forEach($el => {\n        $el.addEventListener(\"input\", $event => {\n          Utils.setKey(proxyData, $el.dataset.vbarsBind, $event.currentTarget.value);\n        });\n      });\n    },\n  };\n}\n","export default {\n  register(instance) {\n    instance.registerHelper(\"watch\", (path, options) => {\n      const identifier = `${options.loc.start.column}${options.loc.start.line}${options.loc.end.column}${options.loc.end.line}`;\n      return new instance.SafeString(`data-vbars-id=\"${identifier}\" data-vbars-watch=\"${path}\"`);\n    });\n\n    instance.registerHelper(\"handler\", function() {\n      const args = Array.from(arguments);\n      args.splice(-1, 1);\n      return new instance.SafeString(`data-vbars-handler='${JSON.stringify(args)}'`);\n    });\n\n    instance.registerHelper(\"isChecked\", function(val) {\n      return new instance.SafeString(val ? \"checked\" : \"\");\n    });\n  },\n};\n","import Watcher from \"./watcher.js\";\nimport VDom from \"./v-dom.js\";\nimport Helpers from \"./vbars-helpers.js\";\n\nexport default {\n  create({ template, data: rawData, methods = {} }) {\n    let $root, vDom;\n\n    const instance = window.Handlebars.create();\n    const proxyData = Watcher(rawData, ({ path }) => vDom.patch($root, path));\n    Helpers.register(instance, proxyData);\n    const templateFn = instance.compile(template);\n\n    return {\n      instance,\n      data: proxyData,\n      render($target) {\n        $root = $target;\n        vDom = VDom({ $root, templateFn, proxyData, methods });\n        vDom.replace();\n      },\n    };\n  },\n};\n","function buildProxy(raw, callback, tree = []) {\n  return new Proxy(raw, {\n    get: function(target, prop) {\n      const value = Reflect.get(...arguments);\n      if (value !== null && typeof value === \"object\" && prop !== \"methods\")\n        return buildProxy(value, callback, tree.concat(prop));\n      else return value;\n    },\n\n    set: function(target, prop) {\n      const ret = Reflect.set(...arguments);\n      callback({ path: tree.concat(prop).join(\".\") });\n      return ret;\n    },\n\n    deleteProperty: function(target, prop) {\n      const ret = Reflect.deleteProperty(...arguments);\n      callback({ path: tree.concat(prop).join(\".\") });\n      return ret;\n    },\n  });\n}\n\nexport default buildProxy;\n","import EventHandlers from \"./event-handlers.js\";\nimport Utils from \"./utils.js\";\n\nconst trace = true;\n\nexport default function({ $root, templateFn, proxyData }) {\n  const $el = document.createElement(\"div\");\n  const Events = EventHandlers(...arguments);\n  const render = () => ($el.innerHTML = templateFn(proxyData));\n\n  function replace() {\n    render();\n    $root.innerHTML = $el.innerHTML;\n    Events.add($root);\n  }\n\n  function _compareKeys($vNode, $realNode) {\n    Utils.keyedChildren($realNode).forEach($e => {\n      const $v = $vNode.querySelector(`[data-key=\"${$e.dataset.key}\"]`);\n      if (!$v) $e.remove();\n      else if (!$v.isEqualNode($e)) Events.add(Utils.swapNodes($v, $e));\n    });\n    // this is items that were added via push\n    Utils.keyedChildren($vNode).forEach($e => {\n      const $real = $realNode.querySelector(`[data-key=\"${$e.dataset.key}\"]`);\n      if (!$real) Events.add(Utils.addChild($realNode, $e));\n    });\n  }\n\n  function patch($target, path) {\n    render();\n\n    Array.from($el.querySelectorAll(\"[data-vbars-watch]\"))\n      .filter($e => path.startsWith($e.dataset.vbarsWatch))\n      .forEach($vNode => {\n        const $real = $target.querySelector(`[data-vbars-id=\"${$vNode.dataset.vbarsId}\"]`);\n        if (Utils.isKeyedNode($vNode)) {\n          if (trace) console.log(`comparing keyed arrays ${path}`, $vNode);\n          _compareKeys($vNode, $real);\n        } else {\n          if (trace) console.log(`patching ${path}`, $vNode);\n          Events.add(Utils.swapNodes($vNode, $real));\n        }\n      });\n  }\n\n  return {\n    $el,\n    render,\n    replace,\n    patch,\n  };\n}\n"],"names":["isKeyedNode","$node","children","length","Array","from","every","$child","dataset","key","keyedChildren","filter","$e","[object Object]","$source","$target","$clone","cloneNode","parentNode","replaceChild","$container","appendChild","obj","path","value","arr","split","reduce","pointer","index","Error","$root","methods","proxyData","querySelectorAll","forEach","$el","eventStr","rest","JSON","parse","vbarsHandler","eventType","methodName","listener","augs","Object","keys","join","addEventListener","event","includes","stopPropagation","preventDefault","data","$event","Utils","setKey","vbarsBind","currentTarget","instance","registerHelper","options","identifier","loc","start","column","line","end","SafeString","args","arguments","splice","stringify","val","template","rawData","vDom","window","Handlebars","create","buildProxy","raw","callback","tree","Proxy","get","target","prop","Reflect","concat","set","ret","deleteProperty","Watcher","patch","Helpers","register","templateFn","compile","document","createElement","Events","EventHandlers","render","innerHTML","replace","add","_compareKeys","$vNode","$realNode","$v","querySelector","isEqualNode","swapNodes","remove","addChild","startsWith","vbarsWatch","$real","vbarsId","VDom"],"mappings":"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"}