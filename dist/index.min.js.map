{"version":3,"file":"index.min.js","sources":["../src/utils.js","../src/re-render.js","../src/watcher.js","../src/helpers.js","../src/component.js","../src/index.js"],"sourcesContent":["let counter = 1;\n\nexport default {\n  findWatcher: id => document.querySelector(`[data-rbs-watch=\"${id}\"]`),\n  wrapWatcher: (id, html, hash) => {\n    const { tag, ...props } = { ...{ tag: \"span\", class: \"rbs-watch\" }, ...hash };\n    const propStr = Object.entries(props)\n      .map(([key, val]) => `${key}=\"${val}\"`)\n      .join(\" \");\n\n    const style = !html.length ? \"style='display:none;'\" : \"\";\n\n    return `<${tag} ${propStr} ${style} data-rbs-watch=\"${id}\">${html}</${tag}>`;\n  },\n\n  tagComponent(id, html, name) {\n    const $tmp = document.createElement(\"div\");\n    $tmp.innerHTML = html;\n    const $root = $tmp.firstElementChild;\n    if ($tmp.children.length > 1 || $root.dataset.rbsWatch)\n      throw new Error(`component:'${name}' must have one root node, and cannot be a {{#watch}}`);\n\n    $root.dataset.rbsComp = id;\n    return $tmp.innerHTML;\n  },\n\n  getStorage(appId, cId) {\n    return cId\n      ? this.findByPath(window.ReBars, `apps.${appId}.inst.${cId}`)\n      : this.findByPath(window.ReBars, `apps.${appId}`);\n  },\n\n  findComponent: id => document.querySelector(`[data-rbs-comp=\"${id}\"]`),\n\n  findRefs(parent) {\n    const $el = typeof parent === \"object\" ? parent : this.findComponent(parent);\n\n    return Array.from($el.querySelectorAll(\"[data-rbs-ref]\")).reduce((obj, $el) => {\n      const key = $el.dataset.rbsRef;\n      const target = obj[$el.dataset.rbsRef];\n      obj[key] = target ? [target].concat($el) : $el;\n      return obj;\n    }, {});\n  },\n\n  findByPath: (data, path) => path.split(\".\").reduce((pointer, seg) => pointer[seg], data),\n  getPath: (appId, compId) => `rbs.apps.${appId}.inst.${compId}`,\n\n  shouldRender(path, watch) {\n    const watchPaths = Array.isArray(watch) ? watch : [watch];\n    return watchPaths.some(watchPath => {\n      if (path === watchPath || watchPath === \".*\") return true;\n\n      const pathSegs = path.split(\".\");\n      const watchSegs = watchPath.split(\".\");\n\n      return watchSegs.every((seg, index) => {\n        if (seg === pathSegs[index] || seg === \"*\") return true;\n        return false;\n      });\n    });\n  },\n\n  randomId: () => `rbs${counter++}`,\n\n  setKey(obj, path, val) {\n    const arr = path.split(\".\");\n    arr.reduce((pointer, key, index) => {\n      if (!(key in pointer)) throw new Error(`${path} was not found in object`, obj);\n      if (index + 1 === arr.length) pointer[key] = val;\n      return pointer[key];\n    }, obj);\n  },\n};\n","import Utils from \"./utils.js\";\n\nfunction _restoreCursor($target, activeRef) {\n  // this fetches all the refs, is this performant?\n  const $input = Utils.findRefs($target)[activeRef.ref];\n\n  if (!$input) return;\n  if (Array.isArray($input)) {\n    console.warn(\n      `component:${name} ref ${activeRef.ref} is used more than once. Focus cannot be restored. If using bind, add a ref=\"uniqeName\" to each`\n    );\n  } else {\n    $input.focus();\n    if (activeRef.pos) $input.setSelectionRange(activeRef.pos + 1, activeRef.pos + 1);\n  }\n}\n\nexport default {\n  init({ watchers, appId, compId, name }) {\n    const cStore = Utils.getStorage(appId, compId);\n    const appStore = Utils.getStorage(appId);\n\n    function _checkWatchers(path) {\n      Object.entries(watchers).forEach(([watch, fn]) => {\n        if (Utils.shouldRender(path, watch)) fn();\n      });\n    }\n\n    function _deleteOrphans() {\n      Object.keys(appStore.inst).forEach(cId => {\n        if (!Utils.findComponent(cId)) delete appStore.inst[cId];\n      });\n      Object.keys(cStore.renders).forEach(key => {\n        if (!Utils.findWatcher(key)) delete cStore.renders[key];\n      });\n    }\n\n    return {\n      patch(path) {\n        _deleteOrphans();\n        _checkWatchers(path);\n\n        Object.entries(cStore.renders).forEach(([renderId, handler]) => {\n          if (!Utils.shouldRender(path, handler.path)) return;\n\n          const $target = Utils.findWatcher(renderId);\n          if (!$target) return;\n          const html = handler.render();\n          if ($target.innerHTML === html) return;\n\n          if (path.endsWith(\".length\")) {\n            const $children = Array.from($target.children);\n            if ($children.some($el => !$el.dataset.hbsRef))\n              console.warn(\n                `component:${name} ${path} watch target children each need a ref in order to patch the array instead of a full re-render`\n              );\n          }\n\n          const activeRef = {\n            ref: document.activeElement.dataset.rbsRef,\n            pos: document.activeElement.selectionStart,\n          };\n\n          $target.style.display = html === \"\" ? \"none\" : \"\";\n          $target.innerHTML = html;\n\n          _restoreCursor($target, activeRef);\n          console.log(`component:${name} ${path}`, $target);\n        });\n      },\n    };\n  },\n};\n","import ReRender from \"./re-render.js\";\n\nexport default {\n  create({ appId, compId, props, data, methods }) {\n    const { patch } = ReRender.init(...arguments);\n\n    function _buildProxy(raw, tree = []) {\n      return new Proxy(raw, {\n        get: function(target, prop) {\n          if (prop === \"ReBarsPath\") return tree.join(\".\");\n          const value = Reflect.get(...arguments);\n          // not sure we need this anymore should only proxy the data...\n          if (typeof value === \"function\" && target.hasOwnProperty(prop)) return value.bind(proxyData);\n          if (value !== null && typeof value === \"object\" && prop !== \"methods\")\n            return _buildProxy(value, tree.concat(prop));\n          else return value;\n        },\n\n        set: function(target, prop) {\n          const ret = Reflect.set(...arguments);\n          patch(tree.concat(prop).join(\".\"));\n          return ret;\n        },\n\n        deleteProperty: function(target, prop) {\n          const ret = Reflect.deleteProperty(...arguments);\n          patch(tree.concat(prop).join(\".\"));\n          return ret;\n        },\n      });\n    }\n\n    const proxyData = _buildProxy({ ...props, ...data(), ...{ methods }, $_componentId: compId, $_appId: appId });\n    return proxyData;\n  },\n};\n","import Utils from \"./utils.js\";\n\nconst _getPath = (target, wildcard = true) => {\n  if (target === undefined) throw new Error(`have passed undefined to watch helper in component '${name}'`);\n  return typeof target === \"object\" ? `${target.ReBarsPath}${wildcard ? \".*\" : \"\"}` : target;\n};\n\nconst _watch = (path, render, { root }) => {\n  const eId = Utils.randomId();\n  const store = Utils.getStorage(root.$_appId, root.$_componentId);\n\n  store.renders[eId] = {\n    path,\n    render,\n  };\n  return eId;\n};\n\nconst _makeParams = args => {\n  return args.map(param => {\n    if ([\"[event]\"].includes(param)) return param.replace(\"[\", \"\").replace(\"]\", \"\");\n    if (param !== null && typeof parm === \"object\")\n      throw new Error(\n        `component:${name} must only pass primitives as argument to a handler. ${JSON.stringify(args, null, 2)}`\n      );\n    if (typeof param === \"string\") return `'${param}'`;\n    return param;\n  });\n};\n\nexport default {\n  register(appId, { instance, helpers, name }) {\n    // component\n    instance.registerHelper(\"component\", function(cName, { hash: props }) {\n      const cDefs = Utils.getStorage(appId).cDefs;\n      if (!cDefs[cName]) throw new Error(`component:${name} child component ${cName} is not registered`);\n      return new instance.SafeString(cDefs[cName].render(props));\n    });\n\n    // add component helpers\n    Object.entries(helpers).forEach(([name, fn]) => instance.registerHelper(name, fn));\n    // add ref helper\n    instance.registerHelper(\"ref\", key => new instance.SafeString(`data-rbs-ref=\"${key}\"`));\n    // watch helpers and debug\n    instance.registerHelper(\"debug\", function(obj, { data }) {\n      const render = () =>\n        `<pre class=\"debug\">${JSON.stringify(\n          obj,\n          (key, val) => (typeof val === \"function\" ? val + \"\" : val),\n          2\n        )}</pre>`;\n      const eId = _watch(_getPath(obj), render, data);\n      return new instance.SafeString(Utils.wrapWatcher(eId, render()));\n    });\n\n    instance.registerHelper(\"watch\", function(...args) {\n      const { fn, hash, data } = args.pop();\n\n      const path = args\n        .map(arg => _getPath(arg, false))\n        .join(\".\")\n        .split(\",\");\n\n      const eId = _watch(path, () => fn(this), data);\n      return Utils.wrapWatcher(eId, fn(this), hash);\n    });\n\n    // events, (just curries to the rbs.handlers)\n    instance.registerHelper(\"method\", function() {\n      const [str, ...args] = arguments;\n      const [methodName, eventType = \"click\"] = str.split(\":\");\n      const { data } = args.pop();\n      const { $_appId, $_componentId } = data.root;\n      const params = _makeParams([$_appId, $_componentId, methodName, \"[event]\"].concat(args));\n      return new instance.SafeString(`on${eventType}=\"rbs.handlers.trigger(${params.join(\",\")})\"`);\n    });\n\n    instance.registerHelper(\"bound\", (path, { hash = {}, data }) => {\n      const { $_appId, $_componentId } = data.root;\n      const val = Utils.findByPath(data.root, path);\n      const ref = hash.ref || path;\n      const params = _makeParams([$_appId, $_componentId, \"[event]\", path]);\n\n      return new instance.SafeString(\n        `value=\"${val}\" data-rbs-ref=\"${ref}\" oninput=\"rbs.handlers.bound(${params.join(\",\")})\"`\n      );\n    });\n  },\n};\n","import Utils from \"./utils.js\";\nimport Watcher from \"./watcher.js\";\nimport Helpers from \"./helpers.js\";\n\nfunction create(\n  appId,\n  { name, template, data, helpers = {}, hooks = {}, methods = {}, watchers = {}, components = [] }\n) {\n  const appStore = Utils.getStorage(appId);\n\n  data =\n    data ||\n    function() {\n      return {};\n    };\n\n  if (!name) throw new Error(\"Each ReBars component should have a name\");\n  if (typeof data !== \"function\") throw new Error(`component:${name} data must be a function`);\n  if (typeof template !== \"string\") throw new Error(`component:${name} needs a template string`);\n\n  const instance = Handlebars.create();\n  const templateFn = instance.compile(template);\n\n  components.forEach(def => {\n    if (!def.name) throw new Error(\"component needs a name\", def);\n    if (!appStore.cDefs[def.name]) appStore.cDefs[def.name] = create(appId, def);\n  });\n\n  Helpers.register(appId, { instance, methods, helpers, name, components });\n\n  return {\n    render(props = {}) {\n      const compId = Utils.randomId();\n      const scope = { props, methods, name, watchers, data };\n\n      scope.methods = Object.entries(methods).reduce((bound, [name, method]) => {\n        bound[name] = method.bind(scope);\n        return bound;\n      }, {});\n\n      Object.entries(props).forEach(([key, value]) => {\n        if (value === undefined) console.warn(`component:${name} was passed undefined for prop '${key}'`);\n        if (typeof value === \"function\" && !(key in scope.methods)) {\n          scope.methods[key] = value;\n          delete props[key];\n        }\n      });\n\n      scope.watchers = Object.entries(watchers).reduce((bound, [name, method]) => {\n        bound[name] = method.bind(scope);\n        return bound;\n      }, {});\n\n      appStore.inst[compId] = {\n        scope,\n        renders: {},\n      };\n\n      scope.data = Watcher.create({ ...scope, ...{ appId, compId, props } });\n      if (hooks.created) hooks.created.call(scope);\n      return Utils.tagComponent(compId, templateFn(scope.data), name);\n    },\n  };\n}\n\nexport default {\n  create,\n};\n","import Utils from \"./utils.js\";\nimport Component from \"./component.js\";\n\nexport default function({ $el, root, Handlebars = window.Handlebars }) {\n  if (!Handlebars) throw new Error(\"ReBars need Handlebars in order to run!\");\n\n  window.rbs = window.ReBars = window.ReBars || {};\n  window.ReBars.apps = window.ReBars.apps || {};\n  window.ReBars.handlers = window.ReBars.handlers || {\n    trigger(...args) {\n      const [appId, cId, methodName, ...params] = args;\n      const scope = Utils.getStorage(appId, cId).scope;\n      const method = scope.methods[methodName];\n      if (!method) throw new Error(`component:${scope.name} ${methodName} is not a defined method`);\n      method(...params);\n    },\n\n    bound(appId, cId, event, path) {\n      const scope = Utils.getStorage(appId, cId).scope;\n      Utils.setKey(scope.data, path, event.target.value);\n    },\n  };\n\n  const id = Utils.randomId();\n  const storage = (window.ReBars.apps[id] = { cDefs: {}, inst: {} });\n\n  if (!document.body.contains($el)) throw new Error(\"$el must be present in the document\");\n\n  $el.innerHTML = Component.create(id, root).render();\n\n  return {\n    id,\n    storage,\n  };\n}\n"],"names":["counter","findWatcher","id","document","querySelector","wrapWatcher","html","hash","tag","props","class","Object","entries","map","key","val","join","length","[object Object]","name","$tmp","createElement","innerHTML","$root","firstElementChild","children","dataset","rbsWatch","Error","rbsComp","appId","cId","this","findByPath","window","ReBars","findComponent","parent","$el","Array","from","querySelectorAll","reduce","obj","rbsRef","target","concat","data","path","split","pointer","seg","getPath","compId","shouldRender","watch","isArray","some","watchPath","pathSegs","every","index","randomId","arr","watchers","cStore","Utils","getStorage","appStore","keys","inst","forEach","renders","fn","_checkWatchers","renderId","handler","$target","render","endsWith","hbsRef","activeRef","ref","activeElement","pos","selectionStart","style","display","$input","findRefs","focus","setSelectionRange","_restoreCursor","methods","patch","ReRender","init","arguments","proxyData","_buildProxy","raw","tree","Proxy","get","prop","value","Reflect","hasOwnProperty","bind","set","ret","deleteProperty","$_componentId","$_appId","_getPath","wildcard","undefined","ReBarsPath","_watch","root","eId","_makeParams","args","param","includes","replace","parm","JSON","stringify","instance","helpers","registerHelper","cName","cDefs","SafeString","pop","arg","str","methodName","eventType","params","create","template","hooks","components","Handlebars","templateFn","compile","def","Helpers","register","scope","bound","method","Watcher","created","call","tagComponent","rbs","apps","handlers","event","setKey","storage","body","contains","Component"],"mappings":"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"}