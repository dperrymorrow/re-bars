{"version":3,"file":"index.min.js","sources":["../src/errors.js","../src/utils.js","../src/re-render.js","../src/proxy-trap.js","../src/helpers.js","../src/component.js","../src/index.js"],"sourcesContent":["export default {\n  noName: () => \"Each ReBars component should have a name\",\n  dataFn: ({ name } = {}) => `component:${name} must be a function`,\n  tplStr: ({ name } = {}) => `component:${name} needs a template string`,\n  propStomp: ({ name, key } = {}) => `component:${name} data.${key} was overrode by props`,\n  propUndef: ({ name, key } = {}) => `component:${name} was passed undefined for prop \"${key}\"`,\n  oneRoot: ({ name } = {}) => `component:${name} must have one root node, and cannot be a {{#watch}} block`,\n  noEl: () => \"$el must be present in the document\",\n  noHbs: () => \"ReBars need Handlebars in order to run!\",\n  noMethod: ({ name, methodName } = {}) => `component:${name} does not have a method named \"${methodName}\"`,\n  badPath: ({ path } = {}) => `${path} was not found in object`,\n  warn(key, obj) {\n    console.warn(this[key](obj));\n  },\n  fail(key, obj) {\n    throw new Error(this[key](obj));\n  },\n};\n","let counter = 1;\n\nimport Errors from \"./errors.js\";\n\nexport default {\n  findWatcher: id => document.querySelector(`[data-rbs-watch=\"${id}\"]`),\n  wrapWatcher: (id, html, hash) => {\n    const { tag, ...props } = { ...{ tag: \"span\", class: \"rbs-watch\" }, ...hash };\n    const propStr = Object.entries(props)\n      .map(([key, val]) => `${key}=\"${val}\"`)\n      .join(\" \");\n\n    const style = !html.length ? \"style='display:none;'\" : \"\";\n\n    return `<${tag} ${propStr} ${style} data-rbs-watch=\"${id}\">${html}</${tag}>`;\n  },\n\n  isKeyedNode: $target => Array.from($target.children).every($el => $el.dataset.rbsRef),\n  normalizeHtml: html => html.replace(new RegExp(/=\"rbs(.*?)\"/g), \"\"),\n\n  isEqHtml(item1, item2) {\n    const $n1 = typeof item1 === \"string\" ? this.getShadow(item1) : this.getShadow(item1.innerHTML);\n    const $n2 = typeof item2 === \"string\" ? this.getShadow(item2) : this.getShadow(item2.innerHTML);\n    $n1.innerHTML = this.normalizeHtml($n1.innerHTML);\n    $n2.innerHTML = this.normalizeHtml($n2.innerHTML);\n    return $n1.isEqualNode($n2);\n  },\n\n  bindAll(scope, collection) {\n    return Object.entries(collection).reduce((bound, [name, method]) => {\n      bound[name] = method.bind(scope);\n      return bound;\n    }, {});\n  },\n\n  getShadow(html) {\n    const $tmp = document.createElement(\"div\");\n    $tmp.innerHTML = html;\n    return $tmp;\n  },\n\n  tagComponent(id, html, name) {\n    const $tmp = this.getShadow(html);\n    const $root = $tmp.firstElementChild;\n\n    if (!$root || !$tmp.children || $tmp.children.length > 1 || $root.dataset.rbsWatch)\n      Errors.fail(\"oneRoot\", { name });\n\n    $root.dataset.rbsComp = id;\n    const content = $tmp.innerHTML;\n    $tmp.remove();\n    return content;\n  },\n\n  getStorage(appId, cId) {\n    return cId\n      ? this.findByPath(window.ReBars, `apps.${appId}.inst.${cId}`)\n      : this.findByPath(window.ReBars, `apps.${appId}`);\n  },\n\n  findComponent: id => document.querySelector(`[data-rbs-comp=\"${id}\"]`),\n  findRef: ($parent, ref) => $parent.querySelector(`[data-rbs-ref=\"${ref}\"]`),\n\n  findRefs(parent) {\n    const $el = typeof parent === \"object\" ? parent : this.findComponent(parent);\n\n    return Array.from($el.querySelectorAll(\"[data-rbs-ref]\")).reduce((obj, $el) => {\n      const key = $el.dataset.rbsRef;\n      const target = obj[$el.dataset.rbsRef];\n      obj[key] = target ? [target].concat($el) : $el;\n      return obj;\n    }, {});\n  },\n\n  findByPath: (data, path) => path.split(\".\").reduce((pointer, seg) => pointer[seg], data),\n  getPath: (appId, compId) => `rbs.apps.${appId}.inst.${compId}`,\n\n  shouldRender(path, watch) {\n    const watchPaths = Array.isArray(watch) ? watch : [watch];\n    return watchPaths.some(watchPath => {\n      if (path === watchPath || watchPath === \".*\") return true;\n\n      const pathSegs = path.split(\".\");\n      const watchSegs = watchPath.split(\".\");\n\n      return watchSegs.every((seg, index) => {\n        if (seg === pathSegs[index] || seg === \"*\") return true;\n        return false;\n      });\n    });\n  },\n\n  randomId: () => `rbs${counter++}`,\n\n  setKey(obj, path, val) {\n    const arr = path.split(\".\");\n    arr.reduce((pointer, key, index) => {\n      if (!(key in pointer)) Errors.fail(\"badPath\", { path }, obj);\n      if (index + 1 === arr.length) pointer[key] = val;\n      return pointer[key];\n    }, obj);\n  },\n};\n","import Utils from \"./utils.js\";\n\nfunction _restoreCursor($target, activeRef) {\n  // this fetches all the refs, is this performant?\n  const $input = Utils.findRef($target, activeRef.ref);\n\n  if (!$input) return;\n  if (Array.isArray($input)) {\n    console.warn(\n      `component:${name} ref ${activeRef.ref} is used more than once. Focus cannot be restored. If using bind, add a ref=\"uniqeName\" to each`\n    );\n  } else {\n    $input.focus();\n    if (activeRef.pos) $input.setSelectionRange(activeRef.pos + 1, activeRef.pos + 1);\n  }\n}\n\nexport default {\n  init({ watchers, appId, compId, name }) {\n    const cStore = Utils.getStorage(appId, compId);\n    const appStore = Utils.getStorage(appId);\n\n    function _checkWatchers(path) {\n      Object.entries(watchers).forEach(([watch, fn]) => {\n        if (Utils.shouldRender(path, watch)) fn();\n      });\n    }\n\n    function _deleteOrphans() {\n      Object.keys(appStore.inst).forEach(cId => {\n        if (!Utils.findComponent(cId)) delete appStore.inst[cId];\n      });\n      Object.keys(cStore.renders).forEach(key => {\n        if (!Utils.findWatcher(key)) delete cStore.renders[key];\n      });\n    }\n\n    function _patchArr($target, html) {\n      const $shadow = Utils.getShadow(html);\n      const $vChilds = Array.from($shadow.children);\n\n      // do deletes + changes first so its faster\n      Array.from($target.children).forEach($r => {\n        const $v = Utils.findRef($shadow, $r.dataset.rbsRef);\n        if (!$v) $r.remove();\n        else if (!Utils.isEqHtml($v, $r)) $r.replaceWith($v.cloneNode(true));\n      });\n\n      // additions;\n      $vChilds.forEach(($v, index) => {\n        const ref = $v.dataset.rbsRef;\n        const $r = Utils.findRef($target, ref);\n        if (!$r) {\n          const $prev = $target.children[index];\n          if ($prev) $target.insertBefore($v.cloneNode(true), $prev);\n          else $target.append($v.cloneNode(true));\n        }\n      });\n\n      $vChilds.forEach(($v, index) => {\n        const ref = $v.dataset.rbsRef;\n        const $el = $target.children[index];\n        if ($el && $el.dataset.rbsRef !== ref) {\n          $target.children[index].replaceWith($v.cloneNode(true));\n        }\n      });\n    }\n\n    return {\n      patch(path) {\n        _deleteOrphans();\n        _checkWatchers(path);\n\n        Object.entries(cStore.renders).forEach(([renderId, handler]) => {\n          if (!Utils.shouldRender(path, handler.path)) return;\n\n          const $target = Utils.findWatcher(renderId);\n          if (!$target) return;\n          const html = handler.render();\n\n          if (Utils.isKeyedNode($target)) {\n            _patchArr($target, html);\n            if (appStore.trace) {\n              console.groupCollapsed(`component:${name} \"${path}\" patching ref Array`);\n              console.log($target);\n              console.groupEnd();\n            }\n            return;\n          } else if (path.endsWith(\".length\")) {\n            console.warn(\n              `component:${name} patching ${path} if you add a ref to each item in the array it will be much faster`\n            );\n          }\n\n          if (Utils.isEqHtml($target.innerHTML, html)) return;\n\n          const activeRef = {\n            ref: document.activeElement.dataset.rbsRef,\n            pos: document.activeElement.selectionStart,\n          };\n\n          $target.style.display = html === \"\" ? \"none\" : \"\";\n          $target.innerHTML = html;\n\n          _restoreCursor($target, activeRef);\n\n          if (appStore.trace) {\n            console.groupCollapsed(`component:${name} \"${path}\" re-rendering`);\n            console.log($target);\n            console.groupEnd();\n          }\n        });\n      },\n    };\n  },\n};\n","import ReRender from \"./re-render.js\";\n\nexport default {\n  create({ appId, compId, $props, data, methods, name }) {\n    let watching = false;\n    const { patch } = ReRender.init(...arguments);\n\n    function _buildProxy(raw, tree = []) {\n      return new Proxy(raw, {\n        get: function(target, prop) {\n          if (prop === \"ReBarsPath\") return tree.join(\".\");\n          const value = Reflect.get(...arguments);\n          // not sure we need this anymore should only proxy the data...\n          if (typeof value === \"function\" && target.hasOwnProperty(prop)) return value.bind(proxyData);\n          if (value !== null && typeof value === \"object\" && prop !== \"methods\")\n            return _buildProxy(value, tree.concat(prop));\n          else return value;\n        },\n\n        set: function(target, prop) {\n          const ret = Reflect.set(...arguments);\n          const path = tree.concat(prop).join(\".\");\n          if (!watching)\n            throw new Error(\n              `component:${name} set '${path}' before being added to the DOM. Usually caused by side effects from a hook or a data function, `\n            );\n          patch(path);\n          return ret;\n        },\n\n        deleteProperty: function(target, prop) {\n          const ret = Reflect.deleteProperty(...arguments);\n          const path = tree.concat(prop).join(\".\");\n          if (!watching)\n            throw new Error(\n              `component:${name} deleted '${path}' before being added to the DOM. Usually caused by side effects from a hook or a data function`\n            );\n\n          patch(path);\n          return ret;\n        },\n      });\n    }\n\n    const proxyData = _buildProxy({\n      ...data,\n      ...$props,\n      ...{ methods },\n      $_componentId: compId,\n      $_appId: appId,\n    });\n    return {\n      watch: () => (watching = true),\n      data: proxyData,\n    };\n  },\n};\n","import Utils from \"./utils.js\";\n\nconst _getPath = (target, wildcard = true) => {\n  if (target === undefined) throw new Error(`have passed undefined to watch helper in component '${name}'`);\n  return typeof target === \"object\" ? `${target.ReBarsPath}${wildcard ? \".*\" : \"\"}` : target;\n};\n\nconst _watch = (path, render, { root }) => {\n  const eId = Utils.randomId();\n  const store = Utils.getStorage(root.$_appId, root.$_componentId);\n\n  store.renders[eId] = {\n    path,\n    render,\n  };\n  return eId;\n};\n\nconst _makeParams = args => {\n  return args.map(param => {\n    if ([\"[event]\"].includes(param)) return param.replace(\"[\", \"\").replace(\"]\", \"\");\n    if (param !== null && typeof param === \"object\")\n      throw new Error(\n        `component:${name} must only pass primitives as argument to a handler. \\n${JSON.stringify(param, null, 2)}`\n      );\n    if (typeof param === \"string\") return `'${param}'`;\n    if (param === null) return `${param}`;\n    return param;\n  });\n};\n\nexport default {\n  register(appId, { instance, helpers, name }) {\n    // component\n    instance.registerHelper(\"component\", function(cName, { hash: props }) {\n      const cDefs = Utils.getStorage(appId).cDefs;\n      if (!cDefs[cName]) throw new Error(`component:${name} child component ${cName} is not registered`);\n      return new instance.SafeString(cDefs[cName].instance(props).render());\n    });\n\n    // add component helpers\n    Object.entries(helpers).forEach(([name, fn]) => instance.registerHelper(name, fn));\n    // add ref helper\n    instance.registerHelper(\"ref\", key => new instance.SafeString(`data-rbs-ref=\"${key}\"`));\n    // watch helpers and debug\n    instance.registerHelper(\"debug\", function(obj, { data }) {\n      const render = () =>\n        `<pre class=\"debug\">${JSON.stringify(\n          obj,\n          (key, val) => (typeof val === \"function\" ? val + \"\" : val),\n          2\n        )}</pre>`;\n      const eId = _watch(_getPath(obj), render, data);\n      return new instance.SafeString(Utils.wrapWatcher(eId, render()));\n    });\n\n    instance.registerHelper(\"watch\", function(...args) {\n      const { fn, hash, data } = args.pop();\n      const path = args\n        .map(arg => _getPath(arg, false))\n        .join(\".\")\n        .split(\",\");\n\n      const eId = _watch(path, () => fn(this), data);\n      return Utils.wrapWatcher(eId, fn(this), hash);\n    });\n\n    // events, (just curries to the rbs.handlers)\n    instance.registerHelper(\"method\", function() {\n      const [str, ...args] = arguments;\n      const [methodName, eventType = \"click\"] = str.split(\":\");\n      const { data } = args.pop();\n      const { $_appId, $_componentId } = data.root;\n      const params = _makeParams([$_appId, $_componentId, methodName, \"[event]\"].concat(args));\n      return new instance.SafeString(`on${eventType}=\"rbs.handlers.trigger(${params.join(\",\")})\"`);\n    });\n\n    instance.registerHelper(\"bound\", (path, { hash = {}, data }) => {\n      const { $_appId, $_componentId } = data.root;\n      const val = Utils.findByPath(data.root, path);\n      const ref = hash.ref || path;\n      const params = _makeParams([$_appId, $_componentId, \"[event]\", path]);\n\n      return new instance.SafeString(\n        `value=\"${val}\" data-rbs-ref=\"${ref}\" oninput=\"rbs.handlers.bound(${params.join(\",\")})\"`\n      );\n    });\n  },\n};\n","import Utils from \"./utils.js\";\nimport ProxyTrap from \"./proxy-trap.js\";\nimport Helpers from \"./helpers.js\";\nimport Errors from \"./errors.js\";\n\nfunction register(\n  appId,\n  Handlebars,\n  { name, template, data, helpers = {}, hooks = {}, methods = {}, watchers = {}, components = [] }\n) {\n  const appStore = Utils.getStorage(appId);\n\n  data =\n    data ||\n    function() {\n      return {};\n    };\n\n  if (!name) Errors.fail(\"noName\", { def: arguments[2] });\n  if (typeof data !== \"function\") Errors.fail(\"dataFn\", { name });\n  if (typeof template !== \"string\") Errors.fail(\"tmplStr\", { name });\n\n  const instance = Handlebars.create();\n  const templateFn = instance.compile(template);\n\n  components.forEach(def => {\n    if (!def.name) Errors.fail(\"noName\", { def });\n    if (!appStore.cDefs[def.name]) appStore.cDefs[def.name] = register(appId, Handlebars, def);\n  });\n\n  Helpers.register(appId, { instance, methods, helpers, name, components });\n\n  return {\n    instance($props = {}) {\n      const compId = Utils.randomId();\n      const scope = { $props, methods, hooks, name, watchers, data: data(), $refs: () => Utils.findRefs(compId) };\n\n      scope.methods = Utils.bindAll(scope, methods);\n      scope.watchers = Utils.bindAll(scope, watchers);\n\n      // validate the props, add the passed methods after you bind them or you will loose scope\n      Object.entries($props).forEach(([key, value]) => {\n        if (value === undefined) Errors.warn(\"propUndef\", { name, key });\n        if (key in scope.data) Errors.warn(\"propStomp\", { name, key });\n        if (typeof value === \"function\") {\n          scope.methods[key] = value;\n          delete $props[key];\n        }\n      });\n\n      appStore.inst[compId] = {\n        scope,\n        renders: {},\n      };\n\n      if (hooks.created) hooks.created.call(scope);\n\n      const proxyInst = ProxyTrap.create({ ...scope, ...{ appId, compId } });\n      scope.data = proxyInst.data;\n\n      return {\n        ...scope,\n        ...{ proxyInst },\n        render() {\n          const html = Utils.tagComponent(compId, templateFn(scope.data), name);\n          proxyInst.watch();\n          return html;\n        },\n      };\n    },\n  };\n}\n\nexport default {\n  register,\n};\n","import Utils from \"./utils.js\";\nimport Component from \"./component.js\";\nimport Errors from \"./errors.js\";\n\nexport default function({ $el, root, Handlebars = window.Handlebars, trace = false }) {\n  if (!Handlebars) Errors.fail(\"noHbs\");\n\n  window.rbs = window.ReBars = window.ReBars || {};\n  window.ReBars.apps = window.ReBars.apps || {};\n  window.ReBars.handlers = window.ReBars.handlers || {\n    trigger(...args) {\n      const [appId, cId, methodName, ...params] = args;\n      const scope = Utils.getStorage(appId, cId).scope;\n      const method = scope.methods[methodName];\n      if (!method) Errors.fail(\"noMethod\", { name: scope.name, methodName });\n      method(...params);\n    },\n\n    bound(appId, cId, event, path) {\n      const scope = Utils.getStorage(appId, cId).scope;\n      Utils.setKey(scope.data, path, event.target.value);\n    },\n  };\n\n  const id = Utils.randomId();\n  const storage = (window.ReBars.apps[id] = { cDefs: {}, inst: {}, trace });\n\n  if (!document.body.contains($el)) Errors.fail(\"noEl\");\n\n  $el.innerHTML = Component.register(id, Handlebars, root)\n    .instance()\n    .render();\n\n  return {\n    id,\n    storage,\n  };\n}\n"],"names":["noName","dataFn","name","tplStr","propStomp","key","propUndef","oneRoot","noEl","noHbs","noMethod","methodName","badPath","path","[object Object]","obj","Error","this","counter","findWatcher","id","document","querySelector","wrapWatcher","html","hash","tag","props","class","Object","entries","map","val","join","length","isKeyedNode","$target","Array","from","children","every","$el","dataset","rbsRef","normalizeHtml","replace","RegExp","item1","item2","$n1","getShadow","innerHTML","$n2","isEqualNode","bindAll","scope","collection","reduce","bound","method","bind","$tmp","createElement","$root","firstElementChild","rbsWatch","Errors","fail","rbsComp","content","remove","appId","cId","findByPath","window","ReBars","findComponent","findRef","$parent","ref","parent","querySelectorAll","target","concat","data","split","pointer","seg","getPath","compId","shouldRender","watch","isArray","some","watchPath","pathSegs","index","randomId","arr","watchers","cStore","Utils","getStorage","appStore","keys","inst","forEach","renders","fn","_checkWatchers","renderId","handler","render","$shadow","$vChilds","$r","$v","isEqHtml","replaceWith","cloneNode","$prev","insertBefore","append","_patchArr","trace","endsWith","activeRef","activeElement","pos","selectionStart","style","display","$input","focus","setSelectionRange","_restoreCursor","$props","methods","watching","patch","ReRender","init","arguments","proxyData","_buildProxy","raw","tree","Proxy","get","prop","value","Reflect","hasOwnProperty","set","ret","deleteProperty","$_componentId","$_appId","_getPath","wildcard","undefined","ReBarsPath","_watch","root","eId","_makeParams","args","param","includes","JSON","stringify","instance","helpers","registerHelper","cName","cDefs","SafeString","pop","arg","str","eventType","params","register","Handlebars","template","hooks","components","def","create","templateFn","compile","Helpers","$refs","findRefs","warn","created","call","proxyInst","ProxyTrap","tagComponent","rbs","apps","handlers","event","setKey","storage","body","contains","Component"],"mappings":"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"}