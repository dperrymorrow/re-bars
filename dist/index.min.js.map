{"version":3,"file":"index.min.js","sources":["../src/utils.js","../src/re-render.js","../src/proxy-trap.js","../src/helpers.js","../src/component.js","../src/index.js"],"sourcesContent":["let counter = 1;\n\nexport default {\n  findWatcher: id => document.querySelector(`[data-rbs-watch=\"${id}\"]`),\n  wrapWatcher: (id, html, hash) => {\n    const { tag, ...props } = { ...{ tag: \"span\", class: \"rbs-watch\" }, ...hash };\n    const propStr = Object.entries(props)\n      .map(([key, val]) => `${key}=\"${val}\"`)\n      .join(\" \");\n\n    const style = !html.length ? \"style='display:none;'\" : \"\";\n\n    return `<${tag} ${propStr} ${style} data-rbs-watch=\"${id}\">${html}</${tag}>`;\n  },\n\n  isKeyedNode: $target => Array.from($target.children).every($el => $el.dataset.rbsRef),\n  normalizeHtml: html => html.replace(new RegExp(/=\"rbs(.*?)\"/g), \"\"),\n\n  isEqHtml(item1, item2) {\n    const $n1 = typeof item1 === \"string\" ? this.getShadow(item1) : this.getShadow(item1.innerHTML);\n    const $n2 = typeof item2 === \"string\" ? this.getShadow(item2) : this.getShadow(item2.innerHTML);\n    $n1.innerHTML = this.normalizeHtml($n1.innerHTML);\n    $n2.innerHTML = this.normalizeHtml($n2.innerHTML);\n    return $n1.isEqualNode($n2);\n  },\n\n  getShadow(html) {\n    const $tmp = document.createElement(\"div\");\n    $tmp.innerHTML = html;\n    return $tmp;\n  },\n\n  tagComponent(id, html, name) {\n    const $tmp = this.getShadow(html);\n    const $root = $tmp.firstElementChild;\n\n    if ($tmp.children.length > 1 || $root.dataset.rbsWatch)\n      throw new Error(`component:'${name}' must have one root node, and cannot be a {{#watch}}`);\n\n    $root.dataset.rbsComp = id;\n    const content = $tmp.innerHTML;\n    $tmp.remove();\n    return content;\n  },\n\n  getStorage(appId, cId) {\n    return cId\n      ? this.findByPath(window.ReBars, `apps.${appId}.inst.${cId}`)\n      : this.findByPath(window.ReBars, `apps.${appId}`);\n  },\n\n  findComponent: id => document.querySelector(`[data-rbs-comp=\"${id}\"]`),\n  findRef: ($parent, ref) => $parent.querySelector(`[data-rbs-ref=\"${ref}\"]`),\n\n  findRefs(parent) {\n    const $el = typeof parent === \"object\" ? parent : this.findComponent(parent);\n\n    return Array.from($el.querySelectorAll(\"[data-rbs-ref]\")).reduce((obj, $el) => {\n      const key = $el.dataset.rbsRef;\n      const target = obj[$el.dataset.rbsRef];\n      obj[key] = target ? [target].concat($el) : $el;\n      return obj;\n    }, {});\n  },\n\n  findByPath: (data, path) => path.split(\".\").reduce((pointer, seg) => pointer[seg], data),\n  getPath: (appId, compId) => `rbs.apps.${appId}.inst.${compId}`,\n\n  shouldRender(path, watch) {\n    const watchPaths = Array.isArray(watch) ? watch : [watch];\n    return watchPaths.some(watchPath => {\n      if (path === watchPath || watchPath === \".*\") return true;\n\n      const pathSegs = path.split(\".\");\n      const watchSegs = watchPath.split(\".\");\n\n      return watchSegs.every((seg, index) => {\n        if (seg === pathSegs[index] || seg === \"*\") return true;\n        return false;\n      });\n    });\n  },\n\n  randomId: () => `rbs${counter++}`,\n\n  setKey(obj, path, val) {\n    const arr = path.split(\".\");\n    arr.reduce((pointer, key, index) => {\n      if (!(key in pointer)) throw new Error(`${path} was not found in object`, obj);\n      if (index + 1 === arr.length) pointer[key] = val;\n      return pointer[key];\n    }, obj);\n  },\n};\n","import Utils from \"./utils.js\";\n\nfunction _restoreCursor($target, activeRef) {\n  // this fetches all the refs, is this performant?\n  const $input = Utils.findRef($target, activeRef.ref);\n\n  if (!$input) return;\n  if (Array.isArray($input)) {\n    console.warn(\n      `component:${name} ref ${activeRef.ref} is used more than once. Focus cannot be restored. If using bind, add a ref=\"uniqeName\" to each`\n    );\n  } else {\n    $input.focus();\n    if (activeRef.pos) $input.setSelectionRange(activeRef.pos + 1, activeRef.pos + 1);\n  }\n}\n\nexport default {\n  init({ watchers, appId, compId, name }) {\n    const cStore = Utils.getStorage(appId, compId);\n    const appStore = Utils.getStorage(appId);\n\n    function _checkWatchers(path) {\n      Object.entries(watchers).forEach(([watch, fn]) => {\n        if (Utils.shouldRender(path, watch)) fn();\n      });\n    }\n\n    function _deleteOrphans() {\n      Object.keys(appStore.inst).forEach(cId => {\n        if (!Utils.findComponent(cId)) delete appStore.inst[cId];\n      });\n      Object.keys(cStore.renders).forEach(key => {\n        if (!Utils.findWatcher(key)) delete cStore.renders[key];\n      });\n    }\n\n    function _patchArr($target, html, path) {\n      const fullPatch = !path.endsWith(\".length\");\n      const $shadow = Utils.getShadow(html);\n      const $vChilds = Array.from($shadow.children);\n      const $rChilds = Array.from($target.children);\n\n      // do deletes first so its faster\n      $rChilds.forEach($r => {\n        const $v = Utils.findRef($shadow, $r.dataset.rbsRef);\n        if (!$v) $r.remove();\n        else if (fullPatch && !Utils.isEqHtml($v, $r)) $r.replaceWith($v.cloneNode(true));\n      });\n\n      // additions\n      let $lastMatch;\n      $vChilds.forEach($v => {\n        const $r = Utils.findRef($target, $v.dataset.rbsRef);\n        if (!$r) {\n          if ($lastMatch && $lastMatch.nextElementSibling) {\n            $target.insertBefore($v.cloneNode(true), $lastMatch.nextElementSibling);\n          } else {\n            $target.append($v.cloneNode(true));\n          }\n        } else $lastMatch = $r;\n      });\n    }\n\n    return {\n      patch(path) {\n        _deleteOrphans();\n        _checkWatchers(path);\n\n        Object.entries(cStore.renders).forEach(([renderId, handler]) => {\n          if (!Utils.shouldRender(path, handler.path)) return;\n\n          const $target = Utils.findWatcher(renderId);\n          if (!$target) return;\n          const html = handler.render();\n\n          if (Utils.isKeyedNode($target)) {\n            _patchArr($target, html, path);\n            return;\n          }\n\n          if (Utils.isEqHtml($target.innerHTML, html)) return;\n\n          const activeRef = {\n            ref: document.activeElement.dataset.rbsRef,\n            pos: document.activeElement.selectionStart,\n          };\n\n          $target.style.display = html === \"\" ? \"none\" : \"\";\n          $target.innerHTML = html;\n\n          _restoreCursor($target, activeRef);\n          console.log(`component:${name} ${path}`, $target);\n        });\n      },\n    };\n  },\n};\n","import ReRender from \"./re-render.js\";\n\nexport default {\n  create({ appId, compId, $props, data, methods, name }) {\n    let watching = false;\n    const { patch } = ReRender.init(...arguments);\n\n    function _buildProxy(raw, tree = []) {\n      return new Proxy(raw, {\n        get: function(target, prop) {\n          if (prop === \"ReBarsPath\") return tree.join(\".\");\n          const value = Reflect.get(...arguments);\n          // not sure we need this anymore should only proxy the data...\n          if (typeof value === \"function\" && target.hasOwnProperty(prop)) return value.bind(proxyData);\n          if (value !== null && typeof value === \"object\" && prop !== \"methods\")\n            return _buildProxy(value, tree.concat(prop));\n          else return value;\n        },\n\n        set: function(target, prop) {\n          const ret = Reflect.set(...arguments);\n          const path = tree.concat(prop).join(\".\");\n          if (!watching)\n            throw new Error(\n              `component:${name} set '${path}' before being added to the DOM. Usually caused by side effects from a hook or a data function, `\n            );\n          patch(path);\n          return ret;\n        },\n\n        deleteProperty: function(target, prop) {\n          const ret = Reflect.deleteProperty(...arguments);\n          const path = tree.concat(prop).join(\".\");\n          if (!watching)\n            throw new Error(\n              `component:${name} deleted '${path}' before being added to the DOM. Usually caused by side effects from a hook or a data function`\n            );\n\n          patch(path);\n          return ret;\n        },\n      });\n    }\n\n    const proxyData = _buildProxy({\n      ...data,\n      ...$props,\n      ...{ methods },\n      $_componentId: compId,\n      $_appId: appId,\n    });\n    return {\n      watch: () => (watching = true),\n      data: proxyData,\n    };\n  },\n};\n","import Utils from \"./utils.js\";\n\nconst _getPath = (target, wildcard = true) => {\n  if (target === undefined) throw new Error(`have passed undefined to watch helper in component '${name}'`);\n  return typeof target === \"object\" ? `${target.ReBarsPath}${wildcard ? \".*\" : \"\"}` : target;\n};\n\nconst _watch = (path, render, { root }) => {\n  const eId = Utils.randomId();\n  const store = Utils.getStorage(root.$_appId, root.$_componentId);\n\n  store.renders[eId] = {\n    path,\n    render,\n  };\n  return eId;\n};\n\nconst _makeParams = args => {\n  return args.map(param => {\n    if ([\"[event]\"].includes(param)) return param.replace(\"[\", \"\").replace(\"]\", \"\");\n    if (param !== null && typeof param === \"object\")\n      throw new Error(\n        `component:${name} must only pass primitives as argument to a handler. \\n${JSON.stringify(param, null, 2)}`\n      );\n    if (typeof param === \"string\") return `'${param}'`;\n    if (param === null) return `${param}`;\n    return param;\n  });\n};\n\nexport default {\n  register(appId, { instance, helpers, name }) {\n    // component\n    instance.registerHelper(\"component\", function(cName, { hash: props }) {\n      const cDefs = Utils.getStorage(appId).cDefs;\n      if (!cDefs[cName]) throw new Error(`component:${name} child component ${cName} is not registered`);\n      return new instance.SafeString(cDefs[cName].render(props));\n    });\n\n    // add component helpers\n    Object.entries(helpers).forEach(([name, fn]) => instance.registerHelper(name, fn));\n    // add ref helper\n    instance.registerHelper(\"ref\", key => new instance.SafeString(`data-rbs-ref=\"${key}\"`));\n    // watch helpers and debug\n    instance.registerHelper(\"debug\", function(obj, { data }) {\n      const render = () =>\n        `<pre class=\"debug\">${JSON.stringify(\n          obj,\n          (key, val) => (typeof val === \"function\" ? val + \"\" : val),\n          2\n        )}</pre>`;\n      const eId = _watch(_getPath(obj), render, data);\n      return new instance.SafeString(Utils.wrapWatcher(eId, render()));\n    });\n\n    instance.registerHelper(\"watch\", function(...args) {\n      const { fn, hash, data } = args.pop();\n      const path = args\n        .map(arg => _getPath(arg, false))\n        .join(\".\")\n        .split(\",\");\n\n      const eId = _watch(path, () => fn(this), data);\n      return Utils.wrapWatcher(eId, fn(this), hash);\n    });\n\n    // events, (just curries to the rbs.handlers)\n    instance.registerHelper(\"method\", function() {\n      const [str, ...args] = arguments;\n      const [methodName, eventType = \"click\"] = str.split(\":\");\n      const { data } = args.pop();\n      const { $_appId, $_componentId } = data.root;\n      const params = _makeParams([$_appId, $_componentId, methodName, \"[event]\"].concat(args));\n      return new instance.SafeString(`on${eventType}=\"rbs.handlers.trigger(${params.join(\",\")})\"`);\n    });\n\n    instance.registerHelper(\"bound\", (path, { hash = {}, data }) => {\n      const { $_appId, $_componentId } = data.root;\n      const val = Utils.findByPath(data.root, path);\n      const ref = hash.ref || path;\n      const params = _makeParams([$_appId, $_componentId, \"[event]\", path]);\n\n      return new instance.SafeString(\n        `value=\"${val}\" data-rbs-ref=\"${ref}\" oninput=\"rbs.handlers.bound(${params.join(\",\")})\"`\n      );\n    });\n  },\n};\n","import Utils from \"./utils.js\";\nimport ProxyTrap from \"./proxy-trap.js\";\nimport Helpers from \"./helpers.js\";\n\nfunction create(\n  appId,\n  { name, template, data, helpers = {}, hooks = {}, methods = {}, watchers = {}, components = [] }\n) {\n  const appStore = Utils.getStorage(appId);\n\n  data =\n    data ||\n    function() {\n      return {};\n    };\n\n  if (!name) throw new Error(\"Each ReBars component should have a name\");\n  if (typeof data !== \"function\") throw new Error(`component:${name} data must be a function`);\n  if (typeof template !== \"string\") throw new Error(`component:${name} needs a template string`);\n\n  const instance = Handlebars.create();\n  const templateFn = instance.compile(template);\n\n  components.forEach(def => {\n    if (!def.name) throw new Error(\"component needs a name\", def);\n    if (!appStore.cDefs[def.name]) appStore.cDefs[def.name] = create(appId, def);\n  });\n\n  Helpers.register(appId, { instance, methods, helpers, name, components });\n\n  return {\n    render($props = {}) {\n      const compId = Utils.randomId();\n      const scope = { $props, methods, name, watchers, data: data(), $refs: () => Utils.findRefs(compId) };\n\n      scope.methods = Object.entries(methods).reduce((bound, [name, method]) => {\n        bound[name] = method.bind(scope);\n        return bound;\n      }, {});\n\n      // validate the props, add the passed methods after you bind them or you will loose scope\n      Object.entries($props).forEach(([key, value]) => {\n        if (value === undefined) console.warn(`component:${name} was passed undefined for prop '${key}'`);\n        if (typeof value === \"function\") {\n          scope.methods[key] = value;\n          delete $props[key];\n        }\n        if (key in scope.data)\n          console.warn(`component:${name} prop ${key} was overrode with ${scope.data[key]} from data`);\n      });\n\n      scope.watchers = Object.entries(watchers).reduce((bound, [name, method]) => {\n        bound[name] = method.bind(scope);\n        return bound;\n      }, {});\n\n      appStore.inst[compId] = {\n        scope,\n        renders: {},\n      };\n\n      if (hooks.created) hooks.created.call(scope);\n\n      const proxyInst = ProxyTrap.create({ ...scope, ...{ appId, compId } });\n      scope.data = proxyInst.data;\n      const html = Utils.tagComponent(compId, templateFn(scope.data), name);\n      proxyInst.watch();\n      return html;\n    },\n  };\n}\n\nexport default {\n  create,\n};\n","import Utils from \"./utils.js\";\nimport Component from \"./component.js\";\n\nexport default function({ $el, root, Handlebars = window.Handlebars }) {\n  if (!Handlebars) throw new Error(\"ReBars need Handlebars in order to run!\");\n\n  window.rbs = window.ReBars = window.ReBars || {};\n  window.ReBars.apps = window.ReBars.apps || {};\n  window.ReBars.handlers = window.ReBars.handlers || {\n    trigger(...args) {\n      const [appId, cId, methodName, ...params] = args;\n      const scope = Utils.getStorage(appId, cId).scope;\n      const method = scope.methods[methodName];\n      if (!method) throw new Error(`component:${scope.name} ${methodName} is not a defined method`);\n      method(...params);\n    },\n\n    bound(appId, cId, event, path) {\n      const scope = Utils.getStorage(appId, cId).scope;\n      Utils.setKey(scope.data, path, event.target.value);\n    },\n  };\n\n  const id = Utils.randomId();\n  const storage = (window.ReBars.apps[id] = { cDefs: {}, inst: {} });\n\n  if (!document.body.contains($el)) throw new Error(\"$el must be present in the document\");\n\n  $el.innerHTML = Component.create(id, root).render();\n\n  return {\n    id,\n    storage,\n  };\n}\n"],"names":["counter","findWatcher","id","document","querySelector","wrapWatcher","html","hash","tag","props","class","Object","entries","map","key","val","join","length","isKeyedNode","$target","Array","from","children","every","$el","dataset","rbsRef","normalizeHtml","replace","RegExp","[object Object]","item1","item2","$n1","this","getShadow","innerHTML","$n2","isEqualNode","$tmp","createElement","name","$root","firstElementChild","rbsWatch","Error","rbsComp","content","remove","appId","cId","findByPath","window","ReBars","findComponent","findRef","$parent","ref","parent","querySelectorAll","reduce","obj","target","concat","data","path","split","pointer","seg","getPath","compId","shouldRender","watch","isArray","some","watchPath","pathSegs","index","randomId","arr","watchers","cStore","Utils","getStorage","appStore","keys","inst","forEach","renders","fn","_checkWatchers","renderId","handler","render","fullPatch","endsWith","$shadow","$vChilds","$lastMatch","$r","$v","isEqHtml","replaceWith","cloneNode","nextElementSibling","insertBefore","append","_patchArr","activeRef","activeElement","pos","selectionStart","style","display","$input","focus","setSelectionRange","_restoreCursor","$props","methods","watching","patch","ReRender","init","arguments","proxyData","_buildProxy","raw","tree","Proxy","get","prop","value","Reflect","hasOwnProperty","bind","set","ret","deleteProperty","$_componentId","$_appId","_getPath","wildcard","undefined","ReBarsPath","_watch","root","eId","_makeParams","args","param","includes","JSON","stringify","instance","helpers","registerHelper","cName","cDefs","SafeString","pop","arg","str","methodName","eventType","params","create","template","hooks","components","Handlebars","templateFn","compile","def","Helpers","register","scope","$refs","findRefs","bound","method","created","call","proxyInst","ProxyTrap","tagComponent","rbs","apps","handlers","event","setKey","storage","body","contains","Component"],"mappings":"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"}