(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):(a=a||self,a.DemoApp=b())})(this,function(){'use strict';function a(a="MSG"){const b=Array.isArray(a)?a:[a],c=(a,c,d)=>{a=`${e[c]} ${a}`;const g=b.slice(0,2).concat([a]).map(a=>`%c ${a} `).join(""),h=[f[c][0]];1<b.length&&h.push(f[c][1]),h.push(f.msg);const i=[g].concat(h),j=null===d?console.log:console.groupCollapsed;j(...i),d&&(console.log(d),console.groupEnd())};return{warn:(a,b=null)=>c(a,"warn",b),error:(a,b=null)=>c(a,"error",b),log:(a,b=null)=>c(a,"log",b)}}function b(a,c,d=[]){return new Proxy(a,{get:function(a,e){const f=Reflect.get(...arguments);return null!==f&&"object"==typeof f?b(f,c,d.concat(e)):f},set:function(a,b){const e=Reflect.set(...arguments);return c({path:d.concat(b).join(".")}),e},deleteProperty:function(a,b){const e=Reflect.deleteProperty(...arguments);return c({path:d.concat(b).join(".")}),e}})}function c({templateFn:a,proxyData:b,eventHandlers:c}){function d(){g.innerHTML=a(b),k.log("vdom contents",g)}function e(a){i=a,d(),a.innerHTML=g.innerHTML,j.add({$root:i,$container:a,eventHandlers:c,data:b})}function f(a,d){h.keyedChildren(d).forEach(d=>{const e=a.querySelector(`[data-key="${d.dataset.key}"]`);if(!e)d.remove();else if(!e.isEqualNode(d)){const a=h.swapNodes(e,d);j.add({$root:i,$container:a,eventHandlers:c,data:b})}}),h.keyedChildren(a).forEach(a=>{const e=d.querySelector(`[data-key="${a.dataset.key}"]`);if(!e){const e=h.addChild(d,a);j.add({$root:i,$container:e,eventHandlers:c,data:b})}})}const g=document.createElement("div");let i;return{$el:g,render:d,replace:e,patch:function(a,e){d(),Array.from(g.querySelectorAll("[data-watch]")).filter(a=>e.startsWith(a.dataset.watch)).forEach(d=>{const g=a.querySelector(`#${d.getAttribute("id")}`);h.isKeyedNode(d)?(k.log(`comparing keyed arrays ${e}`,d),f(d,g)):(g.innerHTML=d.innerHTML,k.log(`patching ${e}`,d),j.add({$root:a,$container:g,eventHandlers:c,data:b}))})}}}const d={orange:"#ffc934",orangeDark:"#d38809",grey:"#073042",white:"#FFF",red:"#e95233",redDark:"#b74129",green:"#02d479",greenDark:"#0ea760",black:"#000000"},e={error:"\uD83D\uDCA5",warn:"\u26A0\uFE0F",log:"\uD83D\uDCAC"},f={msg:`background: ${d.black}; color: ${d.white}; font-weight: bold;`,warn:[`background: ${d.orangeDark}; color:${d.black}; font-weight: bold;`,`background: ${d.orange}; color:${d.black}; font-weight: bold;`],error:[`background: ${d.redDark}; color:${d.black}; font-weight: bold;`,`background: ${d.red}; color:${d.black}; font-weight: bold;`],log:[`background: ${d.greenDark}; color:${d.black}; font-weight: bold;`,`background: ${d.green}; color:${d.black}; font-weight: bold;`]},g=a("utils");var h={randomInt(a=0,b=1e3){var c=Math.floor,d=Math.ceil;return a=d(a),b=c(b),c(Math.random()*(b-a))+a},watchId(a){return`reactive-key-${a.loc.start.column}${a.loc.start.line}${a.loc.end.column}${a.loc.end.line}`},isKeyedNode(a){return!!a.children.length&&Array.from(a.children).every(a=>a.dataset.key)},keyedChildren(a){return Array.from(a.children).filter(a=>a.dataset.key)},swapNodes(a,b){const c=a.cloneNode(!0);return b.parentNode.replaceChild(c,b),c},addChild(a,b){const c=b.cloneNode(!0);return a.appendChild(c),c},setKey(a,b,c){const d=b.split(".");d.reduce((e,f,h)=>(f in e||g.warn(`${b} was not found in object`,a),h+1===d.length&&(e[f]=c),e[f]),a)}};const i=a("Event Handlers");var j={add({$root:a,$container:b,eventHandlers:c,data:d}){b.querySelectorAll("[data-handler]").forEach(e=>{const[f,g]=e.dataset.handler.split(":");let[h,...j]=f.split(".");return g in c?void e.addEventListener(h,e=>{j.includes("prevent")&&(e.stopPropagation(),e.preventDefault()),c[g]({event:e,data:d,$root:a,$container:b})}):void i.warn(`${g} not in event handlers`,c)}),b.querySelectorAll("[data-bind]").forEach(a=>{a.addEventListener("input",b=>{h.setKey(d,a.dataset.bind,b.currentTarget.value)})})}};const k=a("V-DOM");var l={create({template:a,data:d,eventHandlers:e={}}){let f;const g=window.Handlebars.create();g.registerHelper("watch",(a,b)=>{const c=h.watchId(b);return`<span id="${c}" data-watch="${a}">${b.fn(j)}</span>`});const i=g.compile(a),j=b(d,({path:a})=>{k.patch(f,a)}),k=c({templateFn:i,proxyData:j,eventHandlers:e});return{instance:g,data:j,vDom:k,render(a){f=a,k.replace(a)}}}},m=l.create({template:`
    <!-- the reactive template we are demo-ing -->
      {{#watch 'header'}}
        <h1>
          {{ header.title }}
          <small>{{ header.description }}</small>
        </h1>
      {{/watch}}

      <label>
        Edit Title:
        <input value="{{ header.title }}" data-bind="header.title"/>
      </label>

      <label>
        Edit Description:
        <input value="{{ header.description }}" data-bind="header.description"/>
      </label>


    <hr />

    <ul>
      {{#watch 'todos'}}
        {{#each todos}}
        <!-- check if children have a data-key and if so patch that instead of replace -->
          <li data-key="{{ name }}">
            {{#if done }}
              <input type="checkbox" checked data-handler="click:toggleDone"/>
              <s>{{ name }}</s>
            {{else}}
              <input type="checkbox" data-handler="click:toggleDone"/>
              <strong>{{ name }}</strong>
            {{/if}}
            <p>{{ description }}</p>
            <button data-handler="click:deleteToDo">X</button>
          </li>
        {{/each}}
      {{/watch}}
    </ul>

    <hr/>

    {{#watch 'uiState'}}
      {{#if uiState.adding }}
        <div class="row">
          <label>
            <input type="text" id="new-todo-label" placeholder="the new todo" />
            <button class="push" data-handler="click.prevent:addItem">Add todo</button>
            <button class="cancel" data-handler="click.prevent:toggleCreate">Cancel</button>
          </label>
        </div>
      {{else}}
        <button class="add" data-handler="click:toggleCreate">Add another</button>
      {{/if}}
    {{/watch}}
  `,data:{uiState:{adding:!1},header:{title:"This is my list of things to do",description:"just general items that need done around the house"},todos:[{done:!1,name:"Grocery Shopping",description:"get the milk, eggs and bread"},{done:!0,name:"Paint the House",description:"buy the paint and then pain the house"}]},eventHandlers:{deleteToDo({event:a,data:b}){const c=a.target.parentNode.dataset.key,d=b.todos.findIndex(a=>a.name===c);b.todos.splice(d,1)},addItem({data:a,$container:b}){const c=b.querySelector("#new-todo-label");a.todos.push({done:!1,name:c.value}),c.value="",c.focus()},toggleDone({event:a,data:b}){console.log("fired");const c=a.target.parentNode.dataset.key,d=b.todos.find(a=>a.name===c);d.done=!d.done},toggleCreate({data:a}){a.uiState.adding=!a.uiState.adding}}});return m});