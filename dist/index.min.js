!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Vbars=t()}(this,(function(){"use strict";var e={isKeyedNode:e=>!!e.children.length&&Array.from(e.children).every(e=>e.dataset.vbarsKey),keyedChildren:e=>Array.from(e.children).filter(e=>e.dataset.vbarsKey),setKey(e,t,r){const n=t.split(".");n.reduce((a,o,s)=>{if(!(o in a))throw new Error(`${t} was not found in object`,e);return s+1===n.length&&(a[o]=r),a[o]},e)}};function t(e){const{eventType:t,methodName:r,args:n}=JSON.parse(e.dataset.vbarsHandler);let[a,...o]=t.split(".");return{listener:a,augs:o,methodName:r,args:n}}function r({$root:r,methods:n,proxyData:a}){function o(e,t){const r=e.querySelectorAll(`[data-vbars-${t.toLowerCase()}]`);return e.dataset[t]?r.concat(e):r}const s=t=>e.setKey(a,event.target.dataset.vbarsBind,t.currentTarget.value);function c(e){const o=e.target,{augs:s,methodName:c,args:d}=t(o);s.includes("prevent")&&e.preventDefault(),s.includes("stop")&&e.stopPropagation();const i=Array.from(r.querySelectorAll("[data-vbars-ref]")).reduce((e,t)=>(e[t.dataset.vbarsRef]=t,e),{});n[c]({event:e,data:a,$root:r,$refs:i},...d)}return{remove(e){o(e,"Handler").forEach(e=>{const{listener:r,methodName:n}=t(e);e.removeEventListener(r,c)}),o(e,"Bind").forEach(e=>{e.removeEventListener("input",s)})},add(e){o(e,"Handler").forEach(e=>{const{listener:r,augs:n,methodName:a,args:o}=t(e);e.addEventListener(r,c)}),o(e,"Bind").forEach(e=>{e.addEventListener("input",s)})}}}var n={register({instance:e,methods:t}){function r(){const[e,...t]=arguments,r=t.splice(-1,1);if(t.some(e=>null!==e&&"object"==typeof e))throw new Error(`must only pass primitives as argument to a handler. ${JSON.stringify(t,null,2)}`);const a=JSON.stringify({methodName:r[0].name,eventType:e,args:t});return n({handler:a})}const n=t=>new e.SafeString(Object.keys(t).map(e=>`data-vbars-${e}='${t[e]}'`).join(" "));e.registerHelper("watch",(e,t)=>{const r=`${t.loc.start.column}${t.loc.start.line}${t.loc.end.column}${t.loc.end.line}`;return n({id:r,watch:e})}),e.registerHelper("keyed",e=>n({key:e})),e.registerHelper("isChecked",e=>e?"checked":""),e.registerHelper("bind",e=>n({bind:e})),e.registerHelper("ref",e=>n({ref:e})),Object.keys(t).forEach(t=>e.registerHelper(t,r))}};return{create({template:t,data:a,methods:o={},Handlebars:s=window.Handlebars}){let c,d;if(!s)throw new Error("Vbars need Handlebars in order to run!");const i=s.create(),l=function e(t,r,n=[]){return new Proxy(t,{get:function(t,a){const o=Reflect.get(...arguments);return null!==o&&"object"==typeof o&&"methods"!==a?e(o,r,n.concat(a)):o},set:function(e,t){const a=Reflect.set(...arguments);return r({path:n.concat(t).join(".")}),a},deleteProperty:function(e,t){const a=Reflect.deleteProperty(...arguments);return r({path:n.concat(t).join(".")}),a}})}(a,({path:e})=>d.patch(c,e));n.register({instance:i,methods:o});const u=i.compile(t);return{VbarsComponent:!0,instance:i,data:l,render(t){c=t,d=function({$root:t,templateFn:n,proxyData:a}){const o=document.createElement("div"),s=r(...arguments),c=()=>o.innerHTML=n(a);function d(){c(),t.innerHTML=o.innerHTML,s.add(t)}function i(e,t){const r=e.cloneNode(!0);s.remove(t),t.parentNode.replaceChild(r,t),s.add(r)}function l(e,t){const r=t.cloneNode(!0);e.appendChild(r),s.add(r)}function u(t,r){e.keyedChildren(r).forEach(e=>{const r=t.querySelector(`[data-vbars-key="${e.dataset.vbarsKey}"]`);r?r.isEqualNode(e)||i(r,e):(s.remove(e),e.remove())}),e.keyedChildren(t).forEach(e=>{r.querySelector(`[data-vbars-key="${e.dataset.vbarsKey}"]`)||l(r,e)})}function f(t,r){c(),Array.from(o.querySelectorAll("[data-vbars-watch]")).filter(e=>r.startsWith(e.dataset.vbarsWatch)).forEach(r=>{const n=t.querySelector(`[data-vbars-id="${r.dataset.vbarsId}"]`);e.isKeyedNode(r)?u(r,n):i(r,n)})}return{$el:o,render:c,replace:d,patch:f}}({$root:c,templateFn:u,proxyData:l,methods:o}),d.replace()}}}}}));
//# sourceMappingURL=index.min.js.map
