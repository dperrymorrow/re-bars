!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Vbars=t()}(this,function(){"use strict";const e="#000000",t={error:"💥",warn:"⚠️",log:"💬"},r={msg:`background: ${e}; color: ${"#FFF"}; font-weight: bold;`,warn:[`background: ${"#d38809"}; color:${e}; font-weight: bold;`,`background: ${"#ffc934"}; color:${e}; font-weight: bold;`],error:[`background: ${"#b74129"}; color:${e}; font-weight: bold;`,`background: ${"#e95233"}; color:${e}; font-weight: bold;`],log:[`background: ${"#0ea760"}; color:${e}; font-weight: bold;`,`background: ${"#02d479"}; color:${e}; font-weight: bold;`]};function n(e="MSG"){const n=Array.isArray(e)?e:[e],o=(e,o,a)=>{e=`${t[o]} ${e}`;const c=n.slice(0,2).concat([e]).map(e=>`%c ${e} `).join(""),d=[r[o][0]];n.length>1&&d.push(r[o][1]),d.push(r.msg);const l=[c].concat(d);(null===a?console.log:console.groupCollapsed)(...l),a&&(console.log(a),console.groupEnd())};return{warn:(e,t=null)=>o(e,"warn",t),error:(e,t=null)=>o(e,"error",t),log:(e,t=null)=>o(e,"log",t)}}const o=n("utils");var a={watchId:e=>`reactive-key-${e.loc.start.column}${e.loc.start.line}${e.loc.end.column}${e.loc.end.line}`,isKeyedNode:e=>!!e.children.length&&Array.from(e.children).every(e=>e.dataset.key),keyedChildren:e=>Array.from(e.children).filter(e=>e.dataset.key),swapNodes(e,t){const r=e.cloneNode(!0);return t.parentNode.replaceChild(r,t),r},addChild(e,t){const r=t.cloneNode(!0);return e.appendChild(r),r},setKey(e,t,r){const n=t.split(".");n.reduce((a,c,d)=>(c in a||o.warn(`${t} was not found in object`,e),d+1===n.length&&(a[c]=r),a[c]),e)}};const c=n("Event Handlers");const d=n("V-DOM");function l({$root:e,templateFn:t,proxyData:r}){const n=document.createElement("div"),o=function({$root:e,methods:t,proxyData:r}){return{add(n){n.querySelectorAll("[data-vbars-handler]").forEach(o=>{const[a,...d]=JSON.parse(o.dataset.vbarsHandler),[l,s]=a.split(":");let[i,...u]=l.split(".");s in t?(o.addEventListener(i,o=>{u.includes("prevent")&&(o.stopPropagation(),o.preventDefault()),t[s]({event:o,data:r,$root:e,$container:n},...d)}),delete o.dataset.vbarsHandler):c.warn(`${s} not in event methods`,t)}),n.querySelectorAll("[data-vbars-bind]").forEach(e=>{e.addEventListener("input",t=>{a.setKey(r,e.dataset.vbarsBind,t.currentTarget.value)})})}}}(...arguments),l=()=>n.innerHTML=t(r);return{$el:n,render:l,replace:function(){l(),e.innerHTML=n.innerHTML,o.add(e)},patch:function(e,t){var r,c;l(),Array.from(n.querySelectorAll("[data-vbars-watch]")).filter(e=>t.startsWith(e.dataset.vbarsWatch)).forEach(r=>{const n=e.querySelector(`#${r.getAttribute("id")}`);a.isKeyedNode(r)?(d.log(`comparing keyed arrays ${t}`,r),r=r,c=n,a.keyedChildren(c).forEach(e=>{const t=r.querySelector(`[data-key="${e.dataset.key}"]`);if(t){if(!t.isEqualNode(e)){const r=a.swapNodes(t,e);o.add(r)}}else e.remove()}),a.keyedChildren(r).forEach(e=>{if(!c.querySelector(`[data-key="${e.dataset.key}"]`)){const t=a.addChild(c,e);o.add(t)}})):(n.innerHTML=r.innerHTML,d.log(`patching ${t}`,r),o.add(n))})}}}var s={register(e,t){e.registerHelper("watch",(e,r)=>{return`<span id="${a.watchId(r)}" data-vbars-watch="${e}">${r.fn(t)}</span>`}),e.registerHelper("handler",function(){const t=Array.from(arguments);return t.splice(-1,1),new e.SafeString(`data-vbars-handler='${JSON.stringify(t)}'`)})}};return{create({template:e,data:t,methods:r={}}){let n,o;const a=window.Handlebars.create(),c=function e(t,r,n=[]){return new Proxy(t,{get:function(t,o){const a=Reflect.get(...arguments);return null!==a&&"object"==typeof a&&"methods"!==o?e(a,r,n.concat(o)):a},set:function(e,t){const o=Reflect.set(...arguments);return r({path:n.concat(t).join(".")}),o},deleteProperty:function(e,t){const o=Reflect.deleteProperty(...arguments);return r({path:n.concat(t).join(".")}),o}})}(t,({path:e})=>o.patch(n,e));s.register(a,c);const d=a.compile(e);return{instance:a,data:c,render(e){(o=l({$root:n=e,templateFn:d,proxyData:c,methods:r})).replace()}}}}});