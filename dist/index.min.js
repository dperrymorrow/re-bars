!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e=e||self).ReBars=n()}(this,(function(){"use strict";let e=1;var n={findComponent:e=>document.getElementById(e),wrapTemplate:(e,n)=>`<span id="${e}">${n}</span>`,findRefs(e){return Array.from(this.findComponent(e).querySelectorAll("[data-rbs-ref]")).reduce((e,n)=>(e[n.dataset.rbsRef]=n,e),{})},shouldRender:(e,n)=>(Array.isArray(n)?n:[n]).some(n=>{if(e===n||".*"===n)return!0;const t=e.split(".");return n.split(".").every((e,n)=>e===t[n]||"*"===e)}),randomId:()=>`rbs${e++}`,setKey(e,n,t){const r=n.split(".");r.reduce((o,s,a)=>{if(!(s in o))throw new Error(`${n} was not found in object`,e);return a+1===r.length&&(o[s]=t),o[s]},e)}};function t(e,{data:t,instance:r,methods:o,id:s,props:a,app:i,name:c}){const p=`rbs.apps.${i.id}.comp.${s}.ev`;e.ev.bind=(e,r)=>n.setKey(t,r,e.currentTarget.value),e.ev.method=function(){const[e,r,...i]=arguments;if(!(r in o))throw new Error(`${r} was not found in methods for component '${c}'`);return o[r].call(o,{data:t,props:a,methods:o,$refs:n.findRefs(s)},e,...i)},r.registerHelper("method",(function(){const[e,...n]=arguments,[t,o="click"]=e.split(":");n.splice(-1,1);const s=[t].concat(n).map(e=>{if(null!==e&&"object"==typeof parm)throw new Error(`must only pass primitives as argument to a handler. ${JSON.stringify(n,null,2)}`);return"string"==typeof e?`'${e}'`:e});return new r.SafeString(`on${o}="${p}.method(event,${s.join(",")})"`)})),r.registerHelper("bind",e=>new r.SafeString(`oninput="${p}.bind(event, '${e}')"`))}function r(e,{instance:t,name:r}){const o=(e,n=!0)=>{if(void 0===e)throw new Error(`have passed undefined to watch helper in component '${r}'`);return"object"==typeof e?`${e.ReBarsPath}${n?".*":""}`:e},s=(t,r)=>{const o=n.randomId();return e.renders[o]={path:t,render:r},o};t.registerHelper("debug",(function(e){const r=()=>`<pre class="debug">${JSON.stringify(e,null,2)}</pre>`,a=s(o(e),r);return new t.SafeString(n.wrapTemplate(a,r()))})),t.registerHelper("watch",(function(...e){const{fn:t}=e.pop(),r=e.map(e=>o(e,!1)).join(".").split(","),a=s(r,()=>t(this));return n.wrapTemplate(a,t(this))}))}return function({$el:e,root:o,Handlebars:s=window.Handlebars}){if(!s)throw new Error("ReBars need Handlebars in order to run!");window.ReBars=window.ReBars||{},window.ReBars.apps=window.ReBars.apps||{},window.rbs=window.ReBars;const a=n.randomId(),i=window.ReBars.apps[a]={comp:{}},c={component:p,id:a,storage:i};function p({template:e,methods:o={},props:a={},hooks:p={},name:d,components:f={},data:m,watchers:u={},helpers:l={}}){const h=n.randomId(),w=s.create();if(!d)throw new Error("Each ReBars component should have a name");i.comp[h]={renders:{},ev:{},hooks:p,name:d},p.created&&p.created({data:m,methods:o});const g=function({id:e,app:t,props:r={},methods:o,rawData:s={},watchers:a={},name:i}){const c=t.storage.comp[e];function p(e){Object.entries(a).forEach(([t,s])=>{n.shouldRender(e,t)&&s({data:d,props:r,methods:o})}),Object.entries(c.renders).forEach(([t,r])=>{if(n.shouldRender(e,r.path)){const e=n.findComponent(t);if(e){const n=document.createElement("div");n.innerHTML=r.render(),e.innerHTML!==n.innerHTML&&(e.innerHTML=n.innerHTML)}else delete c.renders[t]}}),Object.keys(t.storage.comp).forEach(e=>{n.findComponent(e)||delete t.storage.comp[e]})}const d=function e(n,t=[]){return new Proxy(n,{get:function(n,r){if("ReBarsPath"===r)return t.join(".");const o=Reflect.get(...arguments);return null!==o&&"object"==typeof o&&"methods"!==r?e(o,t.concat(r)):o},set:function(e,n){const r=Reflect.set(...arguments);return p(t.concat(n).join(".")),r},deleteProperty:function(e,n){const r=Reflect.deleteProperty(...arguments);return p(t.concat(n).join(".")),r}})}({...s,...r});return d}({id:h,app:c,props:a,methods:o,rawData:m,watchers:u,name:d}),$=w.compile(e);if(function({instance:e,app:n,id:o,components:s,helpers:a,name:i}){const c=n.storage.comp[o];r(c,...arguments),t(c,...arguments),e.registerHelper("component",(function(t,{hash:r}){return Object.entries(r).forEach(([e,n])=>{if("function"==typeof n)throw new Error(`cannot pass a function as a prop. in '${i}' child '${t}' prop '${e}'`)}),new e.SafeString(n.component({...s[t],props:r}))})),Object.entries(a).forEach(([n,t])=>e.registerHelper(n,t)),e.registerHelper("ref",n=>new e.SafeString(`data-rbs-ref="${n}"`))}({props:a,methods:o,id:h,components:f,instance:w,helpers:l,data:g,name:d,app:c}),"attached"in p){const e=setInterval(()=>{n.findComponent(h)&&(clearInterval(e),p.attached({methods:o,data:g,props:a,$refs:n.findRefs(h)}))},10)}return n.wrapTemplate(h,$(g))}return e.innerHTML=p(o),{component:p,storage:i}}}));
//# sourceMappingURL=index.min.js.map
