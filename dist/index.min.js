!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e=e||self).Vbars=n()}(this,(function(){"use strict";var e={findComponent:e=>document.getElementById(e),wrapTemplate:(e,n)=>`<span id="${e}">${n}</span>`,findRefs(e){return Array.from(this.findComponent(e).querySelectorAll("[data-vbars-ref]")).reduce((e,n)=>(e[n.dataset.vbarsRef]=n,e),{})},name:"Vbars",shouldRender(e,n){return e===n||this.getWildCard(e)===n},getWildCard(e){const n=e.split(".").slice(0,-1);return n.push("*"),n.join(".")},randomId:()=>"_"+Math.random().toString(36).substr(2,9),setKey(e,n,t){const r=n.split(".");r.reduce((o,a,s)=>{if(!(a in o))throw new Error(`${n} was not found in object`,e);return s+1===r.length&&(o[a]=t),o[a]},e)}},n={register({id:n,instance:r,methods:o,components:a,proxyData:s,parentData:d,props:i}){const c={handlers:{bind:(n,t)=>e.setKey(s,t,n.currentTarget.value)},renders:{}};function p(){const[t,...o]=arguments,a=o.splice(-1,1);if(o.some(e=>null!==e&&"object"==typeof e))throw new Error(`must only pass primitives as argument to a handler. ${JSON.stringify(o,null,2)}`);const s={methodName:a[0].name,eventType:t,args:o};return new r.SafeString(`on${t}="${e.name}.components.${n}.handlers.${s.methodName}(${o.join(",")})"`)}window[e.name]=window[e.name]||{components:{}},window[e.name].components[n]=c,r.registerHelper("debug",e=>new r.SafeString(`<pre class="debug">${JSON.stringify(e,null,2)}</pre>`)),r.registerHelper("watch",(function(n,{fn:t}){const r=e.randomId();return c.renders[r]={render:t.bind(null,s),path:n},e.wrapTemplate(r,t(s))})),r.registerHelper("watchEach",(function(n,t,{fn:r}){return n.map((n,o)=>{const a=e.randomId();return c.renders[a]={render:r.bind(null,n),path:`${t}.${o}.*`},e.wrapTemplate(a,r(n))})})),Object.keys(a).forEach(e=>{r.registerHelper(e,(function(n){return new r.SafeString(t.component({...a[e],parentData:s,props:n.hash}))}))}),r.registerHelper("isChecked",e=>e?"checked":""),r.registerHelper("ref",e=>new r.SafeString(`data-vbars-ref="${e}"`)),r.registerHelper("bind",t=>new r.SafeString(`oninput="${e.name}.components.${n}.handlers.bind(event, '${t}')"`)),Object.keys(o).forEach(t=>{c.handlers[t]=function(){return o[t].call(o,{data:s,parentData:d,props:i,$refs:e.findRefs(n),event:event},...arguments)},r.registerHelper(t,p)})}},t={component({template:t,data:r={},components:o={},methods:a={},parentData:s={},props:d={},hooks:i={},Handlebars:c=window.Handlebars}){if(!c)throw new Error("Vbars need Handlebars in order to run!");const p=e.randomId(),l=c.create();i.created&&i.created(...arguments);const f=function e(n,t,r=[]){return new Proxy(n,{get:function(n,o){const a=Reflect.get(...arguments);return null!==a&&"object"==typeof a&&"methods"!==o?e(a,t,r.concat(o)):a},set:function(e,n){const o=Reflect.set(...arguments);return t({path:r.concat(n).join(".")}),o},deleteProperty:function(e,n){const o=Reflect.deleteProperty(...arguments);return t({path:r.concat(n).join(".")}),o}})}(r,({path:n})=>{const t=window[e.name].components[p];Object.keys(t.renders).forEach(r=>{const o=t.renders[r];if(e.shouldRender(n,o.path)){const n=e.findComponent(r);n?n.innerHTML=o.render():delete t[r]}}),setTimeout(()=>{Object.keys(window[e.name].components).forEach(n=>{e.findComponent(n)||delete window[e.name].components[n]})},100)}),m=l.compile(t);if(n.register({id:p,instance:l,methods:a,components:o,proxyData:f,parentData:s,props:d}),"attached"in i){const n=setInterval(()=>{e.findComponent(p)&&(clearInterval(n),i.attached({methods:a,data:f,parentData:s,props:d,$refs:e.findRefs(p)}))},100)}return e.wrapTemplate(p,m(r))}};return t}));
//# sourceMappingURL=index.min.js.map
