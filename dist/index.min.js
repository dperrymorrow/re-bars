!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e=e||self).ReBars=n()}(this,(function(){"use strict";let e=1;var n={findComponent:e=>document.getElementById(e),wrapTemplate:(e,n)=>`<span id="${e}">${n}</span>`,findRefs(e){return Array.from(this.findComponent(e).querySelectorAll("[data-rbs-ref]")).reduce((e,n)=>(e[n.dataset.rbsRef]=n,e),{})},shouldRender(e,n){if(e===n)return!0;const r=e.split(".");return n.split(".").every((e,n)=>e===r[n]||"*"===e)},randomId:()=>`rbs${e++}`,setKey(e,n,r){const t=n.split(".");t.reduce((o,a,s)=>{if(!(a in o))throw new Error(`${n} was not found in object`,e);return s+1===t.length&&(o[a]=r),o[a]},e)}};function r({id:e,app:r,props:t,data:o,watchers:a,name:s}){const c=r.storage.comp[e];function p(e){Object.keys(a).forEach(r=>{n.shouldRender(e,r)&&a[r].call(null,{data:i,props:t})}),Object.keys(c.renders).forEach(r=>{const t=c.renders[r];if(n.shouldRender(e,t.path)){const e=n.findComponent(r);e?e.innerHTML=t.render():delete c.renders[r]}}),Object.keys(r.storage.comp).forEach(e=>{n.findComponent(e)||delete r.storage.comp[e]})}const i=function e(n,r=[]){return new Proxy(n,{get:function(n,t){if("ReBarsPath"===t)return r.join(".");const o=Reflect.get(...arguments);return null!==o&&"object"==typeof o&&"methods"!==t?e(o,r.concat(t)):o},set:function(e,n){const t=Reflect.set(...arguments);return p(r.concat(n).join(".")),t},deleteProperty:function(e,n){const t=Reflect.deleteProperty(...arguments);return p(r.concat(n).join(".")),t}})}({...o,...t});return i}function t(e,{proxyData:r,instance:t,methods:o,id:a,props:s,app:c}){const p=`rbs.apps.${c.id}.comp.${a}.ev`;e.ev.bind=(e,t)=>n.setKey(r,t,e.currentTarget.value),e.ev.method=function(){const[e,t,...c]=arguments;return o[t].call(o,{data:r,props:s,methods:o,$refs:n.findRefs(a)},e,...c)},t.registerHelper("method",(function(){const[e,n,...r]=arguments;r.splice(-1,1);const o=[n].concat(r).map(e=>{if(null!==e&&"object"==typeof parm)throw new Error(`must only pass primitives as argument to a handler. ${JSON.stringify(r,null,2)}`);return"string"==typeof e?`'${e}'`:e});return new t.SafeString(`on${e}="${p}.method(event, ${o.join(",")})"`)})),t.registerHelper("bind",e=>new t.SafeString(`oninput="${p}.bind(event, '${e}')"`))}function o(e,{instance:r,proxyData:t}){r.registerHelper("watch",(function(r,{fn:o}){if(null===r)throw new Error("Rebars: cannot pass null to watch helper, pass a string or Object");"object"==typeof r&&(r=`${r.ReBarsPath}.*`);const a=n.randomId();return e.renders[a]={render:()=>o(t),path:r},n.wrapTemplate(a,o(t))})),r.registerHelper("watchEach",(function(r,{fn:t}){if(!Array.isArray(r))throw new Error("watchEach must be passed an Array");const o=r.ReBarsPath;return r.map((r,a)=>{const s=n.randomId();return e.renders[s]={render:()=>t(r),path:`${o}.${a}.*`},n.wrapTemplate(s,t(r))})}))}function a({instance:e,app:n,id:r,proxyData:a,components:s}){const c=n.storage.comp[r];o(c,...arguments),t(c,...arguments),e.registerHelper("component",(function(r,{hash:t}){return new e.SafeString(n.component({...s[r],parentData:a,props:t}))})),e.registerHelper("isChecked",e=>e?"checked":""),e.registerHelper("ref",n=>new e.SafeString(`data-rbs-ref="${n}"`)),e.registerHelper("debug",n=>new e.SafeString(`<pre class="debug">${JSON.stringify(n,null,2)}</pre>`))}return function({$el:e,root:t,Handlebars:o=window.Handlebars}){if(!o)throw new Error("ReBars need Handlebars in order to run!");window.ReBars=window.ReBars||{},window.ReBars.apps=window.ReBars.apps||{},window.rbs=window.ReBars;const s=n.randomId(),c=window.ReBars.apps[s]={comp:{}},p={component:i,id:s,storage:c};function i({template:e,components:t={},methods:s={},props:i={},hooks:d={},watchers:f={},data:l={},name:u}){const m=n.randomId(),h=o.create();if(!u)throw new Error("Each ReBars component should have a name");c.comp[m]={renders:{},ev:{},hooks:d,name:u},d.created&&d.created(...arguments);const w=r({id:m,app:p,props:i,data:l,watchers:f,name:u}),g=h.compile(e);if(a({id:m,instance:h,app:p,methods:s,components:t,proxyData:w,props:i,watchers:f}),"attached"in d){const e=setInterval(()=>{n.findComponent(m)&&(clearInterval(e),d.attached({watchers:f,methods:s,data:w,props:i,$refs:n.findRefs(m)}))},10)}return n.wrapTemplate(m,g(w))}return e.innerHTML=i(t),{component:i,storage:c}}}));
//# sourceMappingURL=index.min.js.map
