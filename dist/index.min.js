!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e=e||self).ReBars=n()}(this,(function(){"use strict";var e={findComponent:e=>document.getElementById(e),wrapTemplate:(e,n)=>`<span id="${e}">${n}</span>`,findRefs(e){return Array.from(this.findComponent(e).querySelectorAll("[data-vbars-ref]")).reduce((e,n)=>(e[n.dataset.vbarsRef]=n,e),{})},name:"ReBars",shouldRender(e,n){return e===n||this.getWildCard(e)===n},getWildCard(e){const n=e.split(".").slice(0,-1);return n.push("*"),n.join(".")},randomId:()=>"_"+Math.random().toString(36).substr(2,9),setKey(e,n,t){const r=n.split(".");r.reduce((o,a,s)=>{if(!(a in o))throw new Error(`${n} was not found in object`,e);return s+1===r.length&&(o[a]=t),o[a]},e)}};function n({id:n,storage:t,rawData:r}){function o(r){const o=t.components[n];Object.keys(o.renders).forEach(n=>{const a=o.renders[n];if(e.shouldRender(r,a.path)){const r=e.findComponent(n);r?r.innerHTML=a.render():delete t.components[n]}}),Object.keys(t.components).forEach(n=>{e.findComponent(n)||delete t.components[n]})}return function e(n,t=[]){return new Proxy(n,{get:function(n,r){const o=Reflect.get(...arguments);return null!==o&&"object"==typeof o&&"methods"!==r?e(o,t.concat(r)):o},set:function(e,n){const r=Reflect.set(...arguments);return o(t.concat(n).join(".")),r},deleteProperty:function(e,n){const r=Reflect.deleteProperty(...arguments);return o(t.concat(n).join(".")),r}})}(r)}var t={register({id:n,instance:t,app:r,methods:o,components:a,proxyData:s,parentData:c,props:d}){const i=r.storage.components[n];i.handlers.bind=(n,t)=>e.setKey(s,t,n.currentTarget.value);const p=`${r.name}.storage.components.${n}.handlers`;function f(){const[e,...n]=arguments,r=n.splice(-1,1);if(n.some(e=>null!==e&&"object"==typeof e))throw new Error(`must only pass primitives as argument to a handler. ${JSON.stringify(n,null,2)}`);const o={methodName:r[0].name,eventType:e,args:n};return new t.SafeString(`on${e}="${p}.${o.methodName}(${n.join(",")})"`)}t.registerHelper("debug",e=>new t.SafeString(`<pre class="debug">${JSON.stringify(e,null,2)}</pre>`)),t.registerHelper("watch",(function(n,{fn:t}){const r=e.randomId();return i.renders[r]={render:t.bind(null,s),path:n},e.wrapTemplate(r,t(s))})),t.registerHelper("watchEach",(function(n,t,{fn:r}){return n.map((n,o)=>{const a=e.randomId();return i.renders[a]={render:r.bind(null,n),path:`${t}.${o}.*`},e.wrapTemplate(a,r(n))})})),Object.keys(a).forEach(e=>{t.registerHelper(e,(function(n){return new t.SafeString(r.component({...a[e],parentData:s,props:n.hash}))}))}),t.registerHelper("isChecked",e=>e?"checked":""),t.registerHelper("ref",e=>new t.SafeString(`data-vbars-ref="${e}"`)),t.registerHelper("bind",e=>new t.SafeString(`oninput="${p}.bind(event, '${e}')"`)),Object.keys(o).forEach(r=>{i.handlers[r]=function(){return o[r].call(o,{data:s,parentData:c,props:d,$refs:e.findRefs(n),event:event},...arguments)},t.registerHelper(r,f)})}};return function({$el:r,name:o,root:a,Handlebars:s=window.Handlebars}){if(!s)throw new Error("ReBars need Handlebars in order to run!");const c={components:{}};function d({template:r,data:a={},components:i={},methods:p={},parentData:f={},props:l={},hooks:u={}}){const m=e.randomId(),h=s.create();u.created&&u.created(...arguments),c.components[m]={handlers:{},renders:{}};const g=n({rawData:a,storage:c,id:m}),w=h.compile(r);if(t.register({id:m,app:{storage:c,component:d,name:o},instance:h,methods:p,components:i,proxyData:g,parentData:f,props:l}),"attached"in u){const n=setInterval(()=>{e.findComponent(m)&&(clearInterval(n),u.attached({methods:p,data:g,parentData:f,props:l,$refs:e.findRefs(m)}))},10)}return e.wrapTemplate(m,w(a))}return r.innerHTML=d(a),{component:d,storage:c}}}));
//# sourceMappingURL=index.min.js.map
