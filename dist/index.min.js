!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e=e||self).ReBars=n()}(this,(function(){"use strict";var e={findComponent:e=>document.getElementById(e),wrapTemplate:(e,n)=>`<span id="${e}">${n}</span>`,findRefs(e){return Array.from(this.findComponent(e).querySelectorAll("[data-rbs-ref]")).reduce((e,n)=>(e[n.dataset.rbsRef]=n,e),{})},shouldRender(e,n){if(e===n)return!0;const t=e.split(".");return n.split(".").every((e,n)=>e===t[n]||"*"===e)},randomId:()=>"_rbs_"+Math.random().toString(36).substr(2,9),setKey(e,n,t){const r=n.split(".");r.reduce((o,a,s)=>{if(!(a in o))throw new Error(`${n} was not found in object`,e);return s+1===r.length&&(o[a]=t),o[a]},e)}};function n({id:n,app:t,parentData:r,props:o,data:a,watchers:s,name:c}){function p(a){const c=t.storage.components[n];Object.keys(s).forEach(n=>{e.shouldRender(a,n)&&s[n].call(null,{data:i,parentData:r,props:o})}),Object.keys(c.renders).forEach(n=>{const r=c.renders[n];if(e.shouldRender(a,r.path)){const o=e.findComponent(n);o?o.innerHTML=r.render():delete t.storage.components[n]}}),Object.keys(t.storage.components).forEach(n=>{e.findComponent(n)||delete t.storage.components[n]})}const i=function e(n,t=[]){return new Proxy(n,{get:function(n,r){if("ReBarsPath"===r)return t.join(".");const o=Reflect.get(...arguments);return null!==o&&"object"==typeof o&&"methods"!==r?e(o,t.concat(r)):o},set:function(e,n){const r=Reflect.set(...arguments);return p(t.concat(n).join(".")),r},deleteProperty:function(e,n){const r=Reflect.deleteProperty(...arguments);return p(t.concat(n).join(".")),r}})}(a);return i}function t(n,{proxyData:t,instance:r,methods:o,id:a,watchers:s,parentData:c,props:p,app:i}){const d=`ReBars.apps.${i.id}.components.${a}.handlers`;n.handlers.bind=(n,r)=>e.setKey(t,r,n.currentTarget.value),n.handlers.action=function(){const[n,...r]=arguments;return o[n].call(null,{methods:o,watchers:s,data:t,parentData:c,props:p,$refs:e.findRefs(a),event:event},...r)},r.registerHelper("method",(function(){const[e,n,...t]=arguments;t.splice(-1,1);const o=[n].concat(t).map(e=>{if(null!==e&&"object"==typeof parm)throw new Error(`must only pass primitives as argument to a handler. ${JSON.stringify(t,null,2)}`);return"string"==typeof e?`'${e}'`:e});return new r.SafeString(`on${e}="${d}.action(${o.join(",")})"`)})),r.registerHelper("bind",e=>new r.SafeString(`oninput="${d}.bind(event, '${e}')"`))}function r(n,{instance:t,proxyData:r}){t.registerHelper("watch",(function(t,{fn:o}){const a=e.randomId();return n.renders[a]={render:o.bind(null,r),path:t},e.wrapTemplate(a,o(r))})),t.registerHelper("watchEach",(function(t,{fn:r}){if(!Array.isArray(t))throw new Error("watchEach must be passed an Array");const o=t.ReBarsPath;return t.map((t,a)=>{const s=e.randomId();return n.renders[s]={render:r.bind(null,t),path:`${o}.${a}.*`},e.wrapTemplate(s,r(t))})}))}function o({instance:e,app:n,id:o,proxyData:a,components:s}){const c=n.storage.components[o];r(c,...arguments),t(c,...arguments),e.registerHelper("component",(function(t,{hash:r}){return new e.SafeString(n.component({...s[t],parentData:a,props:r}))})),e.registerHelper("isChecked",e=>e?"checked":""),e.registerHelper("ref",n=>new e.SafeString(`data-rbs-ref="${n}"`)),e.registerHelper("debug",n=>new e.SafeString(`<pre class="debug">${JSON.stringify(n,null,2)}</pre>`))}return function({$el:t,root:r,Handlebars:a=window.Handlebars}){if(!a)throw new Error("ReBars need Handlebars in order to run!");window.ReBars=window.ReBars||{},window.ReBars.apps=window.ReBars.apps||{};const s=e.randomId(),c=window.ReBars.apps[s]={components:{}},p={storage:c,component:i,id:s};function i({template:t,components:r={},methods:s={},parentData:i={},props:d={},hooks:f={},watchers:l={},data:u={},name:m}){const h=e.randomId(),w=a.create();if(!m)throw new Error("Each ReBars component should have a name");c.components[h]={handlers:{},renders:{},hooks:f},f.created&&f.created(...arguments);const g=n({id:h,app:p,parentData:i,props:d,data:u,watchers:l,name:m}),y=w.compile(t);if(o({id:h,instance:w,app:p,methods:s,components:r,proxyData:g,parentData:i,props:d,watchers:l}),"attached"in f){const n=setInterval(()=>{e.findComponent(h)&&(clearInterval(n),f.attached({watchers:l,methods:s,data:g,parentData:i,props:d,$refs:e.findRefs(h)}))},10)}return e.wrapTemplate(h,y(g))}return t.innerHTML=i(r),{component:i,storage:c}}}));
//# sourceMappingURL=index.min.js.map
