!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Vbars=t()}(this,(function(){"use strict";var e={isKeyedNode:e=>!!e.children.length&&Array.from(e.children).every(e=>e.dataset.vbarsKey),keyedChildren:e=>Array.from(e.children).filter(e=>e.dataset.vbarsKey),swapNodes(e,t){const r=e.cloneNode(!0);return t.parentNode.replaceChild(r,t),r},addChild(e,t){const r=t.cloneNode(!0);return e.appendChild(r),r},setKey(e,t,r){const a=t.split(".");a.reduce((n,o,s)=>{if(!(o in n))throw new Error(`${t} was not found in object`,e);return s+1===a.length&&(n[o]=r),n[o]},e)}};function t({$root:t,methods:r,proxyData:a}){return{add(n){n.querySelectorAll("[data-vbars-handler]").forEach(e=>{const{eventType:n,methodName:o,args:s}=JSON.parse(e.dataset.vbarsHandler);let[d,...c]=n.split(".");e.addEventListener(d,e=>{c.includes("prevent")&&(e.stopPropagation(),e.preventDefault());const n=Array.from(t.querySelectorAll("[data-vbars-ref]")).reduce((e,t)=>(e[t.dataset.vbarsRef]=t,e),{});r[o]({event:e,data:a,$root:t,$refs:n},...s)})}),n.querySelectorAll("[data-vbars-bind]").forEach(t=>{t.addEventListener("input",r=>{e.setKey(a,t.dataset.vbarsBind,r.currentTarget.value)})})}}}var r={register({instance:e,methods:t}){function r(){const[e,...t]=arguments,r=t.splice(-1,1);if(t.some(e=>null!==e&&"object"==typeof e))throw new Error(`must only pass primitives as argument to a handler. ${JSON.stringify(t,null,2)}`);const n=JSON.stringify({methodName:r[0].name,eventType:e,args:t});return a({handler:n})}const a=t=>new e.SafeString(Object.keys(t).map(e=>`data-vbars-${e}='${t[e]}'`).join(" "));e.registerHelper("watch",(e,t)=>{const r=`${t.loc.start.column}${t.loc.start.line}${t.loc.end.column}${t.loc.end.line}`;return a({id:r,watch:e})}),e.registerHelper("keyed",e=>a({key:e})),e.registerHelper("isChecked",e=>e?"checked":""),e.registerHelper("bind",e=>a({bind:e})),e.registerHelper("ref",e=>a({ref:e})),Object.keys(t).forEach(t=>e.registerHelper(t,r))}};return{create({template:a,data:n,methods:o={}}){let s,d;const c=window.Handlebars.create(),i=function e(t,r,a=[]){return new Proxy(t,{get:function(t,n){const o=Reflect.get(...arguments);return null!==o&&"object"==typeof o&&"methods"!==n?e(o,r,a.concat(n)):o},set:function(e,t){const n=Reflect.set(...arguments);return r({path:a.concat(t).join(".")}),n},deleteProperty:function(e,t){const n=Reflect.deleteProperty(...arguments);return r({path:a.concat(t).join(".")}),n}})}(n,({path:e})=>d.patch(s,e));r.register({instance:c,methods:o});const l=c.compile(a);return{instance:c,data:i,render(r){s=r,d=function({$root:r,templateFn:a,proxyData:n}){const o=document.createElement("div"),s=t(...arguments),d=()=>o.innerHTML=a(n);function c(){d(),r.innerHTML=o.innerHTML,s.add(r)}function i(t,r){e.keyedChildren(r).forEach(r=>{const a=t.querySelector(`[data-vbars-key="${r.dataset.vbarsKey}"]`);a?a.isEqualNode(r)||s.add(e.swapNodes(a,r)):r.remove()}),e.keyedChildren(t).forEach(t=>{r.querySelector(`[data-vbars-key="${t.dataset.vbarsKey}"]`)||s.add(e.addChild(r,t))})}function l(t,r){d(),Array.from(o.querySelectorAll("[data-vbars-watch]")).filter(e=>r.startsWith(e.dataset.vbarsWatch)).forEach(r=>{const a=t.querySelector(`[data-vbars-id="${r.dataset.vbarsId}"]`);e.isKeyedNode(r)?i(r,a):s.add(e.swapNodes(r,a))})}return{$el:o,render:d,replace:c,patch:l}}({$root:s,templateFn:l,proxyData:i,methods:o}),d.replace()}}}}}));
//# sourceMappingURL=index.min.js.map
