!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e=e||self).ReBars=n()}(this,(function(){"use strict";let e=1;var n={findComponent:e=>document.getElementById(e),wrapTemplate:(e,n)=>`<span id="${e}">${n}</span>`,findRefs(e){return Array.from(this.findComponent(e).querySelectorAll("[data-rbs-ref]")).reduce((e,n)=>(e[n.dataset.rbsRef]=n,e),{})},shouldRender(e,n){if(e===n)return!0;const r=e.split(".");return n.split(".").every((e,n)=>e===r[n]||"*"===e)},randomId:()=>`rbs${e++}`,setKey(e,n,r){const t=n.split(".");t.reduce((o,a,s)=>{if(!(a in o))throw new Error(`${n} was not found in object`,e);return s+1===t.length&&(o[a]=r),o[a]},e)}};function r({id:e,app:r,props:t={},data:o={},watchers:a={},name:s}){const c=r.storage.comp[e];function i(e){Object.keys(a).forEach(r=>{n.shouldRender(e,r)&&a[r].call(null,{data:p,props:t})}),Object.keys(c.renders).forEach(r=>{const t=c.renders[r];if(n.shouldRender(e,t.path)){const e=n.findComponent(r);e?e.innerHTML=t.render():delete c.renders[r]}}),Object.keys(r.storage.comp).forEach(e=>{n.findComponent(e)||delete r.storage.comp[e]})}const p=function e(n,r=[]){return new Proxy(n,{get:function(n,t){if("ReBarsPath"===t)return r.join(".");const o=Reflect.get(...arguments);return null!==o&&"object"==typeof o&&"methods"!==t?e(o,r.concat(t)):o},set:function(e,n){const t=Reflect.set(...arguments);return i(r.concat(n).join(".")),t},deleteProperty:function(e,n){const t=Reflect.deleteProperty(...arguments);return i(r.concat(n).join(".")),t}})}({...o,...t});return p}function t(e,{proxyData:r,instance:t,methods:o,id:a,props:s,app:c}){const i=`rbs.apps.${c.id}.comp.${a}.ev`;e.ev.bind=(e,t)=>n.setKey(r,t,e.currentTarget.value),e.ev.method=function(){const[e,t,...c]=arguments;return o[t].call(o,{data:r,props:s,methods:o,$refs:n.findRefs(a)},e,...c)},t.registerHelper("method",(function(){const[e,n,...r]=arguments;r.splice(-1,1);const o=[n].concat(r).map(e=>{if(null!==e&&"object"==typeof parm)throw new Error(`must only pass primitives as argument to a handler. ${JSON.stringify(r,null,2)}`);return"string"==typeof e?`'${e}'`:e});return new t.SafeString(`on${e}="${i}.method(event, ${o.join(",")})"`)})),t.registerHelper("bind",e=>new t.SafeString(`oninput="${i}.bind(event, '${e}')"`))}function o(e,{instance:r,proxyData:t}){r.registerHelper("watch",(function(r,{fn:o}){if(null===r)throw new Error("Rebars: cannot pass null to watch helper, pass a string or Object");"object"==typeof r&&(r=`${r.ReBarsPath}.*`);const a=n.randomId();return e.renders[a]={render:()=>o(t),path:r},n.wrapTemplate(a,o(t))})),r.registerHelper("watchEach",(function(r,{fn:t}){if(!Array.isArray(r))throw new Error("watchEach must be passed an Array");const o=r.ReBarsPath;return r.map((r,a)=>{const s=n.randomId();return e.renders[s]={render:()=>t(r),path:`${o}.${a}.*`},n.wrapTemplate(s,t(r))})}))}function a({instance:e,app:n,id:r,components:a={}}){const s=n.storage.comp[r];o(s,...arguments),t(s,...arguments),e.registerHelper("component",(function(r,{hash:t}){return new e.SafeString(n.component({...a[r],props:t}))})),e.registerHelper("isChecked",e=>e?"checked":""),e.registerHelper("ref",n=>new e.SafeString(`data-rbs-ref="${n}"`)),e.registerHelper("debug",n=>new e.SafeString(`<pre class="debug">${JSON.stringify(n,null,2)}</pre>`))}return function({$el:e,root:t,Handlebars:o=window.Handlebars}){if(!o)throw new Error("ReBars need Handlebars in order to run!");window.ReBars=window.ReBars||{},window.ReBars.apps=window.ReBars.apps||{},window.rbs=window.ReBars;const s=n.randomId(),c=window.ReBars.apps[s]={comp:{}},i={component:p,id:s,storage:c};function p({template:e,methods:t={},props:s={},hooks:p={},name:d}){const f=n.randomId(),l=o.create();if(!d)throw new Error("Each ReBars component should have a name");c.comp[f]={renders:{},ev:{},hooks:p,name:d},p.created&&p.created(...arguments);const u=r({...arguments[0],id:f,app:i}),m=l.compile(e);if(a({...arguments[0],id:f,instance:l,proxyData:u,app:i}),"attached"in p){const e=setInterval(()=>{n.findComponent(f)&&(clearInterval(e),p.attached({methods:t,data:u,props:s,$refs:n.findRefs(f)}))},10)}return n.wrapTemplate(f,m(u))}return e.innerHTML=p(t),{component:p,storage:c}}}));
//# sourceMappingURL=index.min.js.map
