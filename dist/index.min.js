!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Vbars=t()}(this,function(){"use strict";var e={isKeyedNode:e=>!!e.children.length&&Array.from(e.children).every(e=>e.dataset.key),keyedChildren:e=>Array.from(e.children).filter(e=>e.dataset.key),swapNodes(e,t){const r=e.cloneNode(!0);return t.parentNode.replaceChild(r,t),r},addChild(e,t){const r=t.cloneNode(!0);return e.appendChild(r),r},setKey(e,t,r){const n=t.split(".");n.reduce((a,o,d)=>{if(!(o in a))throw new Error(`${t} was not found in object`,e);return d+1===n.length&&(a[o]=r),a[o]},e)}};function t({$root:t,templateFn:r,proxyData:n}){const a=document.createElement("div"),o=function({$root:t,methods:r,proxyData:n}){return{add(a){a.querySelectorAll("[data-vbars-handler]").forEach(e=>{const[o,...d]=JSON.parse(e.dataset.vbarsHandler),[s,c]=o.split(":");let[i,...l]=s.split(".");if(!(c in r))throw new Error(`${c} not in event methods`,r);e.addEventListener(i,e=>{l.includes("prevent")&&(e.stopPropagation(),e.preventDefault()),r[c]({event:e,data:n,$root:t,$container:a},...d)}),delete e.dataset.vbarsHandler}),a.querySelectorAll("[data-vbars-bind]").forEach(t=>{t.addEventListener("input",r=>{e.setKey(n,t.dataset.vbarsBind,r.currentTarget.value)})})}}}(...arguments),d=()=>a.innerHTML=r(n);return{$el:a,render:d,replace:function(){d(),t.innerHTML=a.innerHTML,o.add(t)},patch:function(t,r){var n,s;d(),Array.from(a.querySelectorAll("[data-vbars-watch]")).filter(e=>r.startsWith(e.dataset.vbarsWatch)).forEach(r=>{const n=t.querySelector(`[data-vbars-id="${r.dataset.vbarsId}"]`);e.isKeyedNode(r)?(r=r,s=n,e.keyedChildren(s).forEach(t=>{const n=r.querySelector(`[data-key="${t.dataset.key}"]`);if(n){if(!n.isEqualNode(t)){const r=e.swapNodes(n,t);o.add(r)}}else t.remove()}),e.keyedChildren(r).forEach(t=>{if(!s.querySelector(`[data-key="${t.dataset.key}"]`)){const r=e.addChild(s,t);o.add(r)}})):o.add(e.swapNodes(r,n))})}}}var r={register(e){e.registerHelper("watch",(t,r)=>{const n=`${r.loc.start.column}${r.loc.start.line}${r.loc.end.column}${r.loc.end.line}`;return new e.SafeString(`data-vbars-id="${n}" data-vbars-watch="${t}"`)}),e.registerHelper("handler",function(){const t=Array.from(arguments);return t.splice(-1,1),new e.SafeString(`data-vbars-handler='${JSON.stringify(t)}'`)})}};return{create({template:e,data:n,methods:a={}}){let o,d;const s=window.Handlebars.create(),c=function e(t,r,n=[]){return new Proxy(t,{get:function(t,a){const o=Reflect.get(...arguments);return null!==o&&"object"==typeof o&&"methods"!==a?e(o,r,n.concat(a)):o},set:function(e,t){const a=Reflect.set(...arguments);return r({path:n.concat(t).join(".")}),a},deleteProperty:function(e,t){const a=Reflect.deleteProperty(...arguments);return r({path:n.concat(t).join(".")}),a}})}(n,({path:e})=>d.patch(o,e));r.register(s,c);const i=s.compile(e);return{instance:s,data:c,render(e){(d=t({$root:o=e,templateFn:i,proxyData:c,methods:a})).replace()}}}}});