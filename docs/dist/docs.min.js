!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).DocsApp=t()}(this,(function(){"use strict";const e={warn:"background: #484915; color: #ffffbe; padding: .1em; font-weight: normal;",log:"background: #324645; color:#c9faff; padding: .1em; font-weight: normal;"},t=(e,{loc:t,data:n})=>{const o=e.split("\n").slice(t.start.line-1,t.end.line),a=Array(o[0].length-o[0].trim().length).join(" ");return o[0]=o[0].substr(t.start.column),o[o.length-1]=o[o.length-1].substr(0,t.end.column),["",`component: ${n.root.$name}, template line: ${t.start.line}`,"============================================"].concat(o.map(e=>e.replace(a,""))).join("\n")},n=(t,n,a={},...r)=>{let s=o[n](a);if(!["warn","log"].includes(t))throw r.forEach(e=>console.error(e)),new Error(s);s="%c "+s+" ",window.ReBars.trace&&(r?(console.groupCollapsed(s,e[t]),r.forEach(e=>console.log(e)),console.groupEnd()):console.log(s,e[t]))},o={noEl:()=>"$el must be present in the document",noHbs:()=>"ReBars need Handlebars in order to run!",noName:()=>"Each ReBars component should have a name",dataFn:({name:e})=>`component:${e} must be a function`,tplStr:({name:e})=>`component:${e} needs a template string`,propStomp:({name:e,key:t})=>`component:${e} "data.${t}" was overrode by a prop`,propUndef:({name:e,key:t})=>`component:${e} was passed undefined for prop "${t}"`,oneRoot:({name:e})=>`component:${e} must have one root node, and cannot be a {{#watch}} block. \nThis error can also be caused by malformed html.`,noMethod:({name:e,methodName:t})=>`component:${e} does not have a method named "${t}"`,badPath:({path:e})=>`${e} was not found in object`,reRender:({name:e,path:t})=>`component:${e} re-rendering "${t}"`,patching:({name:e,path:t})=>`component:${e} patching ref Array "${t}"`,pathTrigger:({path:e,action:t,name:n})=>`component:${n} ${t} "${e}"`,triggered:({name:e,paths:t})=>`component:${e} data change "${t}"`,paramUndef:({data:e,template:n,loc:o})=>`component:${e.root.$name} passed undefined to a helper\n      ${t(n,{data:e,loc:o})}\n    `,badWatchParam:({data:e,template:n,loc:o,path:a})=>`component:${e.root.$name} could not find "${a}" to watch. If primitve wrap in quotes\n      ${t(n,{data:e,loc:o})}\n    `,noComp:({data:e,loc:n,template:o,cName:a})=>`component:${e.root.$name} child component "${a}" is not registered\n      ${t(o,{data:e,loc:n})}\n    `,restrictedKey:({name:e,key:t})=>`component:${e} cannot use restricted key "${t}" in your data as it's a helper`,focusFail:({ref:e,name:t})=>`component:${t} ref "${e}" is used more than once. Focus cannot be restored. If using bind, add a ref="uniqeName" to each`,notKeyed:({name:e,path:t})=>`component:${e} patching "${t}" add a {{ ref }} to avoid re-rendering the entire target`};var a={messages:o,getStr:(e,t)=>o[e](t),warn:n.bind(null,"warn"),fail:n.bind(null,"throw"),log:n.bind(null,"log")};let r=1;var s={dom:{tagComponent(e,t,n){const o=this.getShadow(t),r=o.firstElementChild;(!r||!o.children||o.children.length>1||r.dataset.rbsWatch)&&a.fail("oneRoot",{name:n},o),r.dataset.rbsComp=e;const s=o.innerHTML;return o.remove(),s},restoreCursor(e,t){const n=this.findRef(e,t.ref);n&&(Array.isArray(n)?a.warn("focusFail",{ref:t.ref,name:name},n):(n.focus(),t.pos&&n.setSelectionRange(t.pos+1,t.pos+1)))},findComponent:e=>document.querySelector(`[data-rbs-comp="${e}"]`),findRef:(e,t)=>e.querySelector(`[data-rbs-ref="${t}"]`),findRefs(e){const t="object"==typeof e?e:this.findComponent(e);return Array.from(t.querySelectorAll("[data-rbs-ref]")).reduce((e,t)=>{const n=t.dataset.rbsRef,o=e[t.dataset.rbsRef];return e[n]=o?[o].concat(t):t,e},{})},findWatcher:e=>document.querySelector(`[data-rbs-watch="${e}"]`),wrapWatcher:(e,t,n)=>{const{tag:o,...a}={tag:"span",class:"rbs-watch",...n};return`<${o} ${Object.entries(a).map(([e,t])=>`${e}="${t}"`).join(" ")} ${t.length?"":"style='display:none;'"} data-rbs-watch="${e}">${t}</${o}>`},isKeyedNode:e=>e.children.length&&Array.from(e.children).every(e=>e.dataset.rbsRef),normalizeHtml:e=>e.replace(new RegExp(/="rbs(.*?)"/g),""),isEqHtml(e,t){const n="string"==typeof e?this.getShadow(e):this.getShadow(e.innerHTML),o="string"==typeof t?this.getShadow(t):this.getShadow(t.innerHTML);return n.innerHTML=this.normalizeHtml(n.innerHTML),o.innerHTML=this.normalizeHtml(o.innerHTML),n.isEqualNode(o)},getShadow(e){const t=document.createElement("div");return t.innerHTML=e,t}},deleteOrphans(e,t){const n=this.getStorage(e,t),o=this.getStorage(e);Object.keys(o.inst).forEach(e=>{this.dom.findComponent(e)||delete o.inst[e]}),Object.keys(n.renders).forEach(e=>{this.dom.findWatcher(e)||delete n.renders[e]})},debounce(e,t,n=!1){let o=null;return function(){const a=n&&!o,r=()=>e.apply(this,arguments);clearTimeout(o),o=setTimeout(r,t),a&&r()}},makeParams:e=>e.map(e=>{if(["[event]"].includes(e))return e.replace("[","").replace("]","");if(null!==e&&"object"==typeof e)throw new Error(`component:${name} must only pass primitives as argument to a handler. \n${JSON.stringify(e,null,2)}`);return"string"==typeof e?`'${e}'`:null===e?`${e}`:e}),getStorage(e,t){return t?this.findByPath(window.ReBars,`apps.${e}.inst.${t}`):this.findByPath(window.ReBars,`apps.${e}`)},findByPath:(e,t)=>{try{return t.includes(".")?t.split(".").reduce((e,t)=>e[t],e):e[t]}catch(n){a.fail("badPath",{path:t},e)}},shouldRender:(e,t)=>(Array.isArray(t)?t:[t]).some(t=>{if(e===t||".*"===t)return!0;const n=e.split(".");return t.split(".").every((e,t)=>e===n[t]||"*"===e)}),randomId:()=>`rbs${r++}`,setKey(e,t,n){const o=t.split(".");o.reduce((r,s,d)=>(s in r||a.fail("badPath",{path:t},e),d+1===o.length&&(r[s]=n),r[s]),e)}},d={init(e,t){const{scope:n,renders:o}=s.getStorage(e,t),{$name:r}=n;const d=[],i={watchers:{},renders:{}},c=s.debounce(()=>{a.log("triggered",{name:r,paths:d.join(",")},i),d.length=0,Object.entries(i.watchers).forEach(([e,t])=>{delete i.watchers[e],t()}),Object.entries(i.renders).forEach(([e,t])=>{const n=s.dom.findWatcher(e);if(!n)return;const o=t.render();if(s.dom.isEqHtml(n.innerHTML,o))return;if(s.dom.isKeyedNode(n))return function(e,t){const n=s.dom.getShadow(t),o=Array.from(n.children);Array.from(e.children).forEach(e=>{const t=s.dom.findRef(n,e.dataset.rbsRef);t?s.dom.isEqHtml(t,e)||e.replaceWith(t.cloneNode(!0)):e.remove()}),o.forEach((t,n)=>{const o=t.dataset.rbsRef;if(!s.dom.findRef(e,o)){const o=e.children[n];o?e.insertBefore(t.cloneNode(!0),o):e.append(t.cloneNode(!0))}}),o.forEach((t,n)=>{const o=t.dataset.rbsRef,a=e.children[n];a&&a.dataset.rbsRef!==o&&e.children[n].replaceWith(t.cloneNode(!0))})}(n,o),a.log("patching",{name:r,path:t.path},n),void delete i.renders[e];const d=t.matching.find(e=>e.endsWith(".length"));d&&a.warn("notKeyed",{name:r,path:d},n);const c={ref:document.activeElement.dataset.rbsRef,pos:document.activeElement.selectionStart};n.style.display=""===o?"none":"",n.innerHTML=o,s.dom.restoreCursor(n,c),a.log("reRender",{name:r,path:t.path},n)})},0);return{que(a){s.deleteOrphans(e,t),Object.entries(n.$watchers).forEach(([e,t])=>{s.shouldRender(a,e)&&(i.watchers[e]=t)}),Object.entries(o).forEach(([e,t])=>{s.shouldRender(a,t.path)&&(e in i.renders||(i.renders[e]={...t,matching:[a]}),i.renders[e].matching.push(a))}),d.push(a),c()}}}},i={create(e){let t;const n=function e(o,a=[]){return new Proxy(o,{get:function(t,o){if("ReBarsPath"===o)return a.join(".");const r=Reflect.get(...arguments);return"function"==typeof r&&t.hasOwnProperty(o)?r.bind(n):null!==r&&"object"==typeof r&&"methods"!==o?e(r,a.concat(o)):r},set:function(e,n){const o=Reflect.set(...arguments),r=a.concat(n).join(".");return t&&t(r),o},deleteProperty:function(e,n){const o=Reflect.deleteProperty(...arguments),r=a.concat(n).join(".");return t&&t(r),o}})}(e);return{watch(){t=d.init(n.$_appId,n.$_componentId).que},data:n}}},c={register(e,t,n){Object.entries(t).forEach(([t,n])=>e.registerHelper(t,n)),e.registerHelper("component",(function(...t){const{hash:o,data:r,loc:d}=t.pop(),{cDefs:i}=s.getStorage(r.root.$_appId),c=t[0];return i[c]||a.fail("noComp",{data:r,loc:d,template:n,cName:c}),new e.SafeString(i[c].instance(o).render())})),e.registerHelper("isComponent",(function(e,{data:t}){const{cDefs:n}=s.getStorage(t.root.$_appId);return Object.keys(n).includes(e)})),e.registerHelper("ref",t=>new e.SafeString(`data-rbs-ref="${t}"`)),e.registerHelper("debug",(t,{data:o,loc:r})=>{void 0===t&&a.fail("paramUndef",{template:n,data:o,loc:r});return new e.SafeString(`<pre class="debug">${JSON.stringify(t,(e,t)=>"function"==typeof t?t+"":t,2)}</pre>`)})}},l={register(e){e.registerHelper("method",(function(){const[t,...n]=arguments,[o,a="click"]=t.split(":"),{data:r}=n.pop(),{$_appId:d,$_componentId:i}=r.root,c=s.makeParams([d,i,o,"[event]"].concat(n));return new e.SafeString(`on${a}="rbs.handlers.trigger(${c.join(",")})"`)})),e.registerHelper("bound",(t,{hash:n={},data:o})=>{const{$_appId:a,$_componentId:r}=o.root,d=s.findByPath(o.root,t),i=n.ref||t,c=s.makeParams([a,r,"[event]",t]);return new e.SafeString(`value="${d}" data-rbs-ref="${i}" oninput="rbs.handlers.bound(${c.join(",")})"`)})}},p={register(e,t){e.registerHelper("watch",(function(...e){const{fn:n,hash:o,data:r,loc:d}=e.pop(),i=e.map(e=>((e,n=!0)=>(void 0===e&&a.fail("paramUndef",{template:t,loc:d,data:r}),"object"==typeof e?`${e.ReBarsPath}${n?".*":""}`:e))(e,!1)).join(".").split(","),c=s.randomId();return s.getStorage(r.root.$_appId,r.root.$_componentId).renders[c]={path:i,render:()=>n(this)},s.dom.wrapWatcher(c,n(this),o)}))}};const h=["component","ref","debug","isComponent","method","bound","watch","isComponent"];var m={register:function e(t,n,{name:o,template:r,data:d,helpers:m={},hooks:u={},methods:f={},watchers:g={},components:b=[]}){const w=s.getStorage(t);d=d||function(){return{}},o||a.fail("noName",null,arguments[2]),"function"!=typeof d&&a.fail("dataFn",{name:o}),"string"!=typeof r&&a.fail("tmplStr",{name:o});const $=n.create(),y=$.compile(r);return b.forEach(o=>{o.name||a.fail("noName",null,o),w.cDefs[o.name]||(w.cDefs[o.name]=e(t,n,o))}),Object.keys(d()).forEach(e=>{h.concat(Object.keys(m)).includes(e)&&a.fail("restrictedKey",{name:o,key:e})}),c.register($,{...m,...w.helpers},r),l.register($,f),p.register($,r),{instance(e={}){const n=s.randomId(),r=d();Object.entries(e).forEach(([e,t])=>{void 0===t&&a.warn("propUndef",{name:o,key:e})});const{data:c,watch:l}=i.create({...r,$props:e,$methods:f,$hooks:u,$name:o,$watchers:g,$_appId:t,$_componentId:n,$refs:()=>s.dom.findRefs(n)});return w.inst[n]={scope:c,renders:{}},u.created&&u.created.call(c),{scope:c,render(){const e=s.dom.tagComponent(n,y(c),o);return l(),e}}}}}},u={app({$el:e,root:t,Handlebars:n=window.Handlebars,helpers:o={},trace:r=!1}){window.rbs=window.ReBars=window.ReBars||{},window.ReBars.apps=window.ReBars.apps||{},window.ReBars.trace=r,window.ReBars.handlers=window.ReBars.handlers||{trigger(...e){const[t,n,o,...r]=e,d=s.getStorage(t,n).scope,i=d.$methods[o];i||a.fail("noMethod",{name:d.$name,methodName:o}),i(...r)},bound(e,t,n,o){const{scope:a}=s.getStorage(e,t);s.setKey(a,o,n.target.value)}},n||a.fail("noHbs"),document.body.contains(e)||a.fail("noEl");const d=s.randomId(),i=window.ReBars.apps[d]={helpers:o,cDefs:{},inst:{}};return e.innerHTML=m.register(d,n,t).instance().render(),{id:d,storage:i}}},f={template:'\n  <div>\n    <div class="header-container">\n      <h1>\n        {{#watch header }}\n          <span>{{ header.title }}</span>\n          <small>{{ header.description }}</small>\n        {{/watch}}\n      </h1>\n\n      <label>\n        Title:\n        <input type="text" {{ bound "header.title" }}/>\n      </label>\n\n      <label>\n        Description:\n        <input type="text" {{ bound "header.description" }}/>\n      </label>\n    </div>\n\n    <ul class="simple">\n      {{#watch "todos.*" }}\n        {{#each todos }}\n          <li {{ ref id }}>\n            <div class="todo">\n              <label>\n                <input type="checkbox" {{ isChecked done }} {{ method "toggleDone" id }} />\n                {{#if done }}\n                  <s>{{ name }}</s>\n                {{else}}\n                  <strong>{{ name }}</strong>\n                {{/if}}\n              </label>\n\n              <div class="actions">\n                <button {{ method "deleteTodo" id }}>delete</button>\n              </div>\n            </div>\n          </li>\n        {{/each}}\n      {{/watch}}\n    </ul>\n\n    {{#watch "adding" }}\n      {{#if adding }}\n        <form>\n          <input type="text" name="name" {{ ref "newName" }} placeholder="the new todo" />\n          <button class="push" {{ method "addItem" }}>Add todo</button>\n          <button class="cancel" {{ method "toggleCreate" }}>Cancel</button>\n        </form>\n      {{else}}\n        <button class="add" {{ method "toggleCreate" }}>Add another</button>\n      {{/if}}\n    {{/watch}}\n  </div>\n  ',data:()=>({adding:!1,header:{title:"Todos",description:"some things that need done"},todos:[{done:!1,name:"Grocery Shopping",id:22},{done:!0,name:"Paint the House",id:44}]}),name:"DemoApp",helpers:{isChecked:e=>e?"checked":""},methods:{addItem(e){e.preventDefault();const t=this.$refs().newName;this.todos.push({id:(new Date).getTime(),name:t.value}),t.value=""},deleteTodo(e,t){const n=this.todos.findIndex(e=>e.id===t);this.todos.splice(n,1)},toggleDone(e,t){const n=this.todos.find(e=>e.id===t);n.done=!n.done},toggleCreate(e){e.preventDefault(),this.adding=!this.adding}}},g={template:'\n  <div>\n    <div class="header-container">\n      {{#watch "header.*" tag="h1" }}\n        <span>{{ header.title }}</span>\n        <small>{{ header.description }}</small>\n      {{/watch}}\n\n      <label>\n        Title:\n        <input type="text" {{ bound "header.title" }}/>\n      </label>\n\n      <label>\n        Description:\n        <input type="text" {{ bound "header.description" }}/>\n      </label>\n    </div>\n\n    {{ component "filters" filters=filters }}\n\n    {{#watch "filters.*,todos.length,todos.*.done" tag="ul"}}\n      {{#each filteredTodos as | todo | }}\n        <li {{ ref todo.id }}>\n          {{\n            component "Todo"\n            todo=todo\n            index=@index\n            deleteTodo=@root.$methods.deleteTodo\n          }}\n        </li>\n      {{/each}}\n    {{/watch}}\n\n    {{\n      component "AddTodo"\n      addTodo=$methods.addTodo\n    }}\n  <div>\n  ',name:"DemoApp",data:()=>({filteredTodos(){let e=this.todos.concat();"incomplete"===this.filters.state?e=this.todos.filter(e=>!e.done):"completed"===this.filters.state&&(e=this.todos.filter(e=>e.done));const t=e.sort((e,t)=>"name"===this.filters.sortBy?e.name.localeCompare(t.name):new Date(e.updated).getTime()-new Date(t.updated).getTime());return"asc"===this.filters.sortDir?t:t.reverse()},filters:{state:null,sortBy:"name",sortDir:"asc"},header:{title:"ReBars Todos",description:"Some things that need done"},todos:[{done:!1,name:"Wash the car",updated:"3/1/2020, 12:37:10 PM",id:21},{done:!0,name:"Shopping for groceries",updated:"2/27/2020, 2:37:10 PM",id:22},{done:!1,name:"Code some Javascript",updated:"1/27/2020, 9:37:10 AM",id:23},{done:!0,name:"Go for a run",updated:"1/15/2020, 10:37:10 PM",id:24}]}),components:[{template:'\n  <div>\n    {{#watch "isAdding" }}\n      {{#if isAdding }}\n        <form>\n          {{#watch "newName" }}\n            <h3>{{ newName }}</h3>\n            <input type="text" {{ bound "newName" }} placeholder="the new todo" />\n          {{/watch}}\n\n          <button class="push" {{ method "addItem" }}>Add todo</button>\n          <button class="cancel" {{ method "toggleAdd" }}>Cancel</button>\n        </form>\n      {{ else }}\n        <button class="add" {{ method "toggleAdd" }}>Add another</button>\n      {{/if}}\n    {{/watch}}\n  </div>\n  ',name:"AddTodo",data:()=>({isAdding:!1,hasError:!1,newName:""}),methods:{toggleAdd(e){e.preventDefault(),this.isAdding=!this.isAdding},addItem(e){e.preventDefault(),this.$props.addTodo(this.newName),this.newName=""}}},{template:'\n    <div>\n      {{#watch "editing" tag="div" class="todo" }}\n        {{#if editing}}\n          <input type="text" value="{{ $props.todo.name }}" {{ ref "nameInput" }}/>\n          <button {{ method "save" }}>save</button>\n        {{ else }}\n\n          {{#watch $props.todo }}\n            <label>\n              <input type="checkbox" {{ isChecked $props.todo.done }} {{ method "toggleDone" }} />\n              {{#if $props.todo.done }}\n                <s>{{ $props.todo.name }}</s>\n              {{else}}\n                <strong>{{ $props.todo.name }}</strong>\n              {{/if}}\n            </label>\n          {{/watch}}\n\n          <div class="actions">\n            <span class="date">{{ timeAgo todo.updated }}</span>\n            <button {{ method "remove" }}>delete</button>\n            <button {{ method "toggleEditing" }}>edit</button>\n          </div>\n        {{/if}}\n      {{/watch}}\n    </div>\n  ',name:"Todo",data:()=>({editing:!1}),helpers:{isChecked:e=>e?"checked":"",timeAgo:e=>window.moment(e).fromNow()},methods:{save(){this.$props.todo.name=this.$refs().nameInput.value,this.$props.todo.updated=(new Date).toLocaleString(),this.editing=!1},remove(){this.$props.deleteTodo(this.$props.todo.id)},toggleEditing(){this.editing=!this.editing},toggleDone(){this.$props.todo.done=!this.$props.todo.done}}},{template:'\n    <div class="filters">\n      {{#watch "$props.filters.state" tag="div" }}\n        <button {{ disabledIf "completed" }} {{ method "filterBy" "completed" }}>Show Completed</button>\n        <button {{ disabledIf "incomplete" }} {{ method "filterBy" "incomplete" }}>Show Incompleted</button>\n        <button {{ disabledIf null }} {{ method "filterBy" null }}>Show All</button>\n      {{/watch}}\n\n      {{#watch "$props.filters.sortBy,$props.filters.sortDir" tag="div" }}\n        <select {{ bound "$props.filters.sortBy" }}>\n          <option {{ selectedIf $props.filters.sortBy "name" }} value="name">Sort by Name</option>\n          <option {{ selectedIf $props.filters.sortBy "updated" }} value="updated">Sort by Updated at</option>\n        </select>\n\n        <select {{ bound "$props.filters.sortDir" }}>\n          <option {{ selectedIf $props.filters.sortDir "asc" }} value="asc">Ascending</option>\n          <option {{ selectedIf $props.filters.sortDir "desc" }} value="desc">Descending</option>\n        </select>\n      {{/watch}}\n    </div>\n  ',name:"filters",helpers:{selectedIf:(e,t)=>e===t?"selected":"",disabledIf:(e,{data:t})=>t.root.$props.filters.state===e?"disabled":""},methods:{filterBy(e,t){this.$props.filters.state=t}}}],methods:{addTodo(e){this.todos.push({name:e,id:(new Date).getTime(),updated:(new Date).toLocaleString()}),this.filters.state=null},deleteTodo(e,t){const n=this.todos.findIndex(e=>e.id===t);this.todos.splice(n,1)},showAdd(e){e.preventDefault(),this.uiState.adding=!0}}},b={template:'\n    <h3>\n      Button have been clicked\n        {{#watch "clicked" }}\n          <span>{{ clicked }}</span>\n          {{ pluralize "time" clicked }}\n        {{/watch}}\n      <button {{ method "step" }}>Click Me</button>\n    </h3>\n  ',name:"counter",data:()=>({clicked:0}),helpers:{pluralize:(e,t)=>1==t?e:`${e}s`},methods:{step(){this.clicked++}}};return window.Prism=window.Prism||{},window.Prism.manual=!0,{init(){u.app({$el:document.getElementById("demo-app-simple"),root:f}),u.app({$el:document.getElementById("demo-app-advanced"),root:g}),u.app({$el:document.getElementById("counter-demo"),root:b}),document.querySelectorAll(".language-html").forEach(e=>{e.innerText.includes("<script src")||(e.classList.remove("language-html"),e.classList.add("language-handlebars"))}),Prism.highlightAll(),Array.from(document.querySelectorAll("code.language-javascript .token.string")).filter(e=>e.innerText.trim().startsWith("<")&&e.innerText.trim().endsWith(">")).forEach(e=>{e.innerHTML=Prism.highlight(e.innerText,Prism.languages.handlebars,"handlebars")}),document.querySelectorAll("nav.tabs button").forEach(e=>{const t=e.parentElement.querySelectorAll("*"),n=e.parentElement.parentElement.querySelectorAll(".tab-content *");e.addEventListener("click",o=>{o.preventDefault(),t.forEach(e=>e.classList.remove("active")),n.forEach(e=>e.classList.remove("active")),e.classList.add("active"),document.getElementById(e.dataset.target).classList.add("active")})}),function(){const e=new IntersectionObserver(e=>{e.forEach(e=>{const t=e.target.getAttribute("id"),n=document.querySelector(`.side-bar-nav a[href="#${t}"]`);n&&(e.intersectionRatio>0?n.classList.add("active"):n.classList.remove("active"))})});document.querySelectorAll("h1,h2").forEach(t=>{e.observe(t)})}()}}}));
