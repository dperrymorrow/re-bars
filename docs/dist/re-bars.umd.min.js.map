{"version":3,"file":"re-bars.umd.min.js","sources":["../src/config.js","../src/utils/dom.js","../src/utils/index.js","../src/proxy-trap.js","../src/helpers.js","../src/utils/patch.js","../src/re-render.js","../src/garbage.js","../src/app.js"],"sourcesContent":["let isTracing = false;\n\nexport default {\n  logLevel: () => (isTracing ? 1 : 0),\n  setTrace: val => (isTracing = val),\n\n  regex: {\n    attrs: /rbs-(.*?)=\"(.*?)\"/g,\n    whitespace: /\\s/g,\n  },\n\n  attrs: {\n    key: \"rbs-key\",\n    watch: \"rbs-watch\",\n    method: \"rbs-method\",\n    ref: \"rbs-ref\",\n  },\n};\n","import Config from \"../config.js\";\nconst { attrs } = Config;\n\nexport default {\n  recordState($target) {\n    const $active = document.activeElement;\n    const ref = $active.getAttribute(attrs.ref);\n\n    if (!$target.contains($active) || !ref) return null;\n    return {\n      ref,\n      style: $active.getAttribute(\"style\"),\n      scrollTop: $active.scrollTop,\n      scrollLeft: $active.scrollLeft,\n      selectionStart: $active.selectionStart,\n    };\n  },\n\n  restoreState($target, activeRef) {\n    if (!activeRef) return;\n\n    const $input = this.findRef($target, activeRef.ref);\n    if (!$input) return;\n\n    $input.focus();\n    if (activeRef.selectionStart) {\n      const pos = $input.tagName === \"TEXTAREA\" ? activeRef.selectionStart : activeRef.selectionStart + 1;\n      $input.setSelectionRange(pos, pos);\n    }\n\n    $input.scrollTop = activeRef.scrollTop;\n    $input.scrollLeft = activeRef.scrollLeft;\n    if (activeRef.style) $input.setAttribute(\"style\", activeRef.style);\n  },\n\n  findRefs($root) {\n    const { ref } = attrs;\n    const $refs = Array.from($root.querySelectorAll(`[${ref}]`));\n\n    return $refs.reduce((obj, $el) => {\n      const key = $el.getAttribute(ref);\n      const target = obj[key];\n      obj[key] = target ? [target].concat($el) : $el;\n      return obj;\n    }, {});\n  },\n\n  // use this in place of all the others that are repeated eventually...\n  findAttr(attr, val, $target = null) {\n    const $container = $target || document;\n    if ($container.getAttribute(attr) === val) return $container;\n    return $container.querySelector(`[${attr}=\"${val}\"]`);\n  },\n\n  findRef: ($target, ref) => {\n    if ($target.getAttribute(attrs.ref) === ref) return $target;\n    return $target.querySelector(`[${attrs.ref}=\"${ref}\"]`);\n  },\n\n  findMethod: id => document.querySelector(`[${attrs.method}=\"${id}\"]`),\n  findWatcher: id => document.querySelector(`[${attrs.watch}=\"${id}\"]`),\n  isTextNode: $el => $el.nodeType === Node.TEXT_NODE,\n\n  propStr: props =>\n    Object.entries(props)\n      .map(([key, val]) => {\n        if (typeof val === \"number\") return `${key}=${val}`;\n        else return `${key}=\"${val}\"`;\n      })\n      .join(\" \"),\n\n  wrapWatcher(id, html, hash) {\n    const { tag, ...props } = { tag: \"span\", ...hash };\n    const propStr = this.propStr(props);\n    const style = !html.length ? \"style='display:none;'\" : \"\";\n    return `<${tag} ${propStr} ${style} ${attrs.watch}=\"${id}\">${html}</${tag}>`;\n  },\n\n  getShadow(html) {\n    const $tmp = document.createElement(\"div\");\n    $tmp.innerHTML = html;\n    return $tmp;\n  },\n};\n","import Dom from \"./dom.js\";\nconst { fetch } = window;\nlet counter = 1;\n\nexport default {\n  dom: Dom,\n\n  debounce(callback, wait = 0, immediate = false) {\n    let timeout = null;\n\n    return function() {\n      const callNow = immediate && !timeout;\n      const next = () => callback.apply(this, arguments);\n\n      clearTimeout(timeout);\n      timeout = setTimeout(next, wait);\n\n      if (callNow) {\n        next();\n      }\n    };\n  },\n\n  loadTemplate: file =>\n    fetch(file)\n      .then(res => res.text())\n      .catch(err => {\n        throw new Error(err);\n      }),\n\n  nextTick: () =>\n    new Promise(resolve => {\n      setTimeout(resolve, 0);\n    }),\n\n  setPath(target, path, val) {\n    const segs = path.split(\".\");\n    const last = segs.pop();\n    segs.reduce((point, seg) => point[seg], target)[last] = val;\n    return target;\n  },\n\n  buildContext(scope, { $app, data, methods }) {\n    const context = {\n      $app,\n      $nextTick: this.nextTick,\n      $refs: this.dom.findRefs.bind(null, $app),\n      rootData: data,\n    };\n    context.methods = this.bind(methods, scope, context);\n    return context;\n  },\n\n  registerHelpers({ instance, helpers, scope }) {\n    const utils = this;\n    Object.entries(helpers).forEach(([name, fn]) =>\n      instance.registerHelper(name, function(...args) {\n        const context = utils.buildContext(this, scope);\n        return fn.call(this, context, ...args);\n      })\n    );\n  },\n\n  bind(obj, scope, ...args) {\n    return Object.keys(obj).reduce((bound, key) => {\n      bound[key] = obj[key].bind(scope, ...args);\n      return bound;\n    }, {});\n  },\n\n  shouldRender: (changed, watching) => changed.some(change => watching.some(watch => change.match(watch))),\n  randomId: () => counter++,\n};\n","import Utils from \"./utils/index.js\";\n\nexport default {\n  create(scope, callback, trackGet = false) {\n    let que = [];\n\n    const _debounced = Utils.debounce(() => {\n      callback(que);\n      que = [];\n    });\n\n    const _addToQue = path => {\n      if (!que.includes(path)) que.push(path);\n      _debounced(que);\n    };\n\n    function _buildProxy(raw, tree = []) {\n      return new Proxy(raw, {\n        get: function(target, prop) {\n          const value = Reflect.get(...arguments);\n\n          if (typeof value === \"function\" && target.hasOwnProperty(prop))\n            return value.bind(proxyData, Utils.buildContext(target, scope));\n\n          if (value && typeof value === \"object\" && [\"Array\", \"Object\"].includes(value.constructor.name)) {\n            return _buildProxy(value, tree.concat(prop));\n          } else {\n            if (trackGet) _addToQue(tree.concat(prop).join(\".\"));\n            return value;\n          }\n        },\n\n        set: function(target, prop, value) {\n          const ret = Reflect.set(...arguments);\n          const path = tree.concat(prop).join(\".\");\n          _addToQue(path);\n          return ret;\n        },\n\n        deleteProperty: function(target, prop) {\n          const ret = Reflect.deleteProperty(...arguments);\n          const path = tree.concat(prop).join(\".\");\n          _addToQue(path);\n          return ret;\n        },\n      });\n    }\n\n    const proxyData = _buildProxy(scope.data);\n    return proxyData;\n  },\n};\n","import Utils from \"./utils/index.js\";\nimport ProxyTrap from \"./proxy-trap.js\";\nimport Config from \"./config.js\";\n\nconst { attrs } = Config;\n\nexport default {\n  register({ instance, template, store, scope }) {\n    instance.registerHelper(\"key\", name => new instance.SafeString(`${attrs.key}=\"${name}\"`));\n    instance.registerHelper(\"ref\", name => new instance.SafeString(`${attrs.ref}=\"${name}\"`));\n\n    instance.registerHelper(\"concat\", function(...args) {\n      args.pop();\n      return args.join(\"\");\n    });\n\n    instance.registerHelper(\"onlyIf\", function(...args) {\n      args.pop();\n      const [condition, string] = args;\n      return new instance.SafeString(condition ? string : \"\");\n    });\n\n    instance.registerHelper(\"on\", function(...args) {\n      const { hash } = args.pop();\n      const id = Utils.randomId();\n      const tplScope = this;\n\n      store.handlers[id] = [];\n\n      Utils.nextTick().then(function() {\n        const $el = Utils.dom.findMethod(id);\n        if (!$el) return;\n\n        Object.entries(hash).forEach(([eventType, methodName]) => {\n          if (!(methodName in scope.methods)) instance.log(3, `ReBars: \"${methodName}\" is not a method.`, hash, $el);\n\n          const handler = event => {\n            const context = Utils.buildContext(tplScope, scope);\n            context.event = event;\n            context.methods[methodName](...args);\n          };\n\n          store.handlers[id].push({ $el, handler, eventType });\n          $el.addEventListener(eventType, handler);\n        });\n      });\n\n      return new instance.SafeString(`${attrs.method}=\"${id}\"`);\n    });\n\n    instance.registerHelper(\"bind\", function(...args) {\n      const { hash } = args.pop();\n      const tplScope = this;\n      const id = Utils.randomId();\n\n      store.handlers[id] = [];\n\n      Utils.nextTick().then(() => {\n        const $el = Utils.dom.findMethod(id);\n        if (!$el) return;\n\n        Object.entries(hash).forEach(([eventType, path]) => {\n          function handler(event) {\n            try {\n              Utils.setPath(tplScope, path, event.target.value || null);\n            } catch (err) {\n              instance.log(3, `ReBars: could not set path ${path}`, $el);\n            }\n          }\n          store.handlers[id].push({ $el, handler, eventType });\n          $el.addEventListener(eventType, handler);\n        });\n      });\n\n      return new instance.SafeString(`${attrs.method}=\"${id}\"`);\n    });\n\n    instance.registerHelper(\"watch\", function(...args) {\n      const { fn, hash } = args.pop();\n      const eId = Utils.randomId();\n\n      const ref = {\n        path: args.filter(arg => typeof arg === \"string\"),\n        render: () => fn(this),\n      };\n\n      if (!args.length) {\n        const trap = ProxyTrap.create(\n          { ...scope, data: this },\n          paths => {\n            ref.path = paths;\n          },\n          true\n        );\n\n        fn(trap);\n      }\n\n      Utils.nextTick().then(() => {\n        const $el = Utils.dom.findWatcher(eId);\n        if (!$el) return;\n\n        store.renders[eId] = { ...ref, $el };\n\n        args.forEach(path => {\n          if (typeof path !== \"string\") instance.log(3, \"ReBars: can only watch Strings\", args, $el);\n        });\n        instance.log(Config.logLevel(), \"ReBars: watching\", ref.path, $el);\n      });\n\n      return Utils.dom.wrapWatcher(eId, fn(this), hash);\n    });\n  },\n};\n","import Utils from \"./index.js\";\nimport Config from \"../config.js\";\n\nconst { attrs, regex } = Config;\n\nfunction _isEqHtml(html1, html2) {\n  const parsed1 = html1.replace(regex.attrs, \"\");\n  const parsed2 = html2.replace(regex.attrs, \"\");\n  return Utils.dom.getShadow(parsed1).isEqualNode(Utils.dom.getShadow(parsed2));\n}\n\nexport default {\n  canPatch: $target =>\n    $target.children.length &&\n    $target.children.length > 1 &&\n    Array.from($target.children).every($el => $el.getAttribute(attrs.key)),\n\n  hasChanged: ($target, html) => !_isEqHtml($target.innerHTML, html),\n\n  compare({ $target, html, instance, store }) {\n    const $shadow = Utils.dom.getShadow(html);\n    const $vChilds = Array.from($shadow.children);\n    const level = Config.logLevel();\n\n    // deletes and updates\n    Array.from($target.children).forEach($r => {\n      // warn with the real element if we have an undefined key\n      if ($r.getAttribute(attrs.key) === \"undefined\") instance.log(3, \"ReBars: key was undefined\", $r);\n\n      const $v = Utils.dom.findAttr(attrs.key, $r.getAttribute(attrs.key), $shadow);\n      if (!$v) {\n        instance.log(level, \"ReBars: removing\", $r);\n        $r.remove();\n      } else if (!_isEqHtml($v.innerHTML, $r.innerHTML, true)) {\n        instance.log(level, \"ReBars: updating\", $r, $v);\n        $r.replaceWith($v.cloneNode(true));\n      }\n    });\n\n    // additions\n    $vChilds.forEach(($v, index) => {\n      const $r = Utils.dom.findAttr(attrs.key, $v.getAttribute(attrs.key), $target);\n      if (!$r) {\n        instance.log(level, \"ReBars: adding\", $v);\n        $target.append($v.cloneNode(true));\n      }\n    });\n\n    // sorting\n    $vChilds.forEach(($v, index) => {\n      const $r = $target.children[index];\n      if ($r.getAttribute(attrs.key) !== $v.getAttribute(attrs.key)) $r.replaceWith($v.cloneNode(true));\n    });\n  },\n};\n","import Utils from \"./utils/index.js\";\nimport Config from \"./config.js\";\nimport Patch from \"./utils/patch.js\";\n\nexport default {\n  paths({ changed, store, instance }) {\n    Object.entries(store.renders)\n      .filter(([renderId, handler]) => {\n        return Utils.shouldRender(changed, handler.path) && Utils.dom.findWatcher(renderId);\n      })\n      .forEach(([renderId, handler]) => {\n        const $target = Utils.dom.findWatcher(renderId);\n        // if we cant find the target, we should not attempt to re-renders\n        if (!$target) return;\n\n        const html = handler.render();\n        // cursor position focused element ect...\n        const stash = Utils.dom.recordState($target);\n\n        if (!Patch.hasChanged($target, html)) return;\n\n        if (Patch.canPatch($target)) {\n          instance.log(Config.logLevel(), \"ReBars: patching\", handler.path, $target);\n          Patch.compare({ $target, html, instance, store });\n          Utils.dom.restoreState($target, stash);\n          return;\n        }\n\n        // we dont want wrappers to show up with no content\n        $target.style.display = html === \"\" ? \"none\" : \"\";\n        $target.innerHTML = html;\n        // restore saved state of DOM\n        Utils.dom.restoreState($target, stash);\n        instance.log(Config.logLevel(), \"ReBars: re-render\", handler.path, $target);\n      });\n  },\n};\n","import Config from \"./config.js\";\n\nexport default {\n  start($app, { renders, handlers }) {\n    const observer = new MutationObserver(([record]) => {\n      record.removedNodes.forEach($el => {\n        if ($el.nodeType === Node.ELEMENT_NODE) {\n          const watchId = $el.getAttribute(Config.attrs.watch);\n          const handlerId = $el.getAttribute(Config.attrs.method);\n          if (watchId) delete renders[watchId];\n\n          if (handlerId) {\n            handlers[handlerId].forEach(item => {\n              item.$el.removeEventListener(item.eventType, item.handler);\n            });\n            delete handlers[handlerId];\n          }\n        }\n      });\n    });\n\n    observer.observe($app, { attributes: true, childList: true, subtree: true });\n    return observer;\n  },\n};\n","import Helpers from \"./helpers.js\";\nimport ReRender from \"./re-render.js\";\nimport ProxyTrap from \"./proxy-trap.js\";\nimport Utils from \"./utils/index.js\";\nimport Config from \"./config.js\";\nimport Garbage from \"./garbage.js\";\n\nconst ReBars = {\n  load: Utils.loadTemplate,\n  app({\n    helpers = {},\n    template,\n    data = {},\n    methods = {},\n    partials = {},\n    watch = {},\n    hooks = {},\n    Handlebars = window ? window.Handlebars : null,\n    trace = false,\n  }) {\n    const instance = Handlebars.create();\n\n    const store = { renders: {}, handlers: {} };\n    if (!Handlebars) throw new Error(\"ReBars: needs Handlebars in order to run\");\n\n    Config.setTrace(trace);\n\n    return {\n      store,\n      instance,\n      async render(selector) {\n        const $app = document.querySelector(selector);\n\n        // have to make sure they are resolved first\n        await Promise.all(Object.values(partials));\n        Object.entries(partials).forEach(async ([name, tpl]) =>\n          instance.registerPartial(name, tpl instanceof Promise ? await tpl : tpl)\n        );\n\n        // must be compiled after the partials\n        const templateFn = instance.compile(template instanceof Promise ? await template : template);\n\n        if (!$app)\n          return instance.log(3, `ReBars: document.querySelector(\"${selector}\") could not be found on the document`);\n\n        const scope = {\n          $app,\n          methods,\n          data,\n        };\n\n        Utils.registerHelpers({ instance, helpers, scope });\n        Helpers.register({ instance, template, store, scope });\n\n        scope.data = ProxyTrap.create(scope, async changed => {\n          instance.log(Config.logLevel(), \"ReBars: change\", changed);\n          ReRender.paths({ changed, store, instance });\n          // have to wait a tick or anything set by a watch will not catch...\n          await Utils.nextTick();\n          Object.entries(watch).forEach(([path, fn]) => {\n            if (Utils.shouldRender(changed, [path])) fn.call(scope.data, Utils.buildContext(scope.data, scope));\n          });\n        });\n\n        Garbage.start($app, store);\n        const context = Utils.buildContext(scope.data, scope);\n\n        if (hooks.beforeRender) await hooks.beforeRender.call(scope.data, context);\n        $app.innerHTML = templateFn(scope.data);\n        if (hooks.afterRender) await hooks.afterRender.call(scope.data, context);\n      },\n    };\n  },\n};\n\n// add it to the window if we have one...\nif (window) window.ReBars = window.ReBars || ReBars;\nexport default ReBars;\n"],"names":["isTracing","logLevel","setTrace","val","regex","attrs","whitespace","key","watch","method","ref","Config","[object Object]","$target","$active","document","activeElement","getAttribute","contains","style","scrollTop","scrollLeft","selectionStart","activeRef","$input","this","findRef","focus","pos","tagName","setSelectionRange","setAttribute","$root","Array","from","querySelectorAll","reduce","obj","$el","target","concat","attr","$container","querySelector","findMethod","id","findWatcher","isTextNode","nodeType","Node","TEXT_NODE","propStr","props","Object","entries","map","join","html","hash","tag","length","$tmp","createElement","innerHTML","fetch","window","counter","dom","Dom","callback","wait","immediate","timeout","callNow","next","apply","arguments","clearTimeout","setTimeout","loadTemplate","file","then","res","text","catch","err","Error","nextTick","Promise","resolve","path","segs","split","last","pop","point","seg","scope","$app","data","methods","context","$nextTick","$refs","findRefs","bind","rootData","instance","helpers","utils","forEach","name","fn","registerHelper","args","buildContext","call","keys","bound","shouldRender","changed","watching","some","change","match","randomId","trackGet","que","_debounced","Utils","debounce","_addToQue","includes","push","proxyData","_buildProxy","raw","tree","Proxy","get","prop","value","Reflect","hasOwnProperty","constructor","set","ret","deleteProperty","template","store","SafeString","condition","string","tplScope","handlers","eventType","methodName","log","handler","event","addEventListener","setPath","eId","filter","arg","render","trap","ProxyTrap","create","paths","renders","wrapWatcher","_isEqHtml","html1","html2","parsed1","replace","parsed2","getShadow","isEqualNode","canPatch","children","every","hasChanged","$shadow","$vChilds","level","$r","$v","findAttr","replaceWith","cloneNode","remove","index","append","renderId","stash","recordState","Patch","compare","restoreState","display","observer","MutationObserver","record","removedNodes","ELEMENT_NODE","watchId","handlerId","item","removeEventListener","observe","attributes","childList","subtree","ReBars","load","partials","hooks","Handlebars","trace","selector","all","values","async","tpl","registerPartial","templateFn","compile","registerHelpers","Helpers","register","ReRender","Garbage","start","beforeRender","afterRender"],"mappings":"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"}